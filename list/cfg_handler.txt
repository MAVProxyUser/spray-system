; generated by Component: ARM Compiler 5.06 update 4 (build 422) Tool: ArmCC [4d3604]
; commandline ArmCC [--list --debug -c --asm --interleave -o.\output\cfg_handler.o --asm_dir=.\list\ --list_dir=.\list\ --depend=.\output\cfg_handler.d --cpu=Cortex-M3 --apcs=interwork -O0 --diag_suppress=9931 -I.\cstartup -I.\drivers\uart -I.\app\cfg -I.\iap -I.\drivers -I.\usb -I.\drivers\adc -I.\drivers\gpio -I.\drivers -I.\RTE\_lpc17xx_can_loader_debug -IC:\Keil_v5\ARM\PACK\Keil\LPC1700_DFP\2.3.0\Device\Include -IC:\Keil_v5\ARM\CMSIS\Include -D__UVISION_VERSION=523 -DLPC175x_6x -D__DEBUG_UART2_PRINTF__ -D__UART0__ -D__UART1__ -D__UART2__ -D__UART3__ -D__UART2_ENABLE__ -D__UART3_ENABLE__ -D__UART0_ENABLE__ -D__UART1_ENABLE__ --omf_browse=.\output\cfg_handler.crf app\cfg\cfg_handler.c]
                          THUMB

                          AREA ||.text||, CODE, READONLY, ALIGN=2

                  cmd_headler_send_command_v1 PROC
;;;38     
;;;39     void cmd_headler_send_command_v1( uint8_t *p_buf, uint16_t len )
000000  b570              PUSH     {r4-r6,lr}
;;;40     {
000002  4605              MOV      r5,r0
000004  460e              MOV      r6,r1
;;;41     	cmd_header_v1_t *p_cmd = ( cmd_header_v1_t * )p_buf;
000006  462c              MOV      r4,r5
;;;42     	if( p_cmd->vl.length != len ) return;
000008  f8b40001          LDRH     r0,[r4,#1]
00000c  f3c00009          UBFX     r0,r0,#0,#10
000010  42b0              CMP      r0,r6
000012  d000              BEQ      |L1.22|
                  |L1.20|
;;;43     	Append_CRC8_Check_Sum( p_buf, 4 );
;;;44     	Append_CRC16_Check_Sum( p_buf, p_cmd->vl.length );
;;;45     
;;;46         switch( g_cfg_end_point ) {
;;;47     #if __USB_ENABLE__
;;;48         case EP_USB:
;;;49             VCOM_sendpackage( ( const char * )p_buf, p_cmd->vl.length );
;;;50             break;
;;;51     #endif    
;;;52     #if __CAN1_ENABLE__
;;;53         case EP_CAN1:
;;;54             CAN_sendbytes_View( LPC_CAN1, &can1Tx3RingBuf, p_buf, p_cmd->vl.length );
;;;55             break;
;;;56         case EP_CAN1_LED:
;;;57             CAN_sendbytes_View( LPC_CAN1, &can1LEDTxRingBuf, p_buf, p_cmd->vl.length );
;;;58             break;
;;;59         case EP_CAN1_LB:
;;;60             CAN_sendbytes_View( LPC_CAN1, &can1TxRingBuf, p_buf, p_cmd->vl.length );
;;;61             break;
;;;62     #endif
;;;63     #if __CAN2_ENABLE__
;;;64         case EP_CAN2:
;;;65             CAN_sendbytes_View( LPC_CAN2, &can2TxRingBuf, p_buf, p_cmd->vl.length );
;;;66             break;
;;;67     #endif
;;;68     #if __UART0_ENABLE__
;;;69     		case EP_UART0:
;;;70     				UART0_send_pack( p_buf , p_cmd->vl.length );
;;;71     			break ;
;;;72     #endif
;;;73     #if __UART1_ENABLE__
;;;74     		case EP_UART1:
;;;75     				UART1_send_pack( p_buf , p_cmd->vl.length );
;;;76     			break ;
;;;77     #endif
;;;78     #if __UART2_ENABLE__
;;;79     		case EP_UART2: 
;;;80     			UART2_send_pack( p_buf , p_cmd->vl.length );
;;;81     			break ;
;;;82     #endif
;;;83     #if __UART3_ENABLE__
;;;84     case EP_UART3: 
;;;85     			UART3_send_pack( p_buf , p_cmd->vl.length );
;;;86     		break ;
;;;87     #endif		
;;;88         default:
;;;89             break;
;;;90         }
;;;91     }
000014  bd70              POP      {r4-r6,pc}
                  |L1.22|
000016  2104              MOVS     r1,#4                 ;43
000018  4628              MOV      r0,r5                 ;43
00001a  f7fffffe          BL       Append_CRC8_Check_Sum
00001e  f8b40001          LDRH     r0,[r4,#1]            ;44
000022  f3c00109          UBFX     r1,r0,#0,#10          ;44
000026  4628              MOV      r0,r5                 ;44
000028  f7fffffe          BL       Append_CRC16_Check_Sum
00002c  48fe              LDR      r0,|L1.1064|
00002e  6800              LDR      r0,[r0,#0]            ;46  ; g_cfg_end_point
000030  2808              CMP      r0,#8                 ;46
000032  d243              BCS      |L1.188|
000034  e8dff000          TBB      [pc,r0]               ;46
000038  42040e18          DCB      0x42,0x04,0x0e,0x18
00003c  222a323a          DCB      0x22,0x2a,0x32,0x3a
000040  f8b40001          LDRH     r0,[r4,#1]            ;54
000044  f3c00309          UBFX     r3,r0,#0,#10          ;54
000048  462a              MOV      r2,r5                 ;54
00004a  49f8              LDR      r1,|L1.1068|
00004c  48f8              LDR      r0,|L1.1072|
00004e  f7fffffe          BL       CAN_sendbytes_View
000052  e034              B        |L1.190|
000054  f8b40001          LDRH     r0,[r4,#1]            ;57
000058  f3c00309          UBFX     r3,r0,#0,#10          ;57
00005c  462a              MOV      r2,r5                 ;57
00005e  49f5              LDR      r1,|L1.1076|
000060  48f3              LDR      r0,|L1.1072|
000062  f7fffffe          BL       CAN_sendbytes_View
000066  e02a              B        |L1.190|
000068  f8b40001          LDRH     r0,[r4,#1]            ;60
00006c  f3c00309          UBFX     r3,r0,#0,#10          ;60
000070  462a              MOV      r2,r5                 ;60
000072  49f1              LDR      r1,|L1.1080|
000074  48ee              LDR      r0,|L1.1072|
000076  f7fffffe          BL       CAN_sendbytes_View
00007a  e020              B        |L1.190|
00007c  f8b40001          LDRH     r0,[r4,#1]            ;70
000080  f3c00109          UBFX     r1,r0,#0,#10          ;70
000084  4628              MOV      r0,r5                 ;70
000086  f7fffffe          BL       UART0_send_pack
00008a  e018              B        |L1.190|
00008c  f8b40001          LDRH     r0,[r4,#1]            ;75
000090  f3c00109          UBFX     r1,r0,#0,#10          ;75
000094  4628              MOV      r0,r5                 ;75
000096  f7fffffe          BL       UART1_send_pack
00009a  e010              B        |L1.190|
00009c  f8b40001          LDRH     r0,[r4,#1]            ;80
0000a0  f3c00109          UBFX     r1,r0,#0,#10          ;80
0000a4  4628              MOV      r0,r5                 ;80
0000a6  f7fffffe          BL       UART2_send_pack
0000aa  e008              B        |L1.190|
0000ac  f8b40001          LDRH     r0,[r4,#1]            ;85
0000b0  f3c00109          UBFX     r1,r0,#0,#10          ;85
0000b4  4628              MOV      r0,r5                 ;85
0000b6  f7fffffe          BL       UART3_send_pack
0000ba  e000              B        |L1.190|
                  |L1.188|
0000bc  bf00              NOP                            ;89
                  |L1.190|
0000be  bf00              NOP                            ;55
0000c0  bf00              NOP      
0000c2  e7a7              B        |L1.20|
;;;92     
                          ENDP

                  cmd_handler_init_header_v1 PROC
;;;93     void cmd_handler_init_header_v1( uint8_t *p_buf, uint16_t len )
0000c4  b570              PUSH     {r4-r6,lr}
;;;94     {
0000c6  460c              MOV      r4,r1
;;;95     	cmd_header_v1_t *p_cmd = ( cmd_header_v1_t * )p_buf;
0000c8  4601              MOV      r1,r0
;;;96     	
;;;97     	uint8_t tmp0 = p_cmd->sender.sender_index;
0000ca  790d              LDRB     r5,[r1,#4]
0000cc  096a              LSRS     r2,r5,#5
;;;98     	uint8_t tmp1 = p_cmd->sender.sender_id;
0000ce  790d              LDRB     r5,[r1,#4]
0000d0  f005031f          AND      r3,r5,#0x1f
;;;99     	
;;;100    	p_cmd->sender.sender_index = p_cmd->receiver.receiver_index;
0000d4  794d              LDRB     r5,[r1,#5]
0000d6  096e              LSRS     r6,r5,#5
0000d8  790d              LDRB     r5,[r1,#4]
0000da  f3661547          BFI      r5,r6,#5,#3
0000de  710d              STRB     r5,[r1,#4]
;;;101    	p_cmd->sender.sender_id = p_cmd->receiver.receiver_id;
0000e0  794d              LDRB     r5,[r1,#5]
0000e2  790e              LDRB     r6,[r1,#4]
0000e4  f3650604          BFI      r6,r5,#0,#5
0000e8  710e              STRB     r6,[r1,#4]
;;;102    	p_cmd->receiver.receiver_index = tmp0;
0000ea  794d              LDRB     r5,[r1,#5]
0000ec  f3621547          BFI      r5,r2,#5,#3
0000f0  714d              STRB     r5,[r1,#5]
;;;103    	p_cmd->receiver.receiver_id = tmp1;
0000f2  794d              LDRB     r5,[r1,#5]
0000f4  f3630504          BFI      r5,r3,#0,#5
0000f8  714d              STRB     r5,[r1,#5]
;;;104    	
;;;105    	p_cmd->type.cmd_type = 1;
0000fa  7a0d              LDRB     r5,[r1,#8]
0000fc  f0250580          BIC      r5,r5,#0x80
000100  3580              ADDS     r5,r5,#0x80
000102  720d              STRB     r5,[r1,#8]
;;;106    	p_cmd->type.cmd_ack = 0;
000104  7a0d              LDRB     r5,[r1,#8]
000106  f0250560          BIC      r5,r5,#0x60
00010a  720d              STRB     r5,[r1,#8]
;;;107    }
00010c  bd70              POP      {r4-r6,pc}
;;;108    
                          ENDP

                  cmd_headler_send_command_v0 PROC
;;;109    void cmd_headler_send_command_v0( uint8_t *p_buf, uint16_t len )
00010e  b570              PUSH     {r4-r6,lr}
;;;110    {
000110  4605              MOV      r5,r0
000112  460e              MOV      r6,r1
;;;111    	cmd_header_v0_t *p_cmd = ( cmd_header_v0_t * )p_buf;
000114  462c              MOV      r4,r5
;;;112    	if( p_cmd->vl.length != len ) return;
000116  f8b40001          LDRH     r0,[r4,#1]
00011a  f3c00009          UBFX     r0,r0,#0,#10
00011e  42b0              CMP      r0,r6
000120  d000              BEQ      |L1.292|
                  |L1.290|
;;;113    	Append_CRC8_Check_Sum( p_buf, 4 );
;;;114    	Append_CRC16_Check_Sum( p_buf, p_cmd->vl.length );
;;;115    
;;;116    	    switch( g_cfg_end_point ) {
;;;117    #if __USB_ENABLE__
;;;118        case EP_USB:
;;;119            VCOM_sendpackage( ( const char * )p_buf, p_cmd->vl.length );
;;;120            break;
;;;121    #endif    
;;;122    #if __CAN1_ENABLE__
;;;123        case EP_CAN1:
;;;124            CAN_sendbytes_View( LPC_CAN1, &can1TxRingBuf, p_buf, p_cmd->vl.length );
;;;125            break;
;;;126    #endif
;;;127    #if __CAN2_ENABLE__
;;;128        case EP_CAN2:
;;;129            CAN_sendbytes_View( LPC_CAN2, &can2TxRingBuf, p_buf, p_cmd->vl.length );
;;;130            break;
;;;131    #endif
;;;132    #if __UART0_ENABLE__
;;;133    		case EP_UART0:
;;;134    				UART0_send_pack( p_buf , p_cmd->vl.length );
;;;135    			break ;
;;;136    #endif
;;;137    #if __UART1_ENABLE__
;;;138    		case EP_UART1:
;;;139    				UART1_send_pack( p_buf , p_cmd->vl.length );
;;;140    			break ;
;;;141    #endif
;;;142    #if __UART3_ENABLE__
;;;143    		case EP_UART3:
;;;144    				UART3_send_pack( p_buf , p_cmd->vl.length );
;;;145    			break ;
;;;146    #endif
;;;147        default:
;;;148            break;
;;;149        }
;;;150    }
000122  bd70              POP      {r4-r6,pc}
                  |L1.292|
000124  2104              MOVS     r1,#4                 ;113
000126  4628              MOV      r0,r5                 ;113
000128  f7fffffe          BL       Append_CRC8_Check_Sum
00012c  f8b40001          LDRH     r0,[r4,#1]            ;114
000130  f3c00109          UBFX     r1,r0,#0,#10          ;114
000134  4628              MOV      r0,r5                 ;114
000136  f7fffffe          BL       Append_CRC16_Check_Sum
00013a  48bb              LDR      r0,|L1.1064|
00013c  6800              LDR      r0,[r0,#0]            ;116  ; g_cfg_end_point
00013e  2801              CMP      r0,#1                 ;116
000140  d006              BEQ      |L1.336|
000142  2804              CMP      r0,#4                 ;116
000144  d00e              BEQ      |L1.356|
000146  2805              CMP      r0,#5                 ;116
000148  d014              BEQ      |L1.372|
00014a  2807              CMP      r0,#7                 ;116
00014c  d122              BNE      |L1.404|
00014e  e019              B        |L1.388|
                  |L1.336|
000150  f8b40001          LDRH     r0,[r4,#1]            ;124
000154  f3c00309          UBFX     r3,r0,#0,#10          ;124
000158  462a              MOV      r2,r5                 ;124
00015a  49b7              LDR      r1,|L1.1080|
00015c  48b4              LDR      r0,|L1.1072|
00015e  f7fffffe          BL       CAN_sendbytes_View
000162  e018              B        |L1.406|
                  |L1.356|
000164  f8b40001          LDRH     r0,[r4,#1]            ;134
000168  f3c00109          UBFX     r1,r0,#0,#10          ;134
00016c  4628              MOV      r0,r5                 ;134
00016e  f7fffffe          BL       UART0_send_pack
000172  e010              B        |L1.406|
                  |L1.372|
000174  f8b40001          LDRH     r0,[r4,#1]            ;139
000178  f3c00109          UBFX     r1,r0,#0,#10          ;139
00017c  4628              MOV      r0,r5                 ;139
00017e  f7fffffe          BL       UART1_send_pack
000182  e008              B        |L1.406|
                  |L1.388|
000184  f8b40001          LDRH     r0,[r4,#1]            ;144
000188  f3c00109          UBFX     r1,r0,#0,#10          ;144
00018c  4628              MOV      r0,r5                 ;144
00018e  f7fffffe          BL       UART3_send_pack
000192  e000              B        |L1.406|
                  |L1.404|
000194  bf00              NOP                            ;148
                  |L1.406|
000196  bf00              NOP                            ;125
000198  bf00              NOP      
00019a  e7c2              B        |L1.290|
;;;151    
                          ENDP

                  cmd_handler_device_info PROC
;;;152    uint32_t debug_foc_version = 0;
;;;153    void cmd_handler_device_info( uint8_t *p_buf, uint16_t len )
00019c  e92d41f0          PUSH     {r4-r8,lr}
;;;154    {
0001a0  4606              MOV      r6,r0
0001a2  460f              MOV      r7,r1
;;;155      uint8_t result = 0;
0001a4  f04f0800          MOV      r8,#0
;;;156    	cmd_header_v1_t *p_cmd = ( cmd_header_v1_t * )p_buf;
0001a8  4635              MOV      r5,r6
;;;157    	cmd_device_info_ack_t *p_info = ( cmd_device_info_ack_t * )( p_buf + sizeof( cmd_header_v1_t ) );
0001aa  f106040b          ADD      r4,r6,#0xb
;;;158    	
;;;159    	if( p_cmd->type.cmd_type == 0 ){
0001ae  7a28              LDRB     r0,[r5,#8]
0001b0  09c0              LSRS     r0,r0,#7
0001b2  2800              CMP      r0,#0
0001b4  d13b              BNE      |L1.558|
;;;160    		p_info->command_version.major = 0;
0001b6  7860              LDRB     r0,[r4,#1]
0001b8  f02000f0          BIC      r0,r0,#0xf0
0001bc  7060              STRB     r0,[r4,#1]
;;;161    		p_info->command_version.minor = 1;
0001be  7860              LDRB     r0,[r4,#1]
0001c0  f020000f          BIC      r0,r0,#0xf
0001c4  1c40              ADDS     r0,r0,#1
0001c6  7060              STRB     r0,[r4,#1]
;;;162    		
;;;163    	 hardware_id_read_flash( p_info->hardware_ver, 16 );
0001c8  2110              MOVS     r1,#0x10
0001ca  1ca0              ADDS     r0,r4,#2
0001cc  f7fffffe          BL       hardware_id_read_flash
;;;164    		p_info->loader_ver = sbl_get_loader_version();
0001d0  f7fffffe          BL       sbl_get_loader_version
0001d4  f8c40012          STR      r0,[r4,#0x12]
;;;165    			if( p_info->loader_ver == 0xFFFFFFFF ) {
0001d8  f8d40012          LDR      r0,[r4,#0x12]
0001dc  1c40              ADDS     r0,r0,#1
0001de  b908              CBNZ     r0,|L1.484|
;;;166    					result = 0xFF;
0001e0  f04f08ff          MOV      r8,#0xff
                  |L1.484|
;;;167    			}
;;;168    
;;;169    		p_info->firmware_ver = ArgBoardFirmwareVersion;
0001e4  4895              LDR      r0,|L1.1084|
0001e6  f8c40016          STR      r0,[r4,#0x16]
;;;170    		p_info->command_set = 0x00000001;
0001ea  2001              MOVS     r0,#1
0001ec  f8c4001a          STR      r0,[r4,#0x1a]
;;;171    
;;;172    		if( p_cmd->type.cmd_ack != 0 ) {
0001f0  7a28              LDRB     r0,[r5,#8]
0001f2  f3c01041          UBFX     r0,r0,#5,#2
0001f6  2800              CMP      r0,#0
0001f8  d030              BEQ      |L1.604|
;;;173    			cmd_handler_init_header_v1( p_buf, len );
0001fa  4639              MOV      r1,r7
0001fc  4630              MOV      r0,r6
0001fe  f7fffffe          BL       cmd_handler_init_header_v1
;;;174    			
;;;175    			p_cmd->vl.length = sizeof( cmd_header_v1_t ) + sizeof( cmd_device_info_ack_t ) + 2;
000202  f8350f01          LDRH     r0,[r5,#1]!
000206  f36f0009          BFC      r0,#0,#10
00020a  302b              ADDS     r0,r0,#0x2b
00020c  8028              STRH     r0,[r5,#0]
;;;176    			p_info->result = result;
00020e  f8848000          STRB     r8,[r4,#0]
;;;177    
;;;178    			cmd_headler_send_command_v1( p_buf, p_cmd->vl.length );
000212  f8350901          LDRH     r0,[r5],#-1
000216  f3c00109          UBFX     r1,r0,#0,#10
00021a  4630              MOV      r0,r6
00021c  f7fffffe          BL       cmd_headler_send_command_v1
;;;179                
;;;180                uart_printf( 0 ,"send ack:%d\r\n",g_current_tick);
000220  4887              LDR      r0,|L1.1088|
000222  6802              LDR      r2,[r0,#0]  ; g_current_tick
000224  a187              ADR      r1,|L1.1092|
000226  2000              MOVS     r0,#0
000228  f7fffffe          BL       uart_printf
00022c  e016              B        |L1.604|
                  |L1.558|
;;;181    		}
;;;182    	}else if( p_cmd->type.cmd_type == 1 ){
00022e  7a28              LDRB     r0,[r5,#8]
000230  2101              MOVS     r1,#1
000232  ebb11fd0          CMP      r1,r0,LSR #7
000236  d111              BNE      |L1.604|
;;;183    		//如果是电调回应的
;;;184    		if( p_cmd->sender.sender_id == 12 && ( p_cmd->sender.sender_index == 0x07 )){
000238  7928              LDRB     r0,[r5,#4]
00023a  f000001f          AND      r0,r0,#0x1f
00023e  280c              CMP      r0,#0xc
000240  d10c              BNE      |L1.604|
000242  7928              LDRB     r0,[r5,#4]
000244  2107              MOVS     r1,#7
000246  ebb11f50          CMP      r1,r0,LSR #5
00024a  d107              BNE      |L1.604|
;;;185    			//判断得到的电调的版本号如果不是25，就认为不是本公司的电调，禁止启动
;;;186    			
;;;187    			 debug_foc_version  = p_info->firmware_ver;
00024c  f8d40016          LDR      r0,[r4,#0x16]
000250  4980              LDR      r1,|L1.1108|
000252  6008              STR      r0,[r1,#0]  ; debug_foc_version
;;;188    //			 if( ((p_info->firmware_ver & 0x0000ff00)>>8) == 25 ){
;;;189    //						g_MotorCheckFlag = 1;
;;;190    			 uart_printf( 0 ,"fcc ver success\r\n" );
000254  a180              ADR      r1,|L1.1112|
000256  2000              MOVS     r0,#0
000258  f7fffffe          BL       uart_printf
                  |L1.604|
;;;191    //			 }else{
;;;192    //					uart_printf( 0 ,"fcc ver error\r\n" );
;;;193    //			 }
;;;194    		}
;;;195    	}
;;;196    }
00025c  e8bd81f0          POP      {r4-r8,pc}
;;;197    
                          ENDP

                  cmd_handler_entry_upgrade PROC
;;;198    void cmd_handler_entry_upgrade( uint8_t *p_buf, uint16_t len )
000260  e92d47f0          PUSH     {r4-r10,lr}
;;;199    {
000264  4605              MOV      r5,r0
000266  460e              MOV      r6,r1
;;;200    	uint8_t result = 0;
000268  2700              MOVS     r7,#0
;;;201    	uint32_t i = 0;
00026a  46b8              MOV      r8,r7
;;;202    	cmd_header_v1_t *p_cmd = ( cmd_header_v1_t * )p_buf;
00026c  462c              MOV      r4,r5
;;;203    	cmd_entry_upgrade_req_t *p_eur = ( cmd_entry_upgrade_req_t * )( p_buf + sizeof( cmd_header_v1_t ) );
00026e  f105090b          ADD      r9,r5,#0xb
;;;204    	cmd_entry_upgrade_ack_t *p_eua = ( cmd_entry_upgrade_ack_t * )( p_buf + sizeof( cmd_header_v1_t ) );
000272  46ca              MOV      r10,r9
;;;205    	
;;;206    	if( p_eur->encrypt != 0 ) return;
000274  f8990000          LDRB     r0,[r9,#0]
000278  b108              CBZ      r0,|L1.638|
                  |L1.634|
;;;207    	
;;;208    	if( p_cmd->type.cmd_ack != 0 ) {
;;;209    		cmd_handler_init_header_v1( p_buf, len );
;;;210    		
;;;211    		erase_programming_done_flag();// 擦除标志位
;;;212    		if( *( ( uint32_t * )PROGRAM_FLAG_ADDR ) == 0x0 )
;;;213    		{
;;;214    			p_cmd->vl.length = sizeof( cmd_header_v1_t ) + sizeof( cmd_entry_upgrade_ack_t ) + 2;
;;;215    			p_eua->result = result;
;;;216    			cmd_headler_send_command_v1( p_buf, p_cmd->vl.length );	
;;;217    			uart_printf(0,"enter upgrade\r\n");
;;;218    			i = 50000;
;;;219    			while(i--);
;;;220    			WDT_Feed();  /*看门狗溢出时间同步*/
;;;221    			//关中断,停止喂狗,看门狗复位进入bootloader模式
;;;222    			while(1);
;;;223    		}
;;;224    	}
;;;225    }
00027a  e8bd87f0          POP      {r4-r10,pc}
                  |L1.638|
00027e  7a20              LDRB     r0,[r4,#8]            ;208
000280  f3c01041          UBFX     r0,r0,#5,#2           ;208
000284  b338              CBZ      r0,|L1.726|
000286  4631              MOV      r1,r6                 ;209
000288  4628              MOV      r0,r5                 ;209
00028a  f7fffffe          BL       cmd_handler_init_header_v1
00028e  f7fffffe          BL       erase_programming_done_flag
000292  f44f4000          MOV      r0,#0x8000            ;212
000296  6800              LDR      r0,[r0,#0]            ;212
000298  b9e8              CBNZ     r0,|L1.726|
00029a  f8340f01          LDRH     r0,[r4,#1]!           ;214
00029e  f36f0009          BFC      r0,#0,#10             ;214
0002a2  300e              ADDS     r0,r0,#0xe            ;214
0002a4  8020              STRH     r0,[r4,#0]            ;214
0002a6  f88a7000          STRB     r7,[r10,#0]           ;215
0002aa  8820              LDRH     r0,[r4,#0]            ;216
0002ac  f3c00109          UBFX     r1,r0,#0,#10          ;216
0002b0  4628              MOV      r0,r5                 ;216
0002b2  f7fffffe          BL       cmd_headler_send_command_v1
0002b6  a16d              ADR      r1,|L1.1132|
0002b8  2000              MOVS     r0,#0                 ;217
0002ba  f7fffffe          BL       uart_printf
0002be  f24c3850          MOV      r8,#0xc350            ;218
0002c2  bf00              NOP                            ;219
                  |L1.708|
0002c4  f1b80000          SUBS     r0,r8,#0              ;219
0002c8  f1a80801          SUB      r8,r8,#1              ;219
0002cc  d1fa              BNE      |L1.708|
0002ce  f7fffffe          BL       WDT_Feed
0002d2  bf00              NOP                            ;222
                  |L1.724|
0002d4  e7fe              B        |L1.724|
                  |L1.726|
0002d6  bf00              NOP      
0002d8  e7cf              B        |L1.634|
;;;226    
                          ENDP

                  cmd_handler_start_upgrade PROC
;;;227    void cmd_handler_start_upgrade( uint8_t *p_buf, uint16_t len )
0002da  e92d47f0          PUSH     {r4-r10,lr}
;;;228    {
0002de  4605              MOV      r5,r0
0002e0  4688              MOV      r8,r1
;;;229    	uint8_t result = 0;
0002e2  f04f0900          MOV      r9,#0
;;;230    	cmd_header_v1_t *p_cmd = ( cmd_header_v1_t * )p_buf;
0002e6  462c              MOV      r4,r5
;;;231    	cmd_start_upgrade_req_t *p_sur = ( cmd_start_upgrade_req_t * )( p_buf + sizeof( cmd_header_v1_t ) );
0002e8  f105060b          ADD      r6,r5,#0xb
;;;232    	cmd_start_upgrade_ack_t *p_sua = ( cmd_start_upgrade_ack_t * )( p_buf + sizeof( cmd_header_v1_t ) );
0002ec  4637              MOV      r7,r6
;;;233    	
;;;234    	if( p_sur->encrypt != 0 ) return;
0002ee  7830              LDRB     r0,[r6,#0]
0002f0  b108              CBZ      r0,|L1.758|
                  |L1.754|
;;;235    	
;;;236    	if( p_sur->firmware_size > USER_FLASH_END - USER_FLASH_START ) {
;;;237    		result = 0xF1;
;;;238    	} else {
;;;239    		cfg_package_index_front = -1;
;;;240    		cfg_write_offset = 0;
;;;241    		cfg_file_size = p_sur->firmware_size;
;;;242    		
;;;243    		aesDecInit();
;;;244    		if( !erase_user_area() ) {
;;;245    			result = 0xF3;
;;;246    		}
;;;247    	}
;;;248    
;;;249    	if( p_cmd->type.cmd_ack != 0 ) {
;;;250    		cmd_handler_init_header_v1( p_buf, len );
;;;251    		
;;;252    		p_cmd->vl.length = sizeof( cmd_header_v1_t ) + sizeof( cmd_start_upgrade_ack_t ) + 2;
;;;253    		p_sua->result = result;
;;;254    		p_sua->data_size = 256;
;;;255    		
;;;256    		cmd_headler_send_command_v1( p_buf, p_cmd->vl.length );
;;;257    	}
;;;258    }
0002f2  e8bd87f0          POP      {r4-r10,pc}
                  |L1.758|
0002f6  4861              LDR      r0,|L1.1148|
0002f8  6d00              LDR      r0,[r0,#0x50]         ;236  ; sector_end_map
0002fa  4961              LDR      r1,|L1.1152|
0002fc  6a89              LDR      r1,[r1,#0x28]         ;236  ; sector_start_map
0002fe  1a40              SUBS     r0,r0,r1              ;236
000300  f8d61001          LDR      r1,[r6,#1]            ;236
000304  4288              CMP      r0,r1                 ;236
000306  d202              BCS      |L1.782|
000308  f04f09f1          MOV      r9,#0xf1              ;237
00030c  e011              B        |L1.818|
                  |L1.782|
00030e  f04f30ff          MOV      r0,#0xffffffff        ;239
000312  495c              LDR      r1,|L1.1156|
000314  6008              STR      r0,[r1,#0]            ;239  ; cfg_package_index_front
000316  2000              MOVS     r0,#0                 ;240
000318  495b              LDR      r1,|L1.1160|
00031a  6008              STR      r0,[r1,#0]            ;240  ; cfg_write_offset
00031c  f8d60001          LDR      r0,[r6,#1]            ;241
000320  495a              LDR      r1,|L1.1164|
000322  6008              STR      r0,[r1,#0]            ;241  ; cfg_file_size
000324  f7fffffe          BL       aesDecInit
000328  f7fffffe          BL       erase_user_area
00032c  b908              CBNZ     r0,|L1.818|
00032e  f04f09f3          MOV      r9,#0xf3              ;245
                  |L1.818|
000332  7a20              LDRB     r0,[r4,#8]            ;249
000334  f3c01041          UBFX     r0,r0,#5,#2           ;249
000338  b1b0              CBZ      r0,|L1.872|
00033a  4641              MOV      r1,r8                 ;250
00033c  4628              MOV      r0,r5                 ;250
00033e  f7fffffe          BL       cmd_handler_init_header_v1
000342  f8340f01          LDRH     r0,[r4,#1]!           ;252
000346  f36f0009          BFC      r0,#0,#10             ;252
00034a  3010              ADDS     r0,r0,#0x10           ;252
00034c  8020              STRH     r0,[r4,#0]            ;252
00034e  f8879000          STRB     r9,[r7,#0]            ;253
000352  f44f7080          MOV      r0,#0x100             ;254
000356  f8a70001          STRH     r0,[r7,#1]            ;254
00035a  f8340901          LDRH     r0,[r4],#-1           ;256
00035e  f3c00109          UBFX     r1,r0,#0,#10          ;256
000362  4628              MOV      r0,r5                 ;256
000364  f7fffffe          BL       cmd_headler_send_command_v1
                  |L1.872|
000368  bf00              NOP      
00036a  e7c2              B        |L1.754|
;;;259    
                          ENDP

                  cmd_handler_data_upgrade PROC
;;;260    void cmd_handler_data_upgrade( uint8_t *p_buf, uint16_t len )
00036c  e92d47f0          PUSH     {r4-r10,lr}
;;;261    {
000370  4606              MOV      r6,r0
000372  4689              MOV      r9,r1
;;;262    	uint8_t result = 0;
000374  f04f0800          MOV      r8,#0
;;;263    	cmd_header_v1_t *p_cmd = ( cmd_header_v1_t * )p_buf;
000378  4635              MOV      r5,r6
;;;264    	cmd_data_upgrade_req_t *p_dur = ( cmd_data_upgrade_req_t * )( p_buf + sizeof( cmd_header_v1_t ) );
00037a  f106040b          ADD      r4,r6,#0xb
;;;265    	cmd_data_upgrade_ack_t *p_dua = ( cmd_data_upgrade_ack_t * )( p_buf + sizeof( cmd_header_v1_t ) );
00037e  4627              MOV      r7,r4
;;;266    	
;;;267    	if( p_dur->encrypt != 0 && p_dur->encrypt != 1 ) return;
000380  7820              LDRB     r0,[r4,#0]
000382  b120              CBZ      r0,|L1.910|
000384  7820              LDRB     r0,[r4,#0]
000386  2801              CMP      r0,#1
000388  d001              BEQ      |L1.910|
                  |L1.906|
;;;268    	
;;;269    	if( p_dur->package_index != cfg_package_index_front + 1 ) 
;;;270    	{
;;;271    		result = 0xF0;
;;;272    	} 
;;;273    	else 
;;;274    	{ // write data to flash
;;;275    		if( p_dur->package_length != 256 ) {
;;;276    			result = 0xF7;
;;;277    		} 
;;;278    		else 
;;;279    		{
;;;280    			if( cfg_write_offset > cfg_file_size )
;;;281    			{
;;;282    					result = 0xF1;
;;;283    			} 
;;;284    			else 
;;;285    			{
;;;286    				memcpy( &tmpBuf[0], &p_dur->data[0], p_dur->package_length );
;;;287    				if( p_dur->encrypt == 1 )
;;;288    				{
;;;289    					aesDecryptBlock( &tmpBuf[0], p_dur->package_length );
;;;290    				}
;;;291    				
;;;292    				if( write_flash( ( uint32_t * )( USER_FLASH_START + cfg_write_offset ), &tmpBuf[0], p_dur->package_length ) != 0 ) {
;;;293    					result = 0xF4;
;;;294    				}	
;;;295    				
;;;296    				if( !compare_data( ( uint32_t )( USER_FLASH_START + cfg_write_offset ), ( uint32_t )&tmpBuf[0], p_dur->package_length ) ) {
;;;297    					result = 0xF4;
;;;298    				}
;;;299    				
;;;300    				if( result == 0 ) {
;;;301    					cfg_write_offset += p_dur->package_length;
;;;302    					cfg_package_index_front += 1;
;;;303    				}
;;;304    			}
;;;305    		}
;;;306    	}
;;;307    	
;;;308    	if( p_cmd->type.cmd_ack != 0 ) {
;;;309    		cmd_handler_init_header_v1( p_buf, len );
;;;310    	
;;;311    		p_cmd->vl.length = sizeof( cmd_header_v1_t ) + sizeof( cmd_data_upgrade_ack_t ) + 2;
;;;312    		p_dua->result = result;
;;;313    		if( p_dua->result != 0 ) {
;;;314    			p_dua->package_index = cfg_package_index_front;
;;;315    		}
;;;316    	
;;;317    		cmd_headler_send_command_v1( p_buf, p_cmd->vl.length );
;;;318    	}
;;;319    }
00038a  e8bd87f0          POP      {r4-r10,pc}
                  |L1.910|
00038e  f8d41001          LDR      r1,[r4,#1]            ;269
000392  483c              LDR      r0,|L1.1156|
000394  6800              LDR      r0,[r0,#0]            ;269  ; cfg_package_index_front
000396  1c40              ADDS     r0,r0,#1              ;269
000398  4281              CMP      r1,r0                 ;269
00039a  d002              BEQ      |L1.930|
00039c  f04f08f0          MOV      r8,#0xf0              ;271
0003a0  e07e              B        |L1.1184|
                  |L1.930|
0003a2  f8b40005          LDRH     r0,[r4,#5]            ;275
0003a6  f5b07f80          CMP      r0,#0x100             ;275
0003aa  d002              BEQ      |L1.946|
0003ac  f04f08f7          MOV      r8,#0xf7              ;276
0003b0  e076              B        |L1.1184|
                  |L1.946|
0003b2  4835              LDR      r0,|L1.1160|
0003b4  6800              LDR      r0,[r0,#0]            ;280  ; cfg_write_offset
0003b6  4935              LDR      r1,|L1.1164|
0003b8  6809              LDR      r1,[r1,#0]            ;280  ; cfg_file_size
0003ba  4288              CMP      r0,r1                 ;280
0003bc  d902              BLS      |L1.964|
0003be  f04f08f1          MOV      r8,#0xf1              ;282
0003c2  e06d              B        |L1.1184|
                  |L1.964|
0003c4  f8b42005          LDRH     r2,[r4,#5]            ;286
0003c8  1de1              ADDS     r1,r4,#7              ;286
0003ca  4831              LDR      r0,|L1.1168|
0003cc  f7fffffe          BL       __aeabi_memcpy
0003d0  7820              LDRB     r0,[r4,#0]            ;287
0003d2  2801              CMP      r0,#1                 ;287
0003d4  d104              BNE      |L1.992|
0003d6  f8b41005          LDRH     r1,[r4,#5]            ;289
0003da  482d              LDR      r0,|L1.1168|
0003dc  f7fffffe          BL       aesDecryptBlock
                  |L1.992|
0003e0  f8b42005          LDRH     r2,[r4,#5]            ;292
0003e4  4926              LDR      r1,|L1.1152|
0003e6  6a89              LDR      r1,[r1,#0x28]         ;292  ; sector_start_map
0003e8  4b27              LDR      r3,|L1.1160|
0003ea  681b              LDR      r3,[r3,#0]            ;292  ; cfg_write_offset
0003ec  18c8              ADDS     r0,r1,r3              ;292
0003ee  4928              LDR      r1,|L1.1168|
0003f0  f7fffffe          BL       write_flash
0003f4  b108              CBZ      r0,|L1.1018|
0003f6  f04f08f4          MOV      r8,#0xf4              ;293
                  |L1.1018|
0003fa  f8b42005          LDRH     r2,[r4,#5]            ;296
0003fe  4920              LDR      r1,|L1.1152|
000400  6a89              LDR      r1,[r1,#0x28]         ;296  ; sector_start_map
000402  4b21              LDR      r3,|L1.1160|
000404  681b              LDR      r3,[r3,#0]            ;296  ; cfg_write_offset
000406  18c8              ADDS     r0,r1,r3              ;296
000408  4921              LDR      r1,|L1.1168|
00040a  f7fffffe          BL       compare_data
00040e  b908              CBNZ     r0,|L1.1044|
000410  f04f08f4          MOV      r8,#0xf4              ;297
                  |L1.1044|
000414  f1b80f00          CMP      r8,#0                 ;300
000418  d142              BNE      |L1.1184|
00041a  f8b40005          LDRH     r0,[r4,#5]            ;301
00041e  491a              LDR      r1,|L1.1160|
000420  6809              LDR      r1,[r1,#0]            ;301  ; cfg_write_offset
000422  4408              ADD      r0,r0,r1              ;301
000424  4918              LDR      r1,|L1.1160|
000426  e035              B        |L1.1172|
                  |L1.1064|
                          DCD      g_cfg_end_point
                  |L1.1068|
                          DCD      can1Tx3RingBuf
                  |L1.1072|
                          DCD      0x40044000
                  |L1.1076|
                          DCD      can1LEDTxRingBuf
                  |L1.1080|
                          DCD      can1TxRingBuf
                  |L1.1084|
                          DCD      0x010407ff
                  |L1.1088|
                          DCD      g_current_tick
                  |L1.1092|
000444  73656e64          DCB      "send ack:%d\r\n",0
000448  2061636b
00044c  3a25640d
000450  0a00    
000452  00                DCB      0
000453  00                DCB      0
                  |L1.1108|
                          DCD      debug_foc_version
                  |L1.1112|
000458  66636320          DCB      "fcc ver success\r\n",0
00045c  76657220
000460  73756363
000464  6573730d
000468  0a00    
00046a  00                DCB      0
00046b  00                DCB      0
                  |L1.1132|
00046c  656e7465          DCB      "enter upgrade\r\n",0
000470  72207570
000474  67726164
000478  650d0a00
                  |L1.1148|
                          DCD      sector_end_map
                  |L1.1152|
                          DCD      sector_start_map
                  |L1.1156|
                          DCD      cfg_package_index_front
                  |L1.1160|
                          DCD      cfg_write_offset
                  |L1.1164|
                          DCD      cfg_file_size
                  |L1.1168|
                          DCD      tmpBuf
                  |L1.1172|
000494  6008              STR      r0,[r1,#0]            ;301  ; cfg_write_offset
000496  48f7              LDR      r0,|L1.2164|
000498  6800              LDR      r0,[r0,#0]            ;302  ; cfg_package_index_front
00049a  1c40              ADDS     r0,r0,#1              ;302
00049c  49f5              LDR      r1,|L1.2164|
00049e  6008              STR      r0,[r1,#0]            ;302  ; cfg_package_index_front
                  |L1.1184|
0004a0  7a28              LDRB     r0,[r5,#8]            ;308
0004a2  f3c01041          UBFX     r0,r0,#5,#2           ;308
0004a6  b1c8              CBZ      r0,|L1.1244|
0004a8  4649              MOV      r1,r9                 ;309
0004aa  4630              MOV      r0,r6                 ;309
0004ac  f7fffffe          BL       cmd_handler_init_header_v1
0004b0  f8b50001          LDRH     r0,[r5,#1]            ;311
0004b4  f36f0009          BFC      r0,#0,#10             ;311
0004b8  3012              ADDS     r0,r0,#0x12           ;311
0004ba  f8a50001          STRH     r0,[r5,#1]            ;311
0004be  f8878000          STRB     r8,[r7,#0]            ;312
0004c2  7838              LDRB     r0,[r7,#0]            ;313
0004c4  b118              CBZ      r0,|L1.1230|
0004c6  48eb              LDR      r0,|L1.2164|
0004c8  6800              LDR      r0,[r0,#0]            ;314  ; cfg_package_index_front
0004ca  f8c70001          STR      r0,[r7,#1]            ;314
                  |L1.1230|
0004ce  f8b50001          LDRH     r0,[r5,#1]            ;317
0004d2  f3c00109          UBFX     r1,r0,#0,#10          ;317
0004d6  4630              MOV      r0,r6                 ;317
0004d8  f7fffffe          BL       cmd_headler_send_command_v1
                  |L1.1244|
0004dc  bf00              NOP      
0004de  e754              B        |L1.906|
;;;320    
                          ENDP

                  cmd_handler_end_upgrade PROC
;;;321    void cmd_handler_end_upgrade( uint8_t *p_buf, uint16_t len )
0004e0  e92d47ff          PUSH     {r0-r10,lr}
;;;322    {
0004e4  4606              MOV      r6,r0
0004e6  4688              MOV      r8,r1
;;;323    	uint8_t result = 0, md5Digest[16], i = 0;
0004e8  f04f0900          MOV      r9,#0
0004ec  2500              MOVS     r5,#0
;;;324    	cmd_header_v1_t *p_cmd = ( cmd_header_v1_t * )p_buf;
0004ee  4634              MOV      r4,r6
;;;325    	cmd_end_upgrade_req_t *p_eur = ( cmd_end_upgrade_req_t * )( p_buf + sizeof( cmd_header_v1_t ) );
0004f0  f106070b          ADD      r7,r6,#0xb
;;;326    	cmd_end_upgrade_ack_t *p_eua = ( cmd_end_upgrade_ack_t * )( p_buf + sizeof( cmd_header_v1_t ) );
0004f4  46ba              MOV      r10,r7
;;;327    	
;;;328    	if( p_eur->encrypt != 0 ) return;
0004f6  7838              LDRB     r0,[r7,#0]
0004f8  b108              CBZ      r0,|L1.1278|
                  |L1.1274|
;;;329    	
;;;330    	MD5Init( &md5 );
;;;331    	MD5Update( &md5, ( uint8_t * )USER_FLASH_START, cfg_file_size );
;;;332    	MD5Final( &md5, (void *)md5Digest );
;;;333    
;;;334    	for( i = 0; i < 16; i++ ) {
;;;335    		if( md5Digest[i] != p_eur->md5[i] ) {
;;;336    			result = 0xF2;
;;;337    			break;
;;;338    		}
;;;339    	}
;;;340    
;;;341    	if( i == 16 ) {
;;;342    		write_programming_done_flag();
;;;343    	}
;;;344    
;;;345    	if( p_cmd->type.cmd_ack != 0 ) {
;;;346    		cmd_handler_init_header_v1( p_buf, len );
;;;347    
;;;348    		p_cmd->vl.length = sizeof( cmd_header_v1_t ) + sizeof( cmd_end_upgrade_ack_t ) + 2;
;;;349    		p_eua->result = result;
;;;350    	
;;;351    		cmd_headler_send_command_v1( p_buf, p_cmd->vl.length );
;;;352    	}
;;;353    }
0004fa  e8bd87ff          POP      {r0-r10,pc}
                  |L1.1278|
0004fe  48de              LDR      r0,|L1.2168|
000500  f7fffffe          BL       MD5Init
000504  48dd              LDR      r0,|L1.2172|
000506  6a81              LDR      r1,[r0,#0x28]         ;331  ; sector_start_map
000508  48dd              LDR      r0,|L1.2176|
00050a  6802              LDR      r2,[r0,#0]            ;331  ; cfg_file_size
00050c  48da              LDR      r0,|L1.2168|
00050e  f7fffffe          BL       MD5Update
000512  4669              MOV      r1,sp                 ;332
000514  48d8              LDR      r0,|L1.2168|
000516  f7fffffe          BL       MD5Final
00051a  2500              MOVS     r5,#0                 ;334
00051c  e00a              B        |L1.1332|
                  |L1.1310|
00051e  f81d1005          LDRB     r1,[sp,r5]            ;335
000522  1c78              ADDS     r0,r7,#1              ;335
000524  5d40              LDRB     r0,[r0,r5]            ;335
000526  4281              CMP      r1,r0                 ;335
000528  d002              BEQ      |L1.1328|
00052a  f04f09f2          MOV      r9,#0xf2              ;336
00052e  e003              B        |L1.1336|
                  |L1.1328|
000530  1c68              ADDS     r0,r5,#1              ;334
000532  b2c5              UXTB     r5,r0                 ;334
                  |L1.1332|
000534  2d10              CMP      r5,#0x10              ;334
000536  dbf2              BLT      |L1.1310|
                  |L1.1336|
000538  bf00              NOP                            ;337
00053a  2d10              CMP      r5,#0x10              ;341
00053c  d101              BNE      |L1.1346|
00053e  f7fffffe          BL       write_programming_done_flag
                  |L1.1346|
000542  7a20              LDRB     r0,[r4,#8]            ;345
000544  f3c01041          UBFX     r0,r0,#5,#2           ;345
000548  b190              CBZ      r0,|L1.1392|
00054a  4641              MOV      r1,r8                 ;346
00054c  4630              MOV      r0,r6                 ;346
00054e  f7fffffe          BL       cmd_handler_init_header_v1
000552  f8340f01          LDRH     r0,[r4,#1]!           ;348
000556  f36f0009          BFC      r0,#0,#10             ;348
00055a  300e              ADDS     r0,r0,#0xe            ;348
00055c  8020              STRH     r0,[r4,#0]            ;348
00055e  f88a9000          STRB     r9,[r10,#0]           ;349
000562  f8340901          LDRH     r0,[r4],#-1           ;351
000566  f3c00109          UBFX     r1,r0,#0,#10          ;351
00056a  4630              MOV      r0,r6                 ;351
00056c  f7fffffe          BL       cmd_headler_send_command_v1
                  |L1.1392|
000570  bf00              NOP      
000572  e7c2              B        |L1.1274|
;;;354    
                          ENDP

                  cmd_handler_reboot PROC
;;;355    void cmd_handler_reboot( uint8_t *p_buf, uint16_t len )
000574  e92d41f0          PUSH     {r4-r8,lr}
;;;356    {
000578  4605              MOV      r5,r0
00057a  460f              MOV      r7,r1
;;;357    	cmd_header_v1_t *p_cmd = ( cmd_header_v1_t * )p_buf;
00057c  462c              MOV      r4,r5
;;;358    	cmd_reboot_req_t *p_rr = ( cmd_reboot_req_t * )( p_buf + sizeof( cmd_header_v1_t ) );
00057e  f105060b          ADD      r6,r5,#0xb
;;;359    	cmd_reboot_ack_t *p_ra = ( cmd_reboot_ack_t * )( p_buf + sizeof( cmd_header_v1_t ) );
000582  46b0              MOV      r8,r6
;;;360    
;;;361        if( p_rr->type == 0 || p_rr->type == 1 ) { 
000584  7870              LDRB     r0,[r6,#1]
000586  b110              CBZ      r0,|L1.1422|
000588  7870              LDRB     r0,[r6,#1]
00058a  2801              CMP      r0,#1
00058c  d105              BNE      |L1.1434|
                  |L1.1422|
;;;362            WDT_UpdateTimeOut( p_rr->delay_ms );
00058e  f8d60002          LDR      r0,[r6,#2]
000592  f7fffffe          BL       WDT_UpdateTimeOut
;;;363            WDT_Lock();
000596  f7fffffe          BL       WDT_Lock
                  |L1.1434|
;;;364        }
;;;365    	
;;;366    	if( p_cmd->type.cmd_ack != 0 ) {
00059a  7a20              LDRB     r0,[r4,#8]
00059c  f3c01041          UBFX     r0,r0,#5,#2
0005a0  b198              CBZ      r0,|L1.1482|
;;;367    		cmd_handler_init_header_v1( p_buf, len );
0005a2  4639              MOV      r1,r7
0005a4  4628              MOV      r0,r5
0005a6  f7fffffe          BL       cmd_handler_init_header_v1
;;;368    	
;;;369    		p_cmd->vl.length = sizeof( cmd_header_v1_t ) + sizeof( cmd_reboot_ack_t ) + 2;
0005aa  f8340f01          LDRH     r0,[r4,#1]!
0005ae  f36f0009          BFC      r0,#0,#10
0005b2  300e              ADDS     r0,r0,#0xe
0005b4  8020              STRH     r0,[r4,#0]
;;;370    		p_ra->result = 0;
0005b6  2000              MOVS     r0,#0
0005b8  f8880000          STRB     r0,[r8,#0]
;;;371    	
;;;372    		cmd_headler_send_command_v1( p_buf, p_cmd->vl.length );
0005bc  f8340901          LDRH     r0,[r4],#-1
0005c0  f3c00109          UBFX     r1,r0,#0,#10
0005c4  4628              MOV      r0,r5
0005c6  f7fffffe          BL       cmd_headler_send_command_v1
                  |L1.1482|
;;;373    	}
;;;374    }
0005ca  e8bd81f0          POP      {r4-r8,pc}
;;;375    
                          ENDP

                  cmd_handler_status_report PROC
;;;376    void cmd_handler_status_report( uint8_t *p_buf, uint16_t len )
0005ce  e92d41f0          PUSH     {r4-r8,lr}
;;;377    {
0005d2  4606              MOV      r6,r0
0005d4  460f              MOV      r7,r1
;;;378    	cmd_header_v1_t *p_cmd = ( cmd_header_v1_t * )p_buf;
0005d6  4635              MOV      r5,r6
;;;379    //	cmd_status_report_req_t *p_srr = ( cmd_status_report_req_t * )( p_buf + sizeof( cmd_header_v1_t ) );
;;;380    	cmd_status_report_ack_t *p_sra = ( cmd_status_report_ack_t * )( p_buf + sizeof( cmd_header_v1_t ) );
0005d8  f106040b          ADD      r4,r6,#0xb
;;;381    	
;;;382    	if( p_cmd->type.cmd_ack != 0 ) {
0005dc  7a28              LDRB     r0,[r5,#8]
0005de  f3c01041          UBFX     r0,r0,#5,#2
0005e2  b328              CBZ      r0,|L1.1584|
;;;383    		cmd_handler_init_header_v1( p_buf, len );
0005e4  4639              MOV      r1,r7
0005e6  4630              MOV      r0,r6
0005e8  f7fffffe          BL       cmd_handler_init_header_v1
;;;384    	
;;;385    		p_cmd->vl.length = sizeof( cmd_header_v1_t ) + sizeof( cmd_status_report_ack_t ) + 2;
0005ec  f8b50001          LDRH     r0,[r5,#1]
0005f0  f36f0009          BFC      r0,#0,#10
0005f4  3013              ADDS     r0,r0,#0x13
0005f6  f8a50001          STRH     r0,[r5,#1]
;;;386    		p_sra->result = 0;
0005fa  2000              MOVS     r0,#0
0005fc  7020              STRB     r0,[r4,#0]
;;;387    		
;;;388    		p_sra->ver.major = 0;
0005fe  7860              LDRB     r0,[r4,#1]
000600  f02000f0          BIC      r0,r0,#0xf0
000604  7060              STRB     r0,[r4,#1]
;;;389    		p_sra->ver.minor = 0;
000606  7860              LDRB     r0,[r4,#1]
000608  f020000f          BIC      r0,r0,#0xf
00060c  7060              STRB     r0,[r4,#1]
;;;390    		
;;;391    		p_sra->status = g_device_status;
00060e  489d              LDR      r0,|L1.2180|
000610  6800              LDR      r0,[r0,#0]  ; g_device_status
000612  f8c40002          STR      r0,[r4,#2]
;;;392    		
;;;393    		{
;;;394    			uint8_t cnt ;
;;;395    		for( cnt = 1; cnt<5 ; cnt++ ){
000616  2001              MOVS     r0,#1
000618  e001              B        |L1.1566|
                  |L1.1562|
00061a  1c41              ADDS     r1,r0,#1
00061c  b2c8              UXTB     r0,r1
                  |L1.1566|
00061e  2805              CMP      r0,#5
000620  dbfb              BLT      |L1.1562|
;;;396    //			if( stFocSetAddr[cnt].access_flag != 0 ){
;;;397    //				MoterTogger(stFocSetAddr[cnt].id);
;;;398    //			}
;;;399    		}
;;;400    		}
;;;401    		
;;;402    		cmd_headler_send_command_v1( p_buf, p_cmd->vl.length );
000622  f8b50001          LDRH     r0,[r5,#1]
000626  f3c00109          UBFX     r1,r0,#0,#10
00062a  4630              MOV      r0,r6
00062c  f7fffffe          BL       cmd_headler_send_command_v1
                  |L1.1584|
;;;403    	}
;;;404    }
000630  e8bd81f0          POP      {r4-r8,pc}
;;;405    
                          ENDP

                  cmd_handler_set_version PROC
;;;406    void cmd_handler_set_version( uint8_t *p_buf, uint16_t len )
000634  e92d47f0          PUSH     {r4-r10,lr}
;;;407    {
000638  4606              MOV      r6,r0
00063a  460f              MOV      r7,r1
;;;408      uint8_t result = 0;
00063c  f04f0800          MOV      r8,#0
;;;409    	cmd_header_v1_t *p_cmd = ( cmd_header_v1_t * )p_buf;
000640  4634              MOV      r4,r6
;;;410    	cmd_set_version_req_t *p_svr = ( cmd_set_version_req_t * )( p_buf + sizeof( cmd_header_v1_t ) );
000642  f106090b          ADD      r9,r6,#0xb
;;;411    	cmd_set_version_ack_t *p_sva = ( cmd_set_version_ack_t * )( p_buf + sizeof( cmd_header_v1_t ) );
000646  464d              MOV      r5,r9
;;;412    	
;;;413        if( !hardware_id_write_flash( p_svr->hardware_ver, 16 ) ) {
000648  2110              MOVS     r1,#0x10
00064a  f1090001          ADD      r0,r9,#1
00064e  f7fffffe          BL       hardware_id_write_flash
000652  b908              CBNZ     r0,|L1.1624|
;;;414            result = 0xF4;
000654  f04f08f4          MOV      r8,#0xf4
                  |L1.1624|
;;;415        }
;;;416        
;;;417    	if( p_cmd->type.cmd_ack != 0 ) {
000658  7a20              LDRB     r0,[r4,#8]
00065a  f3c01041          UBFX     r0,r0,#5,#2
00065e  b1f0              CBZ      r0,|L1.1694|
;;;418    		cmd_handler_init_header_v1( p_buf, len );
000660  4639              MOV      r1,r7
000662  4630              MOV      r0,r6
000664  f7fffffe          BL       cmd_handler_init_header_v1
;;;419    	
;;;420    		p_cmd->vl.length = sizeof( cmd_header_v1_t ) + sizeof( cmd_set_version_ack_t ) + 2;
000668  f8340f01          LDRH     r0,[r4,#1]!
00066c  f36f0009          BFC      r0,#0,#10
000670  301f              ADDS     r0,r0,#0x1f
000672  8020              STRH     r0,[r4,#0]
;;;421    		p_sva->result = result;
000674  f8858000          STRB     r8,[r5,#0]
;;;422    		
;;;423    		p_sva->ver.major = 0;
000678  7868              LDRB     r0,[r5,#1]
00067a  f02000f0          BIC      r0,r0,#0xf0
00067e  7068              STRB     r0,[r5,#1]
;;;424    		p_sva->ver.minor = 0;
000680  7868              LDRB     r0,[r5,#1]
000682  f020000f          BIC      r0,r0,#0xf
000686  7068              STRB     r0,[r5,#1]
;;;425    		
;;;426            hardware_id_read_flash( p_sva->hardware_ver, 16 );
000688  2110              MOVS     r1,#0x10
00068a  1ca8              ADDS     r0,r5,#2
00068c  f7fffffe          BL       hardware_id_read_flash
;;;427    	
;;;428    		cmd_headler_send_command_v1( p_buf, p_cmd->vl.length );
000690  f8340901          LDRH     r0,[r4],#-1
000694  f3c00109          UBFX     r1,r0,#0,#10
000698  4630              MOV      r0,r6
00069a  f7fffffe          BL       cmd_headler_send_command_v1
                  |L1.1694|
;;;429    	}
;;;430    }
00069e  e8bd87f0          POP      {r4-r10,pc}
;;;431    
                          ENDP

                  cmd_hander_motor_process PROC
;;;432    uint8_t RecordKeyPress ;
;;;433    void cmd_hander_motor_process( uint8_t *p_buf, uint16_t len )
0006a2  e92d41f0          PUSH     {r4-r8,lr}
;;;434    {
0006a6  4604              MOV      r4,r0
0006a8  460f              MOV      r7,r1
;;;435    //	static uint32_t get_tick =0;
;;;436    //	uint8_t cnt ;
;;;437    	cmd_camera_remote_req_t *data  ;
;;;438    	cmd_header_v1_t *p_cmd = ( cmd_header_v1_t * )p_buf;
0006aa  4626              MOV      r6,r4
;;;439    	data = ( cmd_camera_remote_req_t * )((&p_cmd->id) + 1) ;
0006ac  f106050b          ADD      r5,r6,#0xb
;;;440    	//如果是录像按键按下了	
;;;441    	if( data->cmdtype == 2 )
0006b0  7828              LDRB     r0,[r5,#0]
0006b2  2802              CMP      r0,#2
0006b4  d107              BNE      |L1.1734|
;;;442    	{
;;;443    		RecordKeyPress = 1 ;
0006b6  2001              MOVS     r0,#1
0006b8  4973              LDR      r1,|L1.2184|
0006ba  7008              STRB     r0,[r1,#0]
;;;444    		uart_printf( 0 ,"carmer press\r\n" );
0006bc  a173              ADR      r1,|L1.2188|
0006be  2000              MOVS     r0,#0
0006c0  f7fffffe          BL       uart_printf
0006c4  e006              B        |L1.1748|
                  |L1.1734|
;;;445    	}
;;;446    	else if( data->cmdtype == 7 ){
0006c6  7828              LDRB     r0,[r5,#0]
0006c8  2807              CMP      r0,#7
0006ca  d103              BNE      |L1.1748|
;;;447    		uart_printf( 0 ,"carmer release\r\n" );
0006cc  a173              ADR      r1,|L1.2204|
0006ce  2000              MOVS     r0,#0
0006d0  f7fffffe          BL       uart_printf
                  |L1.1748|
;;;448    	}
;;;449    }
0006d4  e8bd81f0          POP      {r4-r8,pc}
;;;450    
                          ENDP

                  set_pwm_present PROC
;;;451    void set_pwm_present(spray_sys_esc_status_t foc_status)
0006d8  e92d4ff1          PUSH     {r0,r4-r11,lr}
;;;452    {
;;;453      float pwm_value = (float)(foc_status.flow_speed - MIN_FLOW)*0.05*100;
0006dc  f89d1000          LDRB     r1,[sp,#0]
0006e0  2214              MOVS     r2,#0x14
0006e2  ebc20051          RSB      r0,r2,r1,LSR #1
0006e6  f7fffffe          BL       __aeabi_i2f
0006ea  4683              MOV      r11,r0
0006ec  f7fffffe          BL       __aeabi_f2d
0006f0  4680              MOV      r8,r0
0006f2  4a6f              LDR      r2,|L1.2224|
0006f4  4b6f              LDR      r3,|L1.2228|
0006f6  f7fffffe          BL       __aeabi_dmul
0006fa  4606              MOV      r6,r0
0006fc  2200              MOVS     r2,#0
0006fe  4b6e              LDR      r3,|L1.2232|
000700  f7fffffe          BL       __aeabi_dmul
000704  4604              MOV      r4,r0
000706  f7fffffe          BL       __aeabi_d2f
00070a  4682              MOV      r10,r0
;;;454      if(foc_status.enable_flag == 1)
00070c  f89d0000          LDRB     r0,[sp,#0]
000710  f0000001          AND      r0,r0,#1
000714  b128              CBZ      r0,|L1.1826|
;;;455    		pwm_present_value = pwm_value;
000716  4650              MOV      r0,r10
000718  f7fffffe          BL       __aeabi_f2uiz
00071c  4967              LDR      r1,|L1.2236|
00071e  7008              STRB     r0,[r1,#0]
000720  e002              B        |L1.1832|
                  |L1.1826|
;;;456    	else
;;;457    		pwm_present_value = 0;
000722  2000              MOVS     r0,#0
000724  4965              LDR      r1,|L1.2236|
000726  7008              STRB     r0,[r1,#0]
                  |L1.1832|
;;;458    }
000728  e8bd8ff8          POP      {r3-r11,pc}
;;;459    
                          ENDP

                  get_pwm_present_value PROC
;;;460    uint8_t get_pwm_present_value(void)
00072c  4863              LDR      r0,|L1.2236|
;;;461    {
;;;462      return pwm_present_value;
00072e  7800              LDRB     r0,[r0,#0]  ; pwm_present_value
;;;463    }
000730  4770              BX       lr
;;;464    
                          ENDP

                  set_flow_cali_result PROC
;;;467    uint8_t flow_cali_result = flow_cali_idle;
;;;468    void set_flow_cali_result(uint8_t value)
000732  4963              LDR      r1,|L1.2240|
;;;469    {
;;;470       flow_cali_result = value;
000734  7008              STRB     r0,[r1,#0]
;;;471    }
000736  4770              BX       lr
;;;472    //得到飞控对水泵的控制
                          ENDP

                  spary_sys_status_push PROC
;;;494    // 向飞控推送农机的喷洒系统的状态
;;;495     void spary_sys_status_push( void )
000738  e92d47f0          PUSH     {r4-r10,lr}
;;;496    {
00073c  b08a              SUB      sp,sp,#0x28
;;;497    	uint8_t tmpBuf[40] = {0};
00073e  2128              MOVS     r1,#0x28
000740  4668              MOV      r0,sp
000742  f7fffffe          BL       __aeabi_memclr4
;;;498    	static uint8_t cali_count = 0;
;;;499    	static uint16_t seq=0,count = 0;
;;;500    	cmd_header_v1_t *p_cmd = (cmd_header_v1_t *)tmpBuf;
000746  46e9              MOV      r9,sp
;;;501    	cmd_spary_sys_status_push_t *p_data = (cmd_spary_sys_status_push_t *)(tmpBuf + sizeof( cmd_header_v1_t ));
000748  f10d040b          ADD      r4,sp,#0xb
;;;502    
;;;503    	p_cmd->sof = 0x55;
00074c  2055              MOVS     r0,#0x55
00074e  f8890000          STRB     r0,[r9,#0]
;;;504    	p_cmd->vl.version = 1;
000752  f8990002          LDRB     r0,[r9,#2]
000756  f02000fc          BIC      r0,r0,#0xfc
00075a  1d00              ADDS     r0,r0,#4
00075c  f8890002          STRB     r0,[r9,#2]
;;;505    	p_cmd->sender.sender_id = DEVICE_ID;
000760  f8990004          LDRB     r0,[r9,#4]
000764  f020001f          BIC      r0,r0,#0x1f
000768  301c              ADDS     r0,r0,#0x1c
00076a  f8890004          STRB     r0,[r9,#4]
;;;506    	p_cmd->sender.sender_index = DEVICE_INDEX;
00076e  f8990004          LDRB     r0,[r9,#4]
000772  f02000e0          BIC      r0,r0,#0xe0
000776  f8890004          STRB     r0,[r9,#4]
;;;507    	p_cmd->receiver.receiver_id = 0x03; // 飞控
00077a  f8990005          LDRB     r0,[r9,#5]
00077e  f020001f          BIC      r0,r0,#0x1f
000782  1cc0              ADDS     r0,r0,#3
000784  f8890005          STRB     r0,[r9,#5]
;;;508    	p_cmd->receiver.receiver_index = 0;
000788  f8990005          LDRB     r0,[r9,#5]
00078c  f02000e0          BIC      r0,r0,#0xe0
000790  f8890005          STRB     r0,[r9,#5]
;;;509    	p_cmd->seqnum = seq++;
000794  484b              LDR      r0,|L1.2244|
000796  8800              LDRH     r0,[r0,#0]  ; seq
000798  f8a90006          STRH     r0,[r9,#6]
00079c  4849              LDR      r0,|L1.2244|
00079e  8800              LDRH     r0,[r0,#0]  ; seq
0007a0  1c40              ADDS     r0,r0,#1
0007a2  4948              LDR      r1,|L1.2244|
0007a4  8008              STRH     r0,[r1,#0]
;;;510    	p_cmd->type.cmd_type = 0;
0007a6  f8990008          LDRB     r0,[r9,#8]
0007aa  f0200080          BIC      r0,r0,#0x80
0007ae  f8890008          STRB     r0,[r9,#8]
;;;511    	p_cmd->type.cmd_ack = 0;
0007b2  f8990008          LDRB     r0,[r9,#8]
0007b6  f0200060          BIC      r0,r0,#0x60
0007ba  f8890008          STRB     r0,[r9,#8]
;;;512    	p_cmd->type.encrypt_type = 0;
0007be  f8990008          LDRB     r0,[r9,#8]
0007c2  f020000f          BIC      r0,r0,#0xf
0007c6  f8890008          STRB     r0,[r9,#8]
;;;513    	p_cmd->set = 0x05;
0007ca  2005              MOVS     r0,#5
0007cc  f8890009          STRB     r0,[r9,#9]
;;;514    	p_cmd->id = 0x41;
0007d0  2041              MOVS     r0,#0x41
0007d2  f889000a          STRB     r0,[r9,#0xa]
;;;515    	p_cmd->vl.length = sizeof(cmd_header_v1_t) + sizeof(cmd_spary_sys_status_push_t)+ CRC_16_LENGTH;
0007d6  f8b90001          LDRH     r0,[r9,#1]
0007da  f36f0009          BFC      r0,#0,#10
0007de  3019              ADDS     r0,r0,#0x19
0007e0  f8a90001          STRH     r0,[r9,#1]
;;;516    	
;;;517      //电调状态	
;;;518      p_data->pump_esc_status[0].health_flag = ESC_Normal;
0007e4  7820              LDRB     r0,[r4,#0]
0007e6  f0200080          BIC      r0,r0,#0x80
0007ea  7020              STRB     r0,[r4,#0]
;;;519    	p_data->pump_esc_status[1].health_flag = ESC_Normal; 
0007ec  7860              LDRB     r0,[r4,#1]
0007ee  f0200080          BIC      r0,r0,#0x80
0007f2  7060              STRB     r0,[r4,#1]
;;;520      //其余电调状态保留
;;;521    	
;;;522    	//水泵的工作状态
;;;523    	p_data->pump_presure_state.pump1_state = get_pump1_state(); 
0007f4  f7fffffe          BL       get_pump1_state
0007f8  7a21              LDRB     r1,[r4,#8]
0007fa  f3601107          BFI      r1,r0,#4,#4
0007fe  7221              STRB     r1,[r4,#8]
;;;524    	p_data->pump_presure_state.pump2_state = get_pump2_state();
000800  f7fffffe          BL       get_pump2_state
000804  7a21              LDRB     r1,[r4,#8]
000806  f3600103          BFI      r1,r0,#0,#4
00080a  7221              STRB     r1,[r4,#8]
;;;525    	
;;;526    	
;;;527    	if(flow_cali_result == flow_cali_complted ||flow_cali_result == flow_cali_failed)	
00080c  482c              LDR      r0,|L1.2240|
00080e  7800              LDRB     r0,[r0,#0]  ; flow_cali_result
000810  2801              CMP      r0,#1
000812  d003              BEQ      |L1.2076|
000814  482a              LDR      r0,|L1.2240|
000816  7800              LDRB     r0,[r0,#0]  ; flow_cali_result
000818  2802              CMP      r0,#2
00081a  d10f              BNE      |L1.2108|
                  |L1.2076|
;;;528    	{
;;;529    		cali_count++; //推送三秒标定结果后状态清0
00081c  482a              LDR      r0,|L1.2248|
00081e  7800              LDRB     r0,[r0,#0]  ; cali_count
000820  1c40              ADDS     r0,r0,#1
000822  4929              LDR      r1,|L1.2248|
000824  7008              STRB     r0,[r1,#0]
;;;530    		if(cali_count > 15)
000826  4608              MOV      r0,r1
000828  7800              LDRB     r0,[r0,#0]  ; cali_count
00082a  280f              CMP      r0,#0xf
00082c  dd09              BLE      |L1.2114|
;;;531    		{  // 重置状态
;;;532    			 flow_cali_result = flow_cali_idle; 
00082e  2000              MOVS     r0,#0
000830  4923              LDR      r1,|L1.2240|
000832  7008              STRB     r0,[r1,#0]
;;;533    			 cali_count = 15;
000834  200f              MOVS     r0,#0xf
000836  4924              LDR      r1,|L1.2248|
000838  7008              STRB     r0,[r1,#0]
00083a  e002              B        |L1.2114|
                  |L1.2108|
;;;534    		}
;;;535    	}
;;;536    	else
;;;537    	{
;;;538    			cali_count = 0;
00083c  2000              MOVS     r0,#0
00083e  4922              LDR      r1,|L1.2248|
000840  7008              STRB     r0,[r1,#0]
                  |L1.2114|
;;;539    	}
;;;540    
;;;541    	if(FOC_1_STATUS.enable_flag == 1)	//流量参数
000842  4822              LDR      r0,|L1.2252|
000844  7800              LDRB     r0,[r0,#0]  ; FOC_1_STATUS
000846  f0000001          AND      r0,r0,#1
00084a  b188              CBZ      r0,|L1.2160|
;;;542    		p_data->flow_para[0].cur_flow = FOC_1_STATUS.flow_speed * 0.2;//流量计精度计算 
00084c  491f              LDR      r1,|L1.2252|
00084e  7809              LDRB     r1,[r1,#0]  ; FOC_1_STATUS
000850  0848              LSRS     r0,r1,#1
000852  f7fffffe          BL       __aeabi_ui2d
000856  4607              MOV      r7,r0
000858  4a15              LDR      r2,|L1.2224|
00085a  4b1d              LDR      r3,|L1.2256|
00085c  f7fffffe          BL       __aeabi_dmul
000860  4605              MOV      r5,r0
000862  f7fffffe          BL       __aeabi_d2uiz
000866  79a1              LDRB     r1,[r4,#6]
000868  f3600105          BFI      r1,r0,#0,#6
00086c  71a1              STRB     r1,[r4,#6]
00086e  e035              B        |L1.2268|
                  |L1.2160|
000870  e030              B        |L1.2260|
000872  0000              DCW      0x0000
                  |L1.2164|
                          DCD      cfg_package_index_front
                  |L1.2168|
                          DCD      md5
                  |L1.2172|
                          DCD      sector_start_map
                  |L1.2176|
                          DCD      cfg_file_size
                  |L1.2180|
                          DCD      g_device_status
                  |L1.2184|
                          DCD      RecordKeyPress
                  |L1.2188|
00088c  6361726d          DCB      "carmer press\r\n",0
000890  65722070
000894  72657373
000898  0d0a00  
00089b  00                DCB      0
                  |L1.2204|
00089c  6361726d          DCB      "carmer release\r\n",0
0008a0  65722072
0008a4  656c6561
0008a8  73650d0a
0008ac  00      
0008ad  00                DCB      0
0008ae  00                DCB      0
0008af  00                DCB      0
                  |L1.2224|
                          DCD      0x9999999a
                  |L1.2228|
                          DCD      0x3fa99999
                  |L1.2232|
                          DCD      0x40590000
                  |L1.2236|
                          DCD      pwm_present_value
                  |L1.2240|
                          DCD      flow_cali_result
                  |L1.2244|
                          DCD      ||seq||
                  |L1.2248|
                          DCD      cali_count
                  |L1.2252|
                          DCD      FOC_1_STATUS
                  |L1.2256|
                          DCD      0x3fc99999
                  |L1.2260|
;;;543    	else
;;;544    		p_data->flow_para[0].cur_flow = 0;
0008d4  79a0              LDRB     r0,[r4,#6]
0008d6  f020003f          BIC      r0,r0,#0x3f
0008da  71a0              STRB     r0,[r4,#6]
                  |L1.2268|
;;;545    	
;;;546    	p_data->flow_para[0].cali_result = flow_cali_result;
0008dc  48fe              LDR      r0,|L1.3288|
0008de  7801              LDRB     r1,[r0,#0]  ; flow_cali_result
0008e0  79a0              LDRB     r0,[r4,#6]
0008e2  f3611087          BFI      r0,r1,#6,#2
0008e6  71a0              STRB     r0,[r4,#6]
;;;547    	
;;;548    	if(FOC_2_STATUS.enable_flag == 1)	//流量参数
0008e8  48fc              LDR      r0,|L1.3292|
0008ea  7800              LDRB     r0,[r0,#0]  ; FOC_2_STATUS
0008ec  f0000001          AND      r0,r0,#1
0008f0  b188              CBZ      r0,|L1.2326|
;;;549    	 p_data->flow_para[1].cur_flow =  FOC_2_STATUS.flow_speed * 0.2;
0008f2  49fa              LDR      r1,|L1.3292|
0008f4  7809              LDRB     r1,[r1,#0]  ; FOC_2_STATUS
0008f6  0848              LSRS     r0,r1,#1
0008f8  f7fffffe          BL       __aeabi_ui2d
0008fc  4605              MOV      r5,r0
0008fe  4af8              LDR      r2,|L1.3296|
000900  4bf8              LDR      r3,|L1.3300|
000902  f7fffffe          BL       __aeabi_dmul
000906  4607              MOV      r7,r0
000908  f7fffffe          BL       __aeabi_d2uiz
00090c  79e1              LDRB     r1,[r4,#7]
00090e  f3600105          BFI      r1,r0,#0,#6
000912  71e1              STRB     r1,[r4,#7]
000914  e003              B        |L1.2334|
                  |L1.2326|
;;;550    	else
;;;551    	 p_data->flow_para[1].cur_flow = 0;
000916  79e0              LDRB     r0,[r4,#7]
000918  f020013f          BIC      r1,r0,#0x3f
00091c  71e1              STRB     r1,[r4,#7]
                  |L1.2334|
;;;552    	
;;;553    	p_data->flow_para[1].cali_result = flow_cali_result;
00091e  48ee              LDR      r0,|L1.3288|
000920  7801              LDRB     r1,[r0,#0]  ; flow_cali_result
000922  79e0              LDRB     r0,[r4,#7]
000924  f3611087          BFI      r0,r1,#6,#2
000928  71e0              STRB     r0,[r4,#7]
;;;554    	
;;;555    	p_data->plug_temp_level.XT100= Get_XT100_State();
00092a  f7fffffe          BL       Get_XT100_State
00092e  7aa1              LDRB     r1,[r4,#0xa]
000930  f3600103          BFI      r1,r0,#0,#4
000934  72a1              STRB     r1,[r4,#0xa]
;;;556      p_data->plug_temp_level.XT90 = Get_XT90_State();
000936  f7fffffe          BL       Get_XT90_State
00093a  7aa1              LDRB     r1,[r4,#0xa]
00093c  f3601107          BFI      r1,r0,#4,#4
000940  72a1              STRB     r1,[r4,#0xa]
;;;557    	
;;;558    	//剩余容量
;;;559    	if(get_MedeRunoutFlag() == 1)
000942  f7fffffe          BL       get_MedeRunoutFlag
000946  2801              CMP      r0,#1
000948  d102              BNE      |L1.2384|
;;;560    	{
;;;561    	   p_data->remaining_capacity = 0;
00094a  2000              MOVS     r0,#0
00094c  7260              STRB     r0,[r4,#9]
00094e  e025              B        |L1.2460|
                  |L1.2384|
;;;562    	}
;;;563    	else // 没触发液位传感器，给已固定值
;;;564    	{
;;;565    		if(get_current_capacity_d()*0.01 < 15)
000950  f7fffffe          BL       get_current_capacity_d
000954  4682              MOV      r10,r0
000956  f7fffffe          BL       __aeabi_ui2d
00095a  4607              MOV      r7,r0
00095c  4ae2              LDR      r2,|L1.3304|
00095e  4be3              LDR      r3,|L1.3308|
000960  f7fffffe          BL       __aeabi_dmul
000964  4605              MOV      r5,r0
000966  2200              MOVS     r2,#0
000968  4be1              LDR      r3,|L1.3312|
00096a  f7fffffe          BL       __aeabi_cdcmple
00096e  d202              BCS      |L1.2422|
;;;566    		{
;;;567    		 	 p_data->remaining_capacity = 15; //将已经知道喷洒的赋值 单位 0.1L   remain:1.5L get_current_capacity_d()*0.01
000970  200f              MOVS     r0,#0xf
000972  7260              STRB     r0,[r4,#9]
000974  e012              B        |L1.2460|
                  |L1.2422|
;;;568    		}
;;;569    		else
;;;570    		{
;;;571    			p_data->remaining_capacity = get_current_capacity_d()*0.01;
000976  f7fffffe          BL       get_current_capacity_d
00097a  4682              MOV      r10,r0
00097c  f7fffffe          BL       __aeabi_ui2d
000980  4607              MOV      r7,r0
000982  4ad9              LDR      r2,|L1.3304|
000984  4bd9              LDR      r3,|L1.3308|
000986  f7fffffe          BL       __aeabi_dmul
00098a  4605              MOV      r5,r0
00098c  f7fffffe          BL       __aeabi_d2uiz
000990  7260              STRB     r0,[r4,#9]
;;;572    			if(p_data->remaining_capacity <= 15)
000992  7a60              LDRB     r0,[r4,#9]
000994  280f              CMP      r0,#0xf
000996  dc01              BGT      |L1.2460|
;;;573    				p_data->remaining_capacity = 15;
000998  200f              MOVS     r0,#0xf
00099a  7260              STRB     r0,[r4,#9]
                  |L1.2460|
;;;574    		}
;;;575      }
;;;576    	
;;;577    //  /************ APP调试信息打印 ****************/
;;;578    //	p_data->debug_esc_status[0].enable_flag =  FOC_1_STATUS.enable_flag;
;;;579    //	if(FOC_1_STATUS.enable_flag == 1)
;;;580    //	 p_data->debug_esc_status[0].flow_speed  =  FOC_1_STATUS.flow_speed;
;;;581    //	else
;;;582    //	 p_data->debug_esc_status[0].flow_speed = 0;
;;;583    //	
;;;584    //	p_data->debug_esc_status[1].enable_flag =  FOC_2_STATUS.enable_flag;
;;;585    //	if(FOC_2_STATUS.enable_flag == 1)
;;;586    //	 p_data->debug_esc_status[1].flow_speed  = FOC_2_STATUS.flow_speed;
;;;587    //	else
;;;588    //	 p_data->debug_esc_status[1].flow_speed  = 0;
;;;589    //	
;;;590    //	
;;;591    //	
;;;592    //	p_data->debug_pump1_foc_value = get_foc_throttle_value(FOC_1);
;;;593    //	p_data->debug_pump1_press_value = get_press_value(Press_Sensor_0);
;;;594    
;;;595    //	p_data->debug_pump2_foc_value = get_foc_throttle_value(FOC_2);
;;;596    //	p_data->debug_pump2_press_value = get_press_value(Press_Sensor_1);
;;;597    //  p_data->debug_flow_freq = get_cali_flow_freq();
;;;598    //	p_data->level_status = level_status_by_radar;
;;;599    
;;;600    	count++;
00099c  48d5              LDR      r0,|L1.3316|
00099e  8800              LDRH     r0,[r0,#0]  ; count
0009a0  1c40              ADDS     r0,r0,#1
0009a2  49d4              LDR      r1,|L1.3316|
0009a4  8008              STRH     r0,[r1,#0]
;;;601    	p_data->count = count;
0009a6  4608              MOV      r0,r1
0009a8  7800              LDRB     r0,[r0,#0]  ; count
0009aa  72e0              STRB     r0,[r4,#0xb]
;;;602    	Append_CRC8_Check_Sum( tmpBuf, 4 );
0009ac  2104              MOVS     r1,#4
0009ae  4668              MOV      r0,sp
0009b0  f7fffffe          BL       Append_CRC8_Check_Sum
;;;603    	Append_CRC16_Check_Sum( tmpBuf, p_cmd->vl.length );
0009b4  f8b90001          LDRH     r0,[r9,#1]
0009b8  f3c00109          UBFX     r1,r0,#0,#10
0009bc  4668              MOV      r0,sp
0009be  f7fffffe          BL       Append_CRC16_Check_Sum
;;;604    	CAN_sendbytes_View( LPC_CAN1, &can1Tx3RingBuf, tmpBuf, p_cmd->vl.length );
0009c2  f8b90001          LDRH     r0,[r9,#1]
0009c6  f3c00309          UBFX     r3,r0,#0,#10
0009ca  466a              MOV      r2,sp
0009cc  49ca              LDR      r1,|L1.3320|
0009ce  48cb              LDR      r0,|L1.3324|
0009d0  f7fffffe          BL       CAN_sendbytes_View
;;;605    //	uart_printf( 2, "p_data->remaining_capacity = %d \r\n",p_data->remaining_capacity);
;;;606    }
0009d4  b00a              ADD      sp,sp,#0x28
0009d6  e8bd87f0          POP      {r4-r10,pc}
;;;607    
                          ENDP

                  SET_FOC1_MUTEX_FLAG PROC
;;;609    uint8_t  FOC1_MUTEX_FLAG = 1,FOC2_MUTEX_FLAG = 1;;
;;;610    void SET_FOC1_MUTEX_FLAG(uint8_t state)
0009da  49c9              LDR      r1,|L1.3328|
;;;611    {
;;;612      FOC1_MUTEX_FLAG = state;
0009dc  7008              STRB     r0,[r1,#0]
;;;613    }
0009de  4770              BX       lr
;;;614    
                          ENDP

                  SET_FOC2_MUTEX_FLAG PROC
;;;615    void SET_FOC2_MUTEX_FLAG(uint8_t state)
0009e0  49c8              LDR      r1,|L1.3332|
;;;616    {
;;;617      FOC2_MUTEX_FLAG = state;
0009e2  7008              STRB     r0,[r1,#0]
;;;618    }
0009e4  4770              BX       lr
;;;619    
                          ENDP

                  set_residual_volume_warning_mode PROC
;;;622    uint8_t residual_volume_warning = 0;//默认是剩药的
;;;623    void set_residual_volume_warning_mode(uint8_t mode)//默认是剩药
0009e6  49c8              LDR      r1,|L1.3336|
;;;624    {
;;;625      residual_volume_warning = mode;
0009e8  7008              STRB     r0,[r1,#0]
;;;626    }
0009ea  4770              BX       lr
;;;627    
                          ENDP

                  Set_Throttle_Value_2 PROC
;;;953    
;;;954    void  Set_Throttle_Value_2(uint16_t value)
0009ec  49c7              LDR      r1,|L1.3340|
;;;955    {
;;;956    	 Throttle_Value_2 = value;
0009ee  8008              STRH     r0,[r1,#0]
;;;957    }
0009f0  4770              BX       lr
;;;958    
                          ENDP

                  Set_Throttle_Value_1 PROC
;;;948    
;;;949    void  Set_Throttle_Value_1(uint16_t value)
0009f2  49c7              LDR      r1,|L1.3344|
;;;950    {
;;;951    	 Throttle_Value_1 = value;
0009f4  8008              STRH     r0,[r1,#0]
;;;952    }
0009f6  4770              BX       lr
;;;953    
                          ENDP

                  cmd_handler_get_fc_statu PROC
;;;633    
;;;634    void cmd_handler_get_fc_statu(  uint8_t *p_buf, uint16_t len )
0009f8  b5f8              PUSH     {r3-r7,lr}
;;;635    {
0009fa  4605              MOV      r5,r0
0009fc  460e              MOV      r6,r1
;;;636    	cmd_spary_sys_esc_ctrl_t *p_data = ( cmd_spary_sys_esc_ctrl_t*)( p_buf + sizeof( cmd_header_v1_t ) );
0009fe  f105040b          ADD      r4,r5,#0xb
;;;637    
;;;638      FOC_1_STATUS.enable_flag =  p_data->spray_cmd[0].enable_flag;
000a02  7820              LDRB     r0,[r4,#0]
000a04  49c3              LDR      r1,|L1.3348|
000a06  7809              LDRB     r1,[r1,#0]  ; FOC_1_STATUS
000a08  f3600100          BFI      r1,r0,#0,#1
000a0c  48c1              LDR      r0,|L1.3348|
000a0e  7001              STRB     r1,[r0,#0]
;;;639      FOC_1_STATUS.flow_speed  =  p_data->spray_cmd[0].flow_speed; // *0.02 表示实际流量
000a10  7820              LDRB     r0,[r4,#0]
000a12  0841              LSRS     r1,r0,#1
000a14  48bf              LDR      r0,|L1.3348|
000a16  7800              LDRB     r0,[r0,#0]  ; FOC_1_STATUS
000a18  f3610047          BFI      r0,r1,#1,#7
000a1c  49bd              LDR      r1,|L1.3348|
000a1e  7008              STRB     r0,[r1,#0]
;;;640    	
;;;641      FOC_2_STATUS.enable_flag =  p_data->spray_cmd[3].enable_flag;
000a20  78e0              LDRB     r0,[r4,#3]
000a22  49ae              LDR      r1,|L1.3292|
000a24  7809              LDRB     r1,[r1,#0]  ; FOC_2_STATUS
000a26  f3600100          BFI      r1,r0,#0,#1
000a2a  48ac              LDR      r0,|L1.3292|
000a2c  7001              STRB     r1,[r0,#0]
;;;642      FOC_2_STATUS.flow_speed  =  p_data->spray_cmd[3].flow_speed;// 
000a2e  78e0              LDRB     r0,[r4,#3]
000a30  0841              LSRS     r1,r0,#1
000a32  48aa              LDR      r0,|L1.3292|
000a34  7800              LDRB     r0,[r0,#0]  ; FOC_2_STATUS
000a36  f3610047          BFI      r0,r1,#1,#7
000a3a  49a8              LDR      r1,|L1.3292|
000a3c  7008              STRB     r0,[r1,#0]
;;;643    	
;;;644      #ifdef FLOW_CALI_TEST
;;;645    		FOC_1_STATUS.valid_spray =  1;//p_data->valid_spray;
;;;646    		FOC_2_STATUS.valid_spray =  1;// p_data->valid_spray;
;;;647    	#else
;;;648    		FOC_1_STATUS.valid_spray =  p_data->valid_spray;//p_data->valid_spray;
000a3e  79a0              LDRB     r0,[r4,#6]
000a40  49b4              LDR      r1,|L1.3348|
000a42  7048              STRB     r0,[r1,#1]
;;;649    		FOC_2_STATUS.valid_spray =  p_data->valid_spray;// p_data->valid_spray;
000a44  79a0              LDRB     r0,[r4,#6]
000a46  49a5              LDR      r1,|L1.3292|
000a48  7048              STRB     r0,[r1,#1]
;;;650    	#endif
;;;651    	memcpy(&debug_sys_esc_ctrl,p_data,sizeof(cmd_spary_sys_esc_ctrl_t));
000a4a  48b3              LDR      r0,|L1.3352|
000a4c  6821              LDR      r1,[r4,#0]
000a4e  6001              STR      r1,[r0,#0]  ; debug_sys_esc_ctrl
000a50  6861              LDR      r1,[r4,#4]
000a52  6041              STR      r1,[r0,#4]  ; debug_sys_esc_ctrl
;;;652    
;;;653      // 如果没有泄压前，以同一速度泄压
;;;654      if(get_capacity_flag_1L() == 1) // 触发发液位开关
000a54  f7fffffe          BL       get_capacity_flag_1L
000a58  2801              CMP      r0,#1
000a5a  d10b              BNE      |L1.2676|
;;;655    	{
;;;656    	  if(get_current_capacity_d() - Last_Capacity > 450)//触发后再喷洒350ml执行无药报警
000a5c  f7fffffe          BL       get_current_capacity_d
000a60  49ae              LDR      r1,|L1.3356|
000a62  8809              LDRH     r1,[r1,#0]  ; Last_Capacity
000a64  1a40              SUBS     r0,r0,r1
000a66  f5b07fe1          CMP      r0,#0x1c2
000a6a  dd0d              BLE      |L1.2696|
;;;657    		{
;;;658    		  STOP_SPRAY_FLAG = 1;
000a6c  2001              MOVS     r0,#1
000a6e  49ac              LDR      r1,|L1.3360|
000a70  7008              STRB     r0,[r1,#0]
000a72  e009              B        |L1.2696|
                  |L1.2676|
;;;659    		}
;;;660    	}
;;;661    	else
;;;662    	{
;;;663    		 set_MedeRunoutFlag(0); // 浮子浮上来默认有药
000a74  2000              MOVS     r0,#0
000a76  f7fffffe          BL       set_MedeRunoutFlag
;;;664    	   STOP_SPRAY_FLAG = 0;
000a7a  2000              MOVS     r0,#0
000a7c  49a8              LDR      r1,|L1.3360|
000a7e  7008              STRB     r0,[r1,#0]
;;;665    	   Last_Capacity = get_current_capacity_d();
000a80  f7fffffe          BL       get_current_capacity_d
000a84  49a5              LDR      r1,|L1.3356|
000a86  8008              STRH     r0,[r1,#0]
                  |L1.2696|
;;;666    	}
;;;667    	
;;;668    
;;;669    
;;;670    	if(STOP_SPRAY_FLAG == 0 || residual_volume_warning == No_Liquid) // 触发液位开关后停止喷洒
000a88  48a5              LDR      r0,|L1.3360|
000a8a  7800              LDRB     r0,[r0,#0]  ; STOP_SPRAY_FLAG
000a8c  b110              CBZ      r0,|L1.2708|
000a8e  489e              LDR      r0,|L1.3336|
000a90  7800              LDRB     r0,[r0,#0]  ; residual_volume_warning
000a92  bba0              CBNZ     r0,|L1.2814|
                  |L1.2708|
;;;671    	{		
;;;672    		if( FOC_1_STATUS.enable_flag ==  FOC_2_STATUS.enable_flag 
000a94  489f              LDR      r0,|L1.3348|
000a96  7800              LDRB     r0,[r0,#0]  ; FOC_1_STATUS
000a98  f0000001          AND      r0,r0,#1
000a9c  498f              LDR      r1,|L1.3292|
000a9e  7809              LDRB     r1,[r1,#0]  ; FOC_2_STATUS
000aa0  f0010101          AND      r1,r1,#1
000aa4  4288              CMP      r0,r1
000aa6  d115              BNE      |L1.2772|
;;;673    			 && FOC_1_STATUS.flow_speed ==  FOC_2_STATUS.flow_speed) // 四个同时喷洒
000aa8  489a              LDR      r0,|L1.3348|
000aaa  7800              LDRB     r0,[r0,#0]  ; FOC_1_STATUS
000aac  0840              LSRS     r0,r0,#1
000aae  498b              LDR      r1,|L1.3292|
000ab0  7809              LDRB     r1,[r1,#0]  ; FOC_2_STATUS
000ab2  ebb00f51          CMP      r0,r1,LSR #1
000ab6  d10d              BNE      |L1.2772|
;;;674    		{
;;;675    		   if(FOC1_MUTEX_FLAG == 1 && FOC2_MUTEX_FLAG == 1)
000ab8  4891              LDR      r0,|L1.3328|
000aba  7800              LDRB     r0,[r0,#0]  ; FOC1_MUTEX_FLAG
000abc  2801              CMP      r0,#1
000abe  d13a              BNE      |L1.2870|
000ac0  4890              LDR      r0,|L1.3332|
000ac2  7800              LDRB     r0,[r0,#0]  ; FOC2_MUTEX_FLAG
000ac4  2801              CMP      r0,#1
000ac6  d136              BNE      |L1.2870|
;;;676    				 Set_Foc_Value_By_Flow_Double_Pump(FOC_1_STATUS);
000ac8  4892              LDR      r0,|L1.3348|
000aca  8800              LDRH     r0,[r0,#0]  ; FOC_1_STATUS
000acc  9000              STR      r0,[sp,#0]
000ace  f7fffffe          BL       Set_Foc_Value_By_Flow_Double_Pump
000ad2  e030              B        |L1.2870|
                  |L1.2772|
;;;677    		}
;;;678    		else // 两个泵作业
;;;679    		{
;;;680    			if( FOC_1_STATUS.enable_flag == STOP_SPARY || FOC_1_STATUS.flow_speed == 0)
000ad4  488f              LDR      r0,|L1.3348|
000ad6  7800              LDRB     r0,[r0,#0]  ; FOC_1_STATUS
000ad8  f0000001          AND      r0,r0,#1
000adc  b118              CBZ      r0,|L1.2790|
000ade  488d              LDR      r0,|L1.3348|
000ae0  7800              LDRB     r0,[r0,#0]  ; FOC_1_STATUS
000ae2  0840              LSRS     r0,r0,#1
000ae4  b960              CBNZ     r0,|L1.2816|
                  |L1.2790|
;;;681    			{
;;;682    				if(FOC2_MUTEX_FLAG == 1)
000ae6  4887              LDR      r0,|L1.3332|
000ae8  7800              LDRB     r0,[r0,#0]  ; FOC2_MUTEX_FLAG
000aea  2801              CMP      r0,#1
000aec  d123              BNE      |L1.2870|
;;;683    				{
;;;684    					Set_Foc_Value_By_Flow_Single_Pump(FOC_2,FOC_2_STATUS); //两个泵工
000aee  487b              LDR      r0,|L1.3292|
000af0  8800              LDRH     r0,[r0,#0]  ; FOC_2_STATUS
000af2  4601              MOV      r1,r0
000af4  9000              STR      r0,[sp,#0]
000af6  2002              MOVS     r0,#2
000af8  f7fffffe          BL       Set_Foc_Value_By_Flow_Single_Pump
000afc  e01b              B        |L1.2870|
                  |L1.2814|
000afe  e00b              B        |L1.2840|
                  |L1.2816|
;;;685    			
;;;686    				}
;;;687    			}
;;;688    			else 
;;;689    			{
;;;690    				if(FOC1_MUTEX_FLAG == 1)
000b00  487f              LDR      r0,|L1.3328|
000b02  7800              LDRB     r0,[r0,#0]  ; FOC1_MUTEX_FLAG
000b04  2801              CMP      r0,#1
000b06  d116              BNE      |L1.2870|
;;;691    				{
;;;692    					Set_Foc_Value_By_Flow_Single_Pump(FOC_1,FOC_1_STATUS);
000b08  4882              LDR      r0,|L1.3348|
000b0a  8800              LDRH     r0,[r0,#0]  ; FOC_1_STATUS
000b0c  4601              MOV      r1,r0
000b0e  9000              STR      r0,[sp,#0]
000b10  2001              MOVS     r0,#1
000b12  f7fffffe          BL       Set_Foc_Value_By_Flow_Single_Pump
000b16  e00e              B        |L1.2870|
                  |L1.2840|
;;;693    	
;;;694    				}
;;;695    			}
;;;696    		}
;;;697    	}
;;;698    	else if(residual_volume_warning == Small_Liquid) //液位报警模式是剩余药量的模式
000b18  487b              LDR      r0,|L1.3336|
000b1a  7800              LDRB     r0,[r0,#0]  ; residual_volume_warning
000b1c  2801              CMP      r0,#1
000b1e  d10a              BNE      |L1.2870|
;;;699    	{
;;;700    		Set_Throttle_Value_1(MIN_CNT);
000b20  f44f706b          MOV      r0,#0x3ac
000b24  f7fffffe          BL       Set_Throttle_Value_1
;;;701    		Set_Throttle_Value_2(MIN_CNT);
000b28  f44f706b          MOV      r0,#0x3ac
000b2c  f7fffffe          BL       Set_Throttle_Value_2
;;;702    		set_MedeRunoutFlag(1);// 无药报警
000b30  2001              MOVS     r0,#1
000b32  f7fffffe          BL       set_MedeRunoutFlag
                  |L1.2870|
;;;703    	}
;;;704    	
;;;705    
;;;706    	
;;;707    //	uart_printf( 0, "FOC_1_flag = %d,FOC_1_speed = %d,FOC_2_flag  = %d,FOC_2_speed = %d\r\n" ,FOC_1_STATUS.enable_flag,FOC_1_STATUS.flow_speed,FOC_2_STATUS.enable_flag,FOC_2_STATUS.flow_speed );
;;;708    }
000b36  bdf8              POP      {r3-r7,pc}
;;;709    
                          ENDP

                  cmd_handler_flow_cali PROC
;;;716    
;;;717    void cmd_handler_flow_cali(  uint8_t *p_buf, uint16_t len)
000b38  e92d47f0          PUSH     {r4-r10,lr}
;;;718    {
000b3c  4605              MOV      r5,r0
000b3e  4688              MOV      r8,r1
;;;719      uint16_t capacity_app_set = 0;
000b40  bf00              NOP      
;;;720    	cmd_header_v1_t *p_cmd = ( cmd_header_v1_t * )p_buf;
000b42  462c              MOV      r4,r5
;;;721    	cmd_flow_cali_t *p_rr = ( cmd_flow_cali_t*)( p_buf + sizeof( cmd_header_v1_t ) );
000b44  f105060b          ADD      r6,r5,#0xb
;;;722      cmd_flow_cali_ack_t *p_ra = (cmd_flow_cali_ack_t *)( p_buf + sizeof( cmd_header_v1_t ) );
000b48  46b1              MOV      r9,r6
;;;723    	
;;;724    	capacity_app_set = p_rr->cali_capacity*1000; //得到标定的流量 ml
000b4a  7830              LDRB     r0,[r6,#0]
000b4c  eb000140          ADD      r1,r0,r0,LSL #1
000b50  ebc110c0          RSB      r0,r1,r0,LSL #7
000b54  f64f71ff          MOV      r1,#0xffff
000b58  ea0107c0          AND      r7,r1,r0,LSL #3
;;;725    	set_cali_capaciy(capacity_app_set);
000b5c  4638              MOV      r0,r7
000b5e  f7fffffe          BL       set_cali_capaciy
;;;726    	//应答数据
;;;727    	#ifdef FLOW_CALI_TEST
;;;728    	//应答数据
;;;729    	if((p_rr->cali_capacity != 0 )
;;;730    	    || p_rr->cali_capacity == 0)	
;;;731    	#else
;;;732    		if(( FOC_1_STATUS.valid_spray == 0 && p_rr->cali_capacity != 0 ) 
000b62  486c              LDR      r0,|L1.3348|
000b64  7840              LDRB     r0,[r0,#1]  ; FOC_1_STATUS
000b66  b908              CBNZ     r0,|L1.2924|
000b68  7830              LDRB     r0,[r6,#0]
000b6a  b908              CBNZ     r0,|L1.2928|
                  |L1.2924|
;;;733    	    || p_rr->cali_capacity == 0)	
000b6c  7830              LDRB     r0,[r6,#0]
000b6e  bb30              CBNZ     r0,|L1.3006|
                  |L1.2928|
;;;734    	#endif	
;;;735    	 {	
;;;736    		 if(p_rr->cali_capacity != 0)
000b70  7830              LDRB     r0,[r6,#0]
000b72  b130              CBZ      r0,|L1.2946|
;;;737    		 {
;;;738    		   set_flow_cali_flag(START_FLOW_CALI);
000b74  2001              MOVS     r0,#1
000b76  f7fffffe          BL       set_flow_cali_flag
;;;739    			 flow_cali_result = flow_cali_working;
000b7a  2003              MOVS     r0,#3
000b7c  4956              LDR      r1,|L1.3288|
000b7e  7008              STRB     r0,[r1,#0]
000b80  e005              B        |L1.2958|
                  |L1.2946|
;;;740    		 }
;;;741    		 else 	//如果标定流量为 0,取消标定
;;;742    		 {
;;;743    			 set_flow_cali_flag(CANCEL_FLOW_CALI);
000b82  2000              MOVS     r0,#0
000b84  f7fffffe          BL       set_flow_cali_flag
;;;744    			 flow_cali_result = flow_cali_idle;
000b88  2000              MOVS     r0,#0
000b8a  4953              LDR      r1,|L1.3288|
000b8c  7008              STRB     r0,[r1,#0]
                  |L1.2958|
;;;745    		 }
;;;746    		 
;;;747    		if( p_cmd->type.cmd_ack != 0 ) 
000b8e  7a20              LDRB     r0,[r4,#8]
000b90  f3c01041          UBFX     r0,r0,#5,#2
000b94  b198              CBZ      r0,|L1.3006|
;;;748    		{
;;;749    			cmd_handler_init_header_v1( p_buf, len );
000b96  4641              MOV      r1,r8
000b98  4628              MOV      r0,r5
000b9a  f7fffffe          BL       cmd_handler_init_header_v1
;;;750    			p_cmd->vl.length = sizeof( cmd_header_v1_t ) + sizeof( cmd_flow_cali_ack_t ) + CRC_16_LENGTH;
000b9e  f8340f01          LDRH     r0,[r4,#1]!
000ba2  f36f0009          BFC      r0,#0,#10
000ba6  300e              ADDS     r0,r0,#0xe
000ba8  8020              STRH     r0,[r4,#0]
;;;751    			p_ra->ack_code = 0;
000baa  2000              MOVS     r0,#0
000bac  f8890000          STRB     r0,[r9,#0]
;;;752    			cmd_headler_send_command_v1( p_buf, p_cmd->vl.length );
000bb0  f8340901          LDRH     r0,[r4],#-1
000bb4  f3c00109          UBFX     r1,r0,#0,#10
000bb8  4628              MOV      r0,r5
000bba  f7fffffe          BL       cmd_headler_send_command_v1
                  |L1.3006|
;;;753    		}
;;;754      }
;;;755    	uart_printf( 2, "capacity_app_set =  %d \r\n" ,capacity_app_set);
000bbe  463a              MOV      r2,r7
000bc0  a158              ADR      r1,|L1.3364|
000bc2  2002              MOVS     r0,#2
000bc4  f7fffffe          BL       uart_printf
;;;756    }
000bc8  e8bd87f0          POP      {r4-r10,pc}
;;;757    
                          ENDP

                  get_level_status_by_radar PROC
;;;758    uint8_t get_level_status_by_radar(void)
000bcc  485c              LDR      r0,|L1.3392|
;;;759    {
;;;760      return level_status_by_radar;
000bce  7800              LDRB     r0,[r0,#0]  ; level_status_by_radar
;;;761    }
000bd0  4770              BX       lr
;;;762    
                          ENDP

                  cmd_handler_level_switch PROC
;;;763    uint8_t level_init_flag = 0,level_init_count = 0;
;;;764    void cmd_handler_level_switch(  uint8_t *p_buf, uint16_t len)  // 通过雷达液位数据
000bd2  b570              PUSH     {r4-r6,lr}
;;;765    {
000bd4  4604              MOV      r4,r0
000bd6  460e              MOV      r6,r1
;;;766    //	cmd_header_v1_t *p_cmd = ( cmd_header_v1_t * )p_buf;
;;;767    
;;;768    	cmd_level_switch_t *p_rr = ( cmd_level_switch_t*)( p_buf + sizeof( cmd_header_v1_t ) );
000bd8  f104050b          ADD      r5,r4,#0xb
;;;769    	level_status_by_radar = p_rr->level_status; //
000bdc  7828              LDRB     r0,[r5,#0]
000bde  4958              LDR      r1,|L1.3392|
000be0  7008              STRB     r0,[r1,#0]
;;;770    	// 第一次上电，根据浮子位置判断是否有药,低电平为无药
;;;771    	if(level_init_flag == 0)
000be2  4858              LDR      r0,|L1.3396|
000be4  7800              LDRB     r0,[r0,#0]  ; level_init_flag
000be6  b9c0              CBNZ     r0,|L1.3098|
;;;772    	{
;;;773    		if(level_status_by_radar == 0)
000be8  4608              MOV      r0,r1
000bea  7800              LDRB     r0,[r0,#0]  ; level_status_by_radar
000bec  b978              CBNZ     r0,|L1.3086|
;;;774    		{
;;;775    		  level_init_count++;
000bee  4856              LDR      r0,|L1.3400|
000bf0  7800              LDRB     r0,[r0,#0]  ; level_init_count
000bf2  1c40              ADDS     r0,r0,#1
000bf4  4954              LDR      r1,|L1.3400|
000bf6  7008              STRB     r0,[r1,#0]
;;;776    			if(level_init_count >= 3)
000bf8  4608              MOV      r0,r1
000bfa  7800              LDRB     r0,[r0,#0]  ; level_init_count
000bfc  2803              CMP      r0,#3
000bfe  db0c              BLT      |L1.3098|
;;;777    			{	  
;;;778    				set_MedeRunoutFlag(1);
000c00  2001              MOVS     r0,#1
000c02  f7fffffe          BL       set_MedeRunoutFlag
;;;779            level_init_flag = 1;				
000c06  2001              MOVS     r0,#1
000c08  494e              LDR      r1,|L1.3396|
000c0a  7008              STRB     r0,[r1,#0]
000c0c  e005              B        |L1.3098|
                  |L1.3086|
;;;780    			}
;;;781    		}
;;;782        else
;;;783    		{
;;;784    			level_init_count = 0;
000c0e  2000              MOVS     r0,#0
000c10  494d              LDR      r1,|L1.3400|
000c12  7008              STRB     r0,[r1,#0]
;;;785    			level_init_flag = 1;
000c14  2001              MOVS     r0,#1
000c16  494b              LDR      r1,|L1.3396|
000c18  7008              STRB     r0,[r1,#0]
                  |L1.3098|
;;;786    		}
;;;787    	}
;;;788    	uart_printf( 2, "cmd_handler_level_switch =  %d \r\n" ,level_status_by_radar);
000c1a  4849              LDR      r0,|L1.3392|
000c1c  7802              LDRB     r2,[r0,#0]  ; level_status_by_radar
000c1e  a14b              ADR      r1,|L1.3404|
000c20  2002              MOVS     r0,#2
000c22  f7fffffe          BL       uart_printf
;;;789    }
000c26  bd70              POP      {r4-r6,pc}
;;;790    
                          ENDP

                  cmd_handler_residual_volume_warning PROC
;;;791    
;;;792    void cmd_handler_residual_volume_warning(  uint8_t *p_buf, uint16_t len)  // 
000c28  e92d43f8          PUSH     {r3-r9,lr}
;;;793    {
000c2c  4605              MOV      r5,r0
000c2e  4688              MOV      r8,r1
;;;794    	uint8_t buf[1] = {0};
000c30  2000              MOVS     r0,#0
000c32  9000              STR      r0,[sp,#0]
;;;795    	cmd_header_v1_t *p_cmd = ( cmd_header_v1_t * )p_buf;
000c34  462c              MOV      r4,r5
;;;796    	cmd_residual_volume_t *p_rr = ( cmd_residual_volume_t*)( p_buf + sizeof( cmd_header_v1_t ) );
000c36  f105060b          ADD      r6,r5,#0xb
;;;797      cmd_residual_volume_ack_t *p_ra = (cmd_residual_volume_ack_t *)( p_buf + sizeof( cmd_header_v1_t ) );
000c3a  4637              MOV      r7,r6
;;;798    	
;;;799    	if(p_rr->read_or_write == 0)
000c3c  7830              LDRB     r0,[r6,#0]
000c3e  09c0              LSRS     r0,r0,#7
000c40  b968              CBNZ     r0,|L1.3166|
;;;800    	{
;;;801    	  //从flash读取 并应答给APP
;;;802    		 cali_volume_para_read_flash(buf, 1); 
000c42  2101              MOVS     r1,#1
000c44  4668              MOV      r0,sp
000c46  f7fffffe          BL       cali_volume_para_read_flash
;;;803    		 if(buf[0] == 0xff)
000c4a  f89d0000          LDRB     r0,[sp,#0]
000c4e  28ff              CMP      r0,#0xff
000c50  d101              BNE      |L1.3158|
;;;804    		   buf[0]  = Small_Liquid; // 剩余药量
000c52  2001              MOVS     r0,#1
000c54  9000              STR      r0,[sp,#0]
                  |L1.3158|
;;;805    		 p_ra->ack_waring_mode = buf[0];
000c56  f89d0000          LDRB     r0,[sp,#0]
000c5a  7078              STRB     r0,[r7,#1]
000c5c  e00e              B        |L1.3196|
                  |L1.3166|
;;;806    	}	
;;;807      else
;;;808    	{
;;;809    		buf[0] = p_rr->waring_mode;
000c5e  7830              LDRB     r0,[r6,#0]
000c60  f000007f          AND      r0,r0,#0x7f
000c64  9000              STR      r0,[sp,#0]
;;;810    		set_residual_volume_warning_mode(p_rr->waring_mode);
000c66  7831              LDRB     r1,[r6,#0]
000c68  f001007f          AND      r0,r1,#0x7f
000c6c  f7fffffe          BL       set_residual_volume_warning_mode
;;;811    		residual_volume_para_write_flash(buf,1);
000c70  2101              MOVS     r1,#1
000c72  4668              MOV      r0,sp
000c74  f7fffffe          BL       residual_volume_para_write_flash
;;;812    	  p_ra->ack_waring_mode = 0xff;// 表示无效数据
000c78  20ff              MOVS     r0,#0xff
000c7a  7078              STRB     r0,[r7,#1]
                  |L1.3196|
;;;813    	}		
;;;814    	 
;;;815    	if( p_cmd->type.cmd_ack != 0 ) 
000c7c  7a20              LDRB     r0,[r4,#8]
000c7e  f3c01041          UBFX     r0,r0,#5,#2
000c82  b190              CBZ      r0,|L1.3242|
;;;816    	{
;;;817    			cmd_handler_init_header_v1( p_buf, len );
000c84  4641              MOV      r1,r8
000c86  4628              MOV      r0,r5
000c88  f7fffffe          BL       cmd_handler_init_header_v1
;;;818    			p_cmd->vl.length = sizeof( cmd_header_v1_t ) + sizeof( cmd_residual_volume_ack_t ) + CRC_16_LENGTH;
000c8c  f8340f01          LDRH     r0,[r4,#1]!
000c90  f36f0009          BFC      r0,#0,#10
000c94  300f              ADDS     r0,r0,#0xf
000c96  8020              STRH     r0,[r4,#0]
;;;819    			p_ra->ack_code = 0;
000c98  2000              MOVS     r0,#0
000c9a  7038              STRB     r0,[r7,#0]
;;;820    			cmd_headler_send_command_v1( p_buf, p_cmd->vl.length );
000c9c  f8340901          LDRH     r0,[r4],#-1
000ca0  f3c00109          UBFX     r1,r0,#0,#10
000ca4  4628              MOV      r0,r5
000ca6  f7fffffe          BL       cmd_headler_send_command_v1
                  |L1.3242|
;;;821    	 }
;;;822    }
000caa  e8bd83f8          POP      {r3-r9,pc}
;;;823    
                          ENDP

                  cmd_handler_flowmeter_K_control PROC
;;;824    cmd_flowmeter_K_control_t debug_control;
;;;825    void cmd_handler_flowmeter_K_control(uint8_t *p_buf, uint16_t len)
000cae  e92d43f8          PUSH     {r3-r9,lr}
;;;826    {
000cb2  4605              MOV      r5,r0
000cb4  4688              MOV      r8,r1
;;;827    	uint8_t buf[1] = {0};
000cb6  2000              MOVS     r0,#0
000cb8  9000              STR      r0,[sp,#0]
;;;828    	cmd_header_v1_t *p_cmd = ( cmd_header_v1_t * )p_buf;
000cba  462c              MOV      r4,r5
;;;829    	cmd_flowmeter_K_control_t *p_rr = ( cmd_flowmeter_K_control_t*)( p_buf + sizeof( cmd_header_v1_t ) );
000cbc  f105060b          ADD      r6,r5,#0xb
;;;830      cmd_flowmeter_ack_t *p_ra = (cmd_flowmeter_ack_t *)( p_buf + sizeof( cmd_header_v1_t ) );
000cc0  4637              MOV      r7,r6
;;;831    	memcpy(&debug_control,p_rr,sizeof(cmd_flowmeter_K_control_t));
000cc2  482b              LDR      r0,|L1.3440|
000cc4  7831              LDRB     r1,[r6,#0]
000cc6  7001              STRB     r1,[r0,#0]
;;;832      if(p_rr->read_or_write == 0)
000cc8  7830              LDRB     r0,[r6,#0]
000cca  09c0              LSRS     r0,r0,#7
000ccc  b910              CBNZ     r0,|L1.3284|
;;;833    	{
;;;834    	 // 从flash读取 并应答给APP
;;;835    		flowmeter_para_read_flash(buf, 1);
000cce  2101              MOVS     r1,#1
000cd0  4668              MOV      r0,sp
000cd2  e04f              B        |L1.3444|
                  |L1.3284|
000cd4  e05a              B        |L1.3468|
000cd6  0000              DCW      0x0000
                  |L1.3288|
                          DCD      flow_cali_result
                  |L1.3292|
                          DCD      FOC_2_STATUS
                  |L1.3296|
                          DCD      0x9999999a
                  |L1.3300|
                          DCD      0x3fc99999
                  |L1.3304|
                          DCD      0x47ae147b
                  |L1.3308|
                          DCD      0x3f847ae1
                  |L1.3312|
                          DCD      0x402e0000
                  |L1.3316|
                          DCD      count
                  |L1.3320|
                          DCD      can1Tx3RingBuf
                  |L1.3324|
                          DCD      0x40044000
                  |L1.3328|
                          DCD      FOC1_MUTEX_FLAG
                  |L1.3332|
                          DCD      FOC2_MUTEX_FLAG
                  |L1.3336|
                          DCD      residual_volume_warning
                  |L1.3340|
                          DCD      Throttle_Value_2
                  |L1.3344|
                          DCD      Throttle_Value_1
                  |L1.3348|
                          DCD      FOC_1_STATUS
                  |L1.3352|
                          DCD      debug_sys_esc_ctrl
                  |L1.3356|
                          DCD      Last_Capacity
                  |L1.3360|
                          DCD      STOP_SPRAY_FLAG
                  |L1.3364|
000d24  63617061          DCB      "capacity_app_set =  %d \r\n",0
000d28  63697479
000d2c  5f617070
000d30  5f736574
000d34  203d2020
000d38  2564200d
000d3c  0a00    
000d3e  00                DCB      0
000d3f  00                DCB      0
                  |L1.3392|
                          DCD      level_status_by_radar
                  |L1.3396|
                          DCD      level_init_flag
                  |L1.3400|
                          DCD      level_init_count
                  |L1.3404|
000d4c  636d645f          DCB      "cmd_handler_level_switch =  %d \r\n",0
000d50  68616e64
000d54  6c65725f
000d58  6c657665
000d5c  6c5f7377
000d60  69746368
000d64  203d2020
000d68  2564200d
000d6c  0a00    
000d6e  00                DCB      0
000d6f  00                DCB      0
                  |L1.3440|
                          DCD      debug_control
                  |L1.3444|
000d74  f7fffffe          BL       flowmeter_para_read_flash
;;;836    		if(buf[0] == 0xff)
000d78  f89d0000          LDRB     r0,[sp,#0]
000d7c  28ff              CMP      r0,#0xff
000d7e  d101              BNE      |L1.3460|
;;;837    		   buf[0]  = 0; 
000d80  2000              MOVS     r0,#0
000d82  9000              STR      r0,[sp,#0]
                  |L1.3460|
;;;838        p_ra->ack_flowmeter_value = buf[0];
000d84  f89d0000          LDRB     r0,[sp,#0]
000d88  7078              STRB     r0,[r7,#1]
000d8a  e007              B        |L1.3484|
                  |L1.3468|
;;;839    	}	
;;;840      else
;;;841    	{
;;;842    		buf[0] = p_rr->flowmeter_value;
000d8c  7830              LDRB     r0,[r6,#0]
000d8e  f000007f          AND      r0,r0,#0x7f
000d92  9000              STR      r0,[sp,#0]
;;;843        flowmeter_para_write_flash(buf,1);
000d94  2101              MOVS     r1,#1
000d96  4668              MOV      r0,sp
000d98  f7fffffe          BL       flowmeter_para_write_flash
                  |L1.3484|
;;;844    	}
;;;845    	if( p_cmd->type.cmd_ack != 0 ) 
000d9c  7a20              LDRB     r0,[r4,#8]
000d9e  f3c01041          UBFX     r0,r0,#5,#2
000da2  b190              CBZ      r0,|L1.3530|
;;;846    	{
;;;847    			cmd_handler_init_header_v1( p_buf, len );
000da4  4641              MOV      r1,r8
000da6  4628              MOV      r0,r5
000da8  f7fffffe          BL       cmd_handler_init_header_v1
;;;848    			p_cmd->vl.length = sizeof( cmd_header_v1_t ) + sizeof( cmd_flowmeter_ack_t ) + CRC_16_LENGTH;
000dac  f8340f01          LDRH     r0,[r4,#1]!
000db0  f36f0009          BFC      r0,#0,#10
000db4  300f              ADDS     r0,r0,#0xf
000db6  8020              STRH     r0,[r4,#0]
;;;849    			p_ra->ack_code = 0;
000db8  2000              MOVS     r0,#0
000dba  7038              STRB     r0,[r7,#0]
;;;850    			cmd_headler_send_command_v1( p_buf, p_cmd->vl.length );
000dbc  f8340901          LDRH     r0,[r4],#-1
000dc0  f3c00109          UBFX     r1,r0,#0,#10
000dc4  4628              MOV      r0,r5
000dc6  f7fffffe          BL       cmd_headler_send_command_v1
                  |L1.3530|
;;;851    	 }	
;;;852    }
000dca  e8bd83f8          POP      {r3-r9,pc}
;;;853    
                          ENDP

                  cmd_handler_gimbal_ctl PROC
;;;906    volatile uint32_t g_u32GimbalGettime = 0;
;;;907    void cmd_handler_gimbal_ctl( uint8_t *p_buf, uint16_t len  )
000dce  b510              PUSH     {r4,lr}
;;;908    {
000dd0  460a              MOV      r2,r1
;;;909    	cmd_header_v1_t *p_cmd = ( cmd_header_v1_t * )p_buf;
000dd2  4601              MOV      r1,r0
;;;910    	g_u16GimbalCtl = *(uint16_t*)((uint8_t*)(&(p_cmd->id ))+ 1);  //发送给云台（控制水泵速度）//1024+-660                     
000dd4  f8b1300b          LDRH     r3,[r1,#0xb]
000dd8  4cfa              LDR      r4,|L1.4548|
000dda  8023              STRH     r3,[r4,#0]
;;;911    	g_u32GimbalGettime = g_current_tick ;//时间32111113
000ddc  4bfa              LDR      r3,|L1.4552|
000dde  681b              LDR      r3,[r3,#0]  ; g_current_tick
000de0  4cfa              LDR      r4,|L1.4556|
000de2  6023              STR      r3,[r4,#0]  ; g_u32GimbalGettime
;;;912    }
000de4  bd10              POP      {r4,pc}
;;;913    
                          ENDP

                  cmd_handler_foc_ver_request PROC
;;;914    void cmd_handler_foc_ver_request( uint8_t idx )
000de6  b530              PUSH     {r4,r5,lr}
;;;915    {
000de8  b087              SUB      sp,sp,#0x1c
000dea  4605              MOV      r5,r0
;;;916    	uint8_t tmpBuf[24] = { 0 };
000dec  2118              MOVS     r1,#0x18
000dee  a801              ADD      r0,sp,#4
000df0  f7fffffe          BL       __aeabi_memclr4
;;;917    	static uint16_t seq=0;
;;;918    	cmd_header_v1_t *p_cmd = ( cmd_header_v1_t * )tmpBuf;
000df4  ac01              ADD      r4,sp,#4
;;;919    
;;;920    	p_cmd->sof = 0x55;
000df6  2055              MOVS     r0,#0x55
000df8  7020              STRB     r0,[r4,#0]
;;;921    	p_cmd->vl.version = 1;
000dfa  78a0              LDRB     r0,[r4,#2]
000dfc  f02000fc          BIC      r0,r0,#0xfc
000e00  1d00              ADDS     r0,r0,#4
000e02  70a0              STRB     r0,[r4,#2]
;;;922    	p_cmd->sender.sender_id = DEVICE_ID;
000e04  7920              LDRB     r0,[r4,#4]
000e06  f020001f          BIC      r0,r0,#0x1f
000e0a  301c              ADDS     r0,r0,#0x1c
000e0c  7120              STRB     r0,[r4,#4]
;;;923    	p_cmd->sender.sender_index = DEVICE_INDEX;
000e0e  7920              LDRB     r0,[r4,#4]
000e10  f02000e0          BIC      r0,r0,#0xe0
000e14  7120              STRB     r0,[r4,#4]
;;;924    	p_cmd->receiver.receiver_id = 0x0c; 
000e16  7960              LDRB     r0,[r4,#5]
000e18  f020001f          BIC      r0,r0,#0x1f
000e1c  300c              ADDS     r0,r0,#0xc
000e1e  7160              STRB     r0,[r4,#5]
;;;925    	p_cmd->receiver.receiver_index = 0x07;
000e20  7960              LDRB     r0,[r4,#5]
000e22  f02000e0          BIC      r0,r0,#0xe0
000e26  30e0              ADDS     r0,r0,#0xe0
000e28  7160              STRB     r0,[r4,#5]
;;;926    	p_cmd->seqnum = seq++;
000e2a  48e9              LDR      r0,|L1.4560|
000e2c  8800              LDRH     r0,[r0,#0]  ; seq
000e2e  80e0              STRH     r0,[r4,#6]
000e30  48e7              LDR      r0,|L1.4560|
000e32  8800              LDRH     r0,[r0,#0]  ; seq
000e34  1c40              ADDS     r0,r0,#1
000e36  49e6              LDR      r1,|L1.4560|
000e38  8008              STRH     r0,[r1,#0]
;;;927    	p_cmd->type.cmd_type = 1;
000e3a  7a20              LDRB     r0,[r4,#8]
000e3c  f0200080          BIC      r0,r0,#0x80
000e40  3080              ADDS     r0,r0,#0x80
000e42  7220              STRB     r0,[r4,#8]
;;;928    	p_cmd->type.cmd_ack = 0;
000e44  7a20              LDRB     r0,[r4,#8]
000e46  f0200060          BIC      r0,r0,#0x60
000e4a  7220              STRB     r0,[r4,#8]
;;;929    	p_cmd->type.encrypt_type = 0;
000e4c  7a20              LDRB     r0,[r4,#8]
000e4e  f020000f          BIC      r0,r0,#0xf
000e52  7220              STRB     r0,[r4,#8]
;;;930    	p_cmd->set = 0;
000e54  2000              MOVS     r0,#0
000e56  7260              STRB     r0,[r4,#9]
;;;931    	p_cmd->id = 0x01;
000e58  2001              MOVS     r0,#1
000e5a  72a0              STRB     r0,[r4,#0xa]
;;;932    
;;;933    	p_cmd->vl.length = sizeof( cmd_header_v1_t ) + 2;
000e5c  f8b40001          LDRH     r0,[r4,#1]
000e60  f36f0009          BFC      r0,#0,#10
000e64  300d              ADDS     r0,r0,#0xd
000e66  f8a40001          STRH     r0,[r4,#1]
;;;934    	if(idx == FOC_1)
000e6a  2d01              CMP      r5,#1
000e6c  d102              BNE      |L1.3700|
;;;935    		g_cfg_end_point = EP_UART1;
000e6e  2005              MOVS     r0,#5
000e70  49d8              LDR      r1,|L1.4564|
000e72  6008              STR      r0,[r1,#0]  ; g_cfg_end_point
                  |L1.3700|
;;;936    	if(idx == FOC_2)
000e74  2d02              CMP      r5,#2
000e76  d102              BNE      |L1.3710|
;;;937    		g_cfg_end_point = EP_UART3;
000e78  2007              MOVS     r0,#7
000e7a  49d6              LDR      r1,|L1.4564|
000e7c  6008              STR      r0,[r1,#0]  ; g_cfg_end_point
                  |L1.3710|
;;;938    	
;;;939    	cmd_headler_send_command_v1( tmpBuf, p_cmd->vl.length );	
000e7e  f8b40001          LDRH     r0,[r4,#1]
000e82  f3c00109          UBFX     r1,r0,#0,#10
000e86  a801              ADD      r0,sp,#4
000e88  f7fffffe          BL       cmd_headler_send_command_v1
;;;940    	uart_printf( 0 ,"req foc ver\r\n" );
000e8c  a1d2              ADR      r1,|L1.4568|
000e8e  2000              MOVS     r0,#0
000e90  f7fffffe          BL       uart_printf
;;;941    }
000e94  b007              ADD      sp,sp,#0x1c
000e96  bd30              POP      {r4,r5,pc}
;;;942    
                          ENDP

                  get_pump_map_speed PROC
;;;958    
;;;959    uint16_t get_pump_map_speed(uint8_t foc_id,uint8_t flow)
000e98  e92d4ff0          PUSH     {r4-r11,lr}
;;;960    {
000e9c  b08b              SUB      sp,sp,#0x2c
000e9e  4683              MOV      r11,r0
000ea0  468a              MOV      r10,r1
;;;961    	uint16_t speed = 0;
000ea2  2000              MOVS     r0,#0
000ea4  9009              STR      r0,[sp,#0x24]
;;;962    	float value = 0;
000ea6  9008              STR      r0,[sp,#0x20]
;;;963    		if(flow > MAX_FLOW )
000ea8  f1ba0f7f          CMP      r10,#0x7f
000eac  dd01              BLE      |L1.3762|
;;;964    			flow = MAX_FLOW;
000eae  f04f0a7f          MOV      r10,#0x7f
                  |L1.3762|
;;;965    		if(flow <= MIN_FLOW)
000eb2  f1ba0f14          CMP      r10,#0x14
000eb6  dc01              BGT      |L1.3772|
;;;966    			flow = MIN_FLOW;
000eb8  f04f0a14          MOV      r10,#0x14
                  |L1.3772|
;;;967    		
;;;968    		value = (float)(flow - MIN_FLOW)*0.05264*(Get_Spary_Limit_Value(foc_id,MAX_SPRAY_ID)-Get_Spary_Limit_Value(foc_id,MIN_SPRAY_ID))+Get_Spary_Limit_Value(foc_id,MIN_SPRAY_ID); //    1/(MAX_FLOW - MIN_FLOW) = 0.05264
000ebc  2102              MOVS     r1,#2
000ebe  4658              MOV      r0,r11
000ec0  f7fffffe          BL       Get_Spary_Limit_Value
000ec4  4604              MOV      r4,r0
000ec6  f7fffffe          BL       __aeabi_ui2d
000eca  e9cd0104          STRD     r0,r1,[sp,#0x10]
000ece  2101              MOVS     r1,#1
000ed0  4658              MOV      r0,r11
000ed2  f7fffffe          BL       Get_Spary_Limit_Value
000ed6  4681              MOV      r9,r0
000ed8  2102              MOVS     r1,#2
000eda  4658              MOV      r0,r11
000edc  f7fffffe          BL       Get_Spary_Limit_Value
000ee0  eba90800          SUB      r8,r9,r0
000ee4  4640              MOV      r0,r8
000ee6  f7fffffe          BL       __aeabi_i2d
000eea  4604              MOV      r4,r0
000eec  460d              MOV      r5,r1
000eee  f1aa0014          SUB      r0,r10,#0x14
000ef2  f7fffffe          BL       __aeabi_i2f
000ef6  9001              STR      r0,[sp,#4]
000ef8  f7fffffe          BL       __aeabi_f2d
000efc  4680              MOV      r8,r0
000efe  4aba              LDR      r2,|L1.4584|
000f00  4bba              LDR      r3,|L1.4588|
000f02  f7fffffe          BL       __aeabi_dmul
000f06  4606              MOV      r6,r0
000f08  4622              MOV      r2,r4
000f0a  462b              MOV      r3,r5
000f0c  f7fffffe          BL       __aeabi_dmul
000f10  e9cd0102          STRD     r0,r1,[sp,#8]
000f14  e9dd2304          LDRD     r2,r3,[sp,#0x10]
000f18  f7fffffe          BL       __aeabi_dadd
000f1c  e9cd0106          STRD     r0,r1,[sp,#0x18]
000f20  f7fffffe          BL       __aeabi_d2f
000f24  9008              STR      r0,[sp,#0x20]
;;;969        speed = value;
000f26  9808              LDR      r0,[sp,#0x20]
000f28  f7fffffe          BL       __aeabi_f2uiz
000f2c  b280              UXTH     r0,r0
000f2e  9009              STR      r0,[sp,#0x24]
;;;970    		return speed;
000f30  9809              LDR      r0,[sp,#0x24]
;;;971    }
000f32  b00b              ADD      sp,sp,#0x2c
000f34  e8bd8ff0          POP      {r4-r11,pc}
;;;972    
                          ENDP

                  set_foc_throttle_value PROC
;;;973    
;;;974    void set_foc_throttle_value(uint8_t foc_id, spray_sys_esc_status_t foc_status)
000f38  b573              PUSH     {r0,r1,r4-r6,lr}
;;;975    {
000f3a  4605              MOV      r5,r0
;;;976    	uint16_t value = 0;
000f3c  2400              MOVS     r4,#0
;;;977    	if(foc_status.flow_speed != 0) // 1 = 0.1L/min
000f3e  f89d0004          LDRB     r0,[sp,#4]
000f42  0840              LSRS     r0,r0,#1
000f44  b138              CBZ      r0,|L1.3926|
;;;978    		value	= get_pump_map_speed(foc_id,foc_status.flow_speed);
000f46  f89d0004          LDRB     r0,[sp,#4]
000f4a  0841              LSRS     r1,r0,#1
000f4c  4628              MOV      r0,r5
000f4e  f7fffffe          BL       get_pump_map_speed
000f52  4604              MOV      r4,r0
000f54  e001              B        |L1.3930|
                  |L1.3926|
;;;979    	else
;;;980    		value = MIN_CNT;
000f56  f44f746b          MOV      r4,#0x3ac
                  |L1.3930|
;;;981    	
;;;982    	if(value < MIN_CNT)
000f5a  f5b47f6b          CMP      r4,#0x3ac
000f5e  da02              BGE      |L1.3942|
;;;983    		value = MIN_CNT;
000f60  f44f746b          MOV      r4,#0x3ac
000f64  e006              B        |L1.3956|
                  |L1.3942|
;;;984    	else if(value > MAX_CNT)
000f66  f5b46ffa          CMP      r4,#0x7d0
000f6a  dd02              BLE      |L1.3954|
;;;985    		value = MAX_CNT;
000f6c  f44f64fa          MOV      r4,#0x7d0
000f70  e000              B        |L1.3956|
                  |L1.3954|
;;;986    	else
;;;987    		value = value; // 不变
000f72  bf00              NOP      
                  |L1.3956|
;;;988    		
;;;989    	if(foc_id == FOC_1 )
000f74  2d01              CMP      r5,#1
000f76  d10d              BNE      |L1.3988|
;;;990    	{
;;;991    		if(foc_status.enable_flag == 1)
000f78  f89d0004          LDRB     r0,[sp,#4]
000f7c  f0000001          AND      r0,r0,#1
000f80  b118              CBZ      r0,|L1.3978|
;;;992    		 Set_Throttle_Value_1(value);
000f82  4620              MOV      r0,r4
000f84  f7fffffe          BL       Set_Throttle_Value_1
000f88  e013              B        |L1.4018|
                  |L1.3978|
;;;993    		else
;;;994    		 Set_Throttle_Value_1(MIN_CNT);
000f8a  f44f706b          MOV      r0,#0x3ac
000f8e  f7fffffe          BL       Set_Throttle_Value_1
000f92  e00e              B        |L1.4018|
                  |L1.3988|
;;;995    	}
;;;996    	else if(foc_id == FOC_2)
000f94  2d02              CMP      r5,#2
000f96  d10c              BNE      |L1.4018|
;;;997    	{
;;;998    		if(foc_status.enable_flag == 1)
000f98  f89d0004          LDRB     r0,[sp,#4]
000f9c  f0000001          AND      r0,r0,#1
000fa0  b118              CBZ      r0,|L1.4010|
;;;999    			Set_Throttle_Value_2(value);
000fa2  4620              MOV      r0,r4
000fa4  f7fffffe          BL       Set_Throttle_Value_2
000fa8  e003              B        |L1.4018|
                  |L1.4010|
;;;1000   		else
;;;1001   		  Set_Throttle_Value_2(MIN_CNT);
000faa  f44f706b          MOV      r0,#0x3ac
000fae  f7fffffe          BL       Set_Throttle_Value_2
                  |L1.4018|
;;;1002   	}
;;;1003   }
000fb2  bd7c              POP      {r2-r6,pc}
;;;1004   
                          ENDP

                  get_foc_throttle_value PROC
;;;1005   
;;;1006   uint16_t get_foc_throttle_value(uint8_t foc_id)
000fb4  4601              MOV      r1,r0
;;;1007   {
;;;1008   	if(Throttle_Value_1 > User_Max_Throttle)
000fb6  488e              LDR      r0,|L1.4592|
000fb8  8800              LDRH     r0,[r0,#0]  ; Throttle_Value_1
000fba  f24062a4          MOV      r2,#0x6a4
000fbe  4290              CMP      r0,r2
000fc0  dd02              BLE      |L1.4040|
;;;1009   		Throttle_Value_1 = User_Max_Throttle;
000fc2  4610              MOV      r0,r2
000fc4  4a8a              LDR      r2,|L1.4592|
000fc6  8010              STRH     r0,[r2,#0]
                  |L1.4040|
;;;1010   	if(Throttle_Value_2 > User_Max_Throttle)
000fc8  488a              LDR      r0,|L1.4596|
000fca  8800              LDRH     r0,[r0,#0]  ; Throttle_Value_2
000fcc  f24062a4          MOV      r2,#0x6a4
000fd0  4290              CMP      r0,r2
000fd2  dd02              BLE      |L1.4058|
;;;1011   		Throttle_Value_2 = User_Max_Throttle;
000fd4  4610              MOV      r0,r2
000fd6  4a87              LDR      r2,|L1.4596|
000fd8  8010              STRH     r0,[r2,#0]
                  |L1.4058|
;;;1012   	
;;;1013   	if(foc_id == FOC_1)
000fda  2901              CMP      r1,#1
000fdc  d102              BNE      |L1.4068|
;;;1014   		return Throttle_Value_1;
000fde  4884              LDR      r0,|L1.4592|
000fe0  8800              LDRH     r0,[r0,#0]  ; Throttle_Value_1
                  |L1.4066|
;;;1015   	else if(foc_id == FOC_2)
;;;1016   		return Throttle_Value_2;
;;;1017   	else
;;;1018   		return MIN_CNT;	
;;;1019   }
000fe2  4770              BX       lr
                  |L1.4068|
000fe4  2902              CMP      r1,#2                 ;1015
000fe6  d102              BNE      |L1.4078|
000fe8  4882              LDR      r0,|L1.4596|
000fea  8800              LDRH     r0,[r0,#0]            ;1016  ; Throttle_Value_2
000fec  e7f9              B        |L1.4066|
                  |L1.4078|
000fee  f44f706b          MOV      r0,#0x3ac             ;1018
000ff2  e7f6              B        |L1.4066|
;;;1020   
                          ENDP

                  cmd_hander_foc_request PROC
;;;1022   //uint8_t ack_debug_value;
;;;1023   void cmd_hander_foc_request( uint8_t cmd , uint8_t foc_id )
000ff4  b5f0              PUSH     {r4-r7,lr}
;;;1024   {
000ff6  b087              SUB      sp,sp,#0x1c
000ff8  4607              MOV      r7,r0
000ffa  460e              MOV      r6,r1
;;;1025   	uint8_t tmpBuf[24] = { 0 };
000ffc  2118              MOVS     r1,#0x18
000ffe  a801              ADD      r0,sp,#4
001000  f7fffffe          BL       __aeabi_memclr4
;;;1026   	cmd_header_v0_t *p_cmd = ( cmd_header_v0_t * )tmpBuf;
001004  ad01              ADD      r5,sp,#4
;;;1027   	cmd_foc_req_t * p_data = ( cmd_foc_req_t* )( tmpBuf + sizeof( cmd_header_v0_t ) );
001006  1dac              ADDS     r4,r5,#6
;;;1028   	feckbackID++;
001008  487b              LDR      r0,|L1.4600|
00100a  7800              LDRB     r0,[r0,#0]  ; feckbackID
00100c  1c40              ADDS     r0,r0,#1
00100e  497a              LDR      r1,|L1.4600|
001010  7008              STRB     r0,[r1,#0]
;;;1029   	if(feckbackID > 3)
001012  4608              MOV      r0,r1
001014  7800              LDRB     r0,[r0,#0]  ; feckbackID
001016  2803              CMP      r0,#3
001018  dd01              BLE      |L1.4126|
;;;1030   	{
;;;1031   	  feckbackID = 0;
00101a  2000              MOVS     r0,#0
00101c  7008              STRB     r0,[r1,#0]
                  |L1.4126|
;;;1032   	}
;;;1033   	p_cmd->sof = 0x55 ;
00101e  2055              MOVS     r0,#0x55
001020  7028              STRB     r0,[r5,#0]
;;;1034   	p_cmd->vl.version=0;
001022  78a8              LDRB     r0,[r5,#2]
001024  f02001fc          BIC      r1,r0,#0xfc
001028  70a9              STRB     r1,[r5,#2]
;;;1035   	p_cmd->id = 0x00A0 ;
00102a  20a0              MOVS     r0,#0xa0
00102c  80a8              STRH     r0,[r5,#4]
;;;1036   	p_data->cmd.cmd = 0 ;
00102e  7820              LDRB     r0,[r4,#0]
001030  f02000c0          BIC      r0,r0,#0xc0
001034  7020              STRB     r0,[r4,#0]
;;;1037   	p_data->cmd.foc_encoder=0;
001036  7820              LDRB     r0,[r4,#0]
001038  f020003f          BIC      r0,r0,#0x3f
00103c  7020              STRB     r0,[r4,#0]
;;;1038   	p_data->type.feckbackID = feckbackID ;
00103e  486e              LDR      r0,|L1.4600|
001040  7801              LDRB     r1,[r0,#0]  ; feckbackID
001042  7860              LDRB     r0,[r4,#1]
001044  f3610004          BFI      r0,r1,#0,#5
001048  7060              STRB     r0,[r4,#1]
;;;1039   	p_data->type.youmen_type = Throttle_Value_Type;
00104a  7860              LDRB     r0,[r4,#1]
00104c  f02000e0          BIC      r0,r0,#0xe0
001050  7060              STRB     r0,[r4,#1]
;;;1040   
;;;1041   	
;;;1042   	if(foc_id == FOC_1) // 前泵 EP_UART3
001052  2e01              CMP      r6,#1
001054  d123              BNE      |L1.4254|
;;;1043   	{
;;;1044   		g_cfg_end_point = EP_UART3;
001056  2007              MOVS     r0,#7
001058  495e              LDR      r1,|L1.4564|
00105a  6008              STR      r0,[r1,#0]  ; g_cfg_end_point
;;;1045   		p_data->foc0.acc_value = get_foc_throttle_value(FOC_1);
00105c  2001              MOVS     r0,#1
00105e  f7fffffe          BL       get_foc_throttle_value
001062  8861              LDRH     r1,[r4,#2]
001064  f360010d          BFI      r1,r0,#0,#14
001068  8061              STRH     r1,[r4,#2]
;;;1046   		p_data->foc1.acc_value = get_foc_throttle_value(FOC_1);
00106a  2001              MOVS     r0,#1
00106c  f7fffffe          BL       get_foc_throttle_value
001070  88a1              LDRH     r1,[r4,#4]
001072  f360010d          BFI      r1,r0,#0,#14
001076  80a1              STRH     r1,[r4,#4]
;;;1047   		p_data->foc2.acc_value = get_foc_throttle_value(FOC_1);
001078  2001              MOVS     r0,#1
00107a  f7fffffe          BL       get_foc_throttle_value
00107e  88e1              LDRH     r1,[r4,#6]
001080  f360010d          BFI      r1,r0,#0,#14
001084  80e1              STRH     r1,[r4,#6]
;;;1048   		p_data->foc3.acc_value = get_foc_throttle_value(FOC_1);
001086  2001              MOVS     r0,#1
001088  f7fffffe          BL       get_foc_throttle_value
00108c  8921              LDRH     r1,[r4,#8]
00108e  f360010d          BFI      r1,r0,#0,#14
001092  8121              STRH     r1,[r4,#8]
;;;1049   		
;;;1050   		debug_throttle_value_1 = get_foc_throttle_value(FOC_1);
001094  2001              MOVS     r0,#1
001096  f7fffffe          BL       get_foc_throttle_value
00109a  4958              LDR      r1,|L1.4604|
00109c  8008              STRH     r0,[r1,#0]
                  |L1.4254|
;;;1051   	}
;;;1052   	
;;;1053   	if(foc_id == FOC_2)
00109e  2e02              CMP      r6,#2
0010a0  d123              BNE      |L1.4330|
;;;1054   	{
;;;1055   		g_cfg_end_point = EP_UART1;
0010a2  2005              MOVS     r0,#5
0010a4  494b              LDR      r1,|L1.4564|
0010a6  6008              STR      r0,[r1,#0]  ; g_cfg_end_point
;;;1056   		p_data->foc0.acc_value = get_foc_throttle_value(FOC_2);
0010a8  2002              MOVS     r0,#2
0010aa  f7fffffe          BL       get_foc_throttle_value
0010ae  8861              LDRH     r1,[r4,#2]
0010b0  f360010d          BFI      r1,r0,#0,#14
0010b4  8061              STRH     r1,[r4,#2]
;;;1057   		p_data->foc1.acc_value = get_foc_throttle_value(FOC_2);
0010b6  2002              MOVS     r0,#2
0010b8  f7fffffe          BL       get_foc_throttle_value
0010bc  88a1              LDRH     r1,[r4,#4]
0010be  f360010d          BFI      r1,r0,#0,#14
0010c2  80a1              STRH     r1,[r4,#4]
;;;1058   		p_data->foc2.acc_value = get_foc_throttle_value(FOC_2);
0010c4  2002              MOVS     r0,#2
0010c6  f7fffffe          BL       get_foc_throttle_value
0010ca  88e1              LDRH     r1,[r4,#6]
0010cc  f360010d          BFI      r1,r0,#0,#14
0010d0  80e1              STRH     r1,[r4,#6]
;;;1059   		p_data->foc3.acc_value = get_foc_throttle_value(FOC_2);
0010d2  2002              MOVS     r0,#2
0010d4  f7fffffe          BL       get_foc_throttle_value
0010d8  8921              LDRH     r1,[r4,#8]
0010da  f360010d          BFI      r1,r0,#0,#14
0010de  8121              STRH     r1,[r4,#8]
;;;1060   		debug_throttle_value_2 = get_foc_throttle_value(FOC_2);
0010e0  2002              MOVS     r0,#2
0010e2  f7fffffe          BL       get_foc_throttle_value
0010e6  4946              LDR      r1,|L1.4608|
0010e8  8008              STRH     r0,[r1,#0]
                  |L1.4330|
;;;1061   	}
;;;1062   	
;;;1063   
;;;1064   	 p_cmd->vl.length = sizeof( cmd_header_v0_t ) + sizeof( cmd_foc_req_t ) + 2;
0010ea  f8350f01          LDRH     r0,[r5,#1]!
0010ee  f36f0009          BFC      r0,#0,#10
0010f2  3012              ADDS     r0,r0,#0x12
0010f4  8028              STRH     r0,[r5,#0]
;;;1065   	//memcpy(&debug_cmd_foc_req_t,p_data,sizeof( cmd_foc_req_t ));
;;;1066   	 cmd_headler_send_command_v0( tmpBuf, p_cmd->vl.length );
0010f6  f8350901          LDRH     r0,[r5],#-1
0010fa  f3c00109          UBFX     r1,r0,#0,#10
0010fe  a801              ADD      r0,sp,#4
001100  f7fffffe          BL       cmd_headler_send_command_v0
;;;1067   	//uart_printf( 0 ,"cmd_hander_foc_request\r\n" );
;;;1068   }
001104  b007              ADD      sp,sp,#0x1c
001106  bdf0              POP      {r4-r7,pc}
;;;1069   
                          ENDP

                  Rank PROC
;;;1070   void Rank(int16_t adbuf[],uint8_t num)//排序法
001108  b570              PUSH     {r4-r6,lr}
;;;1071   {
00110a  460b              MOV      r3,r1
;;;1072       int16_t u16Tmp=0;
00110c  2400              MOVS     r4,#0
;;;1073       uint8_t u8i=0,u8j=0;
00110e  2100              MOVS     r1,#0
001110  2200              MOVS     r2,#0
;;;1074       for(u8i=0;u8i<num-1;u8i++)
001112  bf00              NOP      
001114  e016              B        |L1.4420|
                  |L1.4374|
;;;1075       {
;;;1076           for(u8j=u8i+1;u8j<num;u8j++)
001116  1c4d              ADDS     r5,r1,#1
001118  b2ea              UXTB     r2,r5
00111a  e00f              B        |L1.4412|
                  |L1.4380|
;;;1077           {
;;;1078               if(adbuf[u8i]>adbuf[u8j])
00111c  f9305011          LDRSH    r5,[r0,r1,LSL #1]
001120  f9306012          LDRSH    r6,[r0,r2,LSL #1]
001124  42b5              CMP      r5,r6
001126  dd07              BLE      |L1.4408|
;;;1079               {
;;;1080                   u16Tmp=adbuf[u8i];
001128  f9304011          LDRSH    r4,[r0,r1,LSL #1]
;;;1081                   adbuf[u8i]=adbuf[u8j];
00112c  f8305012          LDRH     r5,[r0,r2,LSL #1]
001130  f8205011          STRH     r5,[r0,r1,LSL #1]
;;;1082                   adbuf[u8j]=u16Tmp;
001134  f8204012          STRH     r4,[r0,r2,LSL #1]
                  |L1.4408|
001138  1c55              ADDS     r5,r2,#1              ;1076
00113a  b2ea              UXTB     r2,r5                 ;1076
                  |L1.4412|
00113c  429a              CMP      r2,r3                 ;1076
00113e  dbed              BLT      |L1.4380|
001140  1c4d              ADDS     r5,r1,#1              ;1074
001142  b2e9              UXTB     r1,r5                 ;1074
                  |L1.4420|
001144  1e5d              SUBS     r5,r3,#1              ;1074
001146  428d              CMP      r5,r1                 ;1074
001148  dce5              BGT      |L1.4374|
;;;1083               }
;;;1084           }
;;;1085       }
;;;1086   }
00114a  bd70              POP      {r4-r6,pc}
;;;1087   int16_t AD_Filter(int16_t adbuf[],uint8_t num)
                          ENDP

                  AD_Filter PROC
00114c  e92d41f0          PUSH     {r4-r8,lr}
;;;1088   {
001150  4607              MOV      r7,r0
001152  460c              MOV      r4,r1
;;;1089       uint8_t u8i=0;
001154  2500              MOVS     r5,#0
;;;1090       int16_t u16Filter;
;;;1091       int32_t s32ValTmp=0;
001156  2600              MOVS     r6,#0
;;;1092       Rank(adbuf,num);
001158  4621              MOV      r1,r4
00115a  4638              MOV      r0,r7
00115c  f7fffffe          BL       Rank
;;;1093       if(num>7)
001160  2c07              CMP      r4,#7
001162  dd0f              BLE      |L1.4484|
;;;1094       {
;;;1095           for(u8i=3;u8i<num-3;u8i++)
001164  2503              MOVS     r5,#3
001166  e004              B        |L1.4466|
                  |L1.4456|
;;;1096           {
;;;1097               s32ValTmp+=adbuf[u8i];
001168  f9370015          LDRSH    r0,[r7,r5,LSL #1]
00116c  4406              ADD      r6,r6,r0
00116e  1c68              ADDS     r0,r5,#1              ;1095
001170  b2c5              UXTB     r5,r0                 ;1095
                  |L1.4466|
001172  1ee0              SUBS     r0,r4,#3              ;1095
001174  42a8              CMP      r0,r5                 ;1095
001176  dcf7              BGT      |L1.4456|
;;;1098           }
;;;1099           u16Filter=s32ValTmp/(num-6);
001178  1fa0              SUBS     r0,r4,#6
00117a  fb96f0f0          SDIV     r0,r6,r0
00117e  fa0ff880          SXTH     r8,r0
001182  e00c              B        |L1.4510|
                  |L1.4484|
;;;1100       }
;;;1101       else
;;;1102       {
;;;1103           for(u8i=0;u8i<num;u8i++)
001184  2500              MOVS     r5,#0
001186  e004              B        |L1.4498|
                  |L1.4488|
;;;1104           {
;;;1105               s32ValTmp+=adbuf[u8i];
001188  f9370015          LDRSH    r0,[r7,r5,LSL #1]
00118c  4406              ADD      r6,r6,r0
00118e  1c68              ADDS     r0,r5,#1              ;1103
001190  b2c5              UXTB     r5,r0                 ;1103
                  |L1.4498|
001192  42a5              CMP      r5,r4                 ;1103
001194  dbf8              BLT      |L1.4488|
;;;1106           }
;;;1107           u16Filter=s32ValTmp/num;
001196  fb96f0f4          SDIV     r0,r6,r4
00119a  fa0ff880          SXTH     r8,r0
                  |L1.4510|
;;;1108       }
;;;1109       return u16Filter;
00119e  4640              MOV      r0,r8
;;;1110   }
0011a0  e8bd81f0          POP      {r4-r8,pc}
;;;1111   
                          ENDP

                  cmd_hander_foc_ack PROC
;;;1116   
;;;1117   void cmd_hander_foc_ack( uint8_t *p_buf, uint16_t len )
0011a4  b570              PUSH     {r4-r6,lr}
;;;1118   {
0011a6  4604              MOV      r4,r0
0011a8  460e              MOV      r6,r1
;;;1119   	cmd_foc_ack_t *p_data  = ( cmd_foc_ack_t * )( p_buf + sizeof( cmd_header_v0_t )) ;
0011aa  1da5              ADDS     r5,r4,#6
;;;1120   	
;;;1121   //	if(ack_debug_value == EP_UART1)
;;;1122   //	{
;;;1123   	  memcpy(&debug_stFOC_Value_1 , p_data , sizeof(cmd_foc_ack_t) );
0011ac  2214              MOVS     r2,#0x14
0011ae  4629              MOV      r1,r5
0011b0  4814              LDR      r0,|L1.4612|
0011b2  f7fffffe          BL       __aeabi_memcpy
;;;1124   //	}
;;;1125   //	
;;;1126   //	
;;;1127   //	if(ack_debug_value == EP_UART3)
;;;1128   //	{
;;;1129    	  memcpy(&debug_stFOC_Value_3 , p_data , sizeof(cmd_foc_ack_t) );
0011b6  2214              MOVS     r2,#0x14
0011b8  4629              MOV      r1,r5
0011ba  4813              LDR      r0,|L1.4616|
0011bc  f7fffffe          BL       __aeabi_memcpy
;;;1130   //	}
;;;1131   	
;;;1132   }
0011c0  bd70              POP      {r4-r6,pc}
0011c2  0000              DCW      0x0000
                  |L1.4548|
                          DCD      g_u16GimbalCtl
                  |L1.4552|
                          DCD      g_current_tick
                  |L1.4556|
                          DCD      g_u32GimbalGettime
                  |L1.4560|
                          DCD      |symbol_number.29|
                  |L1.4564|
                          DCD      g_cfg_end_point
                  |L1.4568|
0011d8  72657120          DCB      "req foc ver\r\n",0
0011dc  666f6320
0011e0  7665720d
0011e4  0a00    
0011e6  00                DCB      0
0011e7  00                DCB      0
                  |L1.4584|
                          DCD      0x4cec41dd
                  |L1.4588|
                          DCD      0x3faaf3a1
                  |L1.4592|
                          DCD      Throttle_Value_1
                  |L1.4596|
                          DCD      Throttle_Value_2
                  |L1.4600|
                          DCD      feckbackID
                  |L1.4604|
                          DCD      debug_throttle_value_1
                  |L1.4608|
                          DCD      debug_throttle_value_2
                  |L1.4612|
                          DCD      debug_stFOC_Value_1
                  |L1.4616|
                          DCD      debug_stFOC_Value_3
                          ENDP

                  cmd_hander_rardar_push PROC
;;;1134   radar_data_t g_stRadarData;
;;;1135   void cmd_hander_rardar_push( uint8_t *p_buf, uint16_t len )
00120c  4770              BX       lr
;;;1136   {
;;;1137   //	cmd_radar_push_t *p_data  = ( cmd_radar_push_t * )( p_buf + sizeof( cmd_header_v0_t )) ;
;;;1138   //  
;;;1139   //	g_Distance=p_data->distance;
;;;1140   //	g_SonarGetTime = g_current_tick;
;;;1141   //	
;;;1142   //	g_stRadarData.radar_data.distance=p_data->distance;
;;;1143   //	g_stRadarData.radar_data.flag=p_data->flag;
;;;1144   //	g_stRadarData.data_flash=1;
;;;1145   //	
;;;1146   //	uart_printf(0,"flag:%d  dis:%d",p_data->flag,p_data->distance);
;;;1147   }
;;;1148   
                          ENDP

                  get_command_version PROC
;;;1180   
;;;1181   uint8_t get_command_version( uint8_t *p_buf, uint8_t len )
00120e  4602              MOV      r2,r0
;;;1182   {
001210  460b              MOV      r3,r1
;;;1183   	uint16_t vl = *( uint16_t * )&p_buf[1];
001212  f8b21001          LDRH     r1,[r2,#1]
;;;1184   	return ( uint8_t )( vl >> 10 );
001216  1288              ASRS     r0,r1,#10
;;;1185   }
001218  4770              BX       lr
;;;1186   
                          ENDP

                  command_process_v0 PROC
;;;1187   void command_process_v0( uint8_t *p_buf, uint16_t len )
00121a  e92d41f0          PUSH     {r4-r8,lr}
;;;1188   {
00121e  4605              MOV      r5,r0
001220  460e              MOV      r6,r1
;;;1189   	int i = 0;
001222  2400              MOVS     r4,#0
;;;1190   	cmd_header_v0_t	*p_cmd  = ( cmd_header_v0_t * )p_buf;
001224  462f              MOV      r7,r5
;;;1191   
;;;1192   	if( len < sizeof( cmd_header_v0_t ) ) {
001226  2e06              CMP      r6,#6
001228  d201              BCS      |L1.4654|
                  |L1.4650|
;;;1193   		return;
;;;1194   	}
;;;1195   
;;;1196   //	uart_printf( 0, "[%s, %d] command id: 0x%.4X\r\n", __FILE__, __LINE__, p_cmd->id );
;;;1197   	for( i = 0; cmd_handler_array_v0[i].handler != NULL; i++ ) {
;;;1198   		if( p_cmd->id == cmd_handler_array_v0[i].id ) {
;;;1199   			cmd_handler_array_v0[i].handler( p_buf, len );
;;;1200   		}
;;;1201   	}
;;;1202   }
00122a  e8bd81f0          POP      {r4-r8,pc}
                  |L1.4654|
00122e  2400              MOVS     r4,#0                 ;1197
001230  e00d              B        |L1.4686|
                  |L1.4658|
001232  88b8              LDRH     r0,[r7,#4]            ;1198
001234  49fe              LDR      r1,|L1.5680|
001236  eb0101c4          ADD      r1,r1,r4,LSL #3       ;1198
00123a  8889              LDRH     r1,[r1,#4]            ;1198
00123c  4288              CMP      r0,r1                 ;1198
00123e  d105              BNE      |L1.4684|
001240  48fb              LDR      r0,|L1.5680|
001242  f8502034          LDR      r2,[r0,r4,LSL #3]     ;1199
001246  4631              MOV      r1,r6                 ;1199
001248  4628              MOV      r0,r5                 ;1199
00124a  4790              BLX      r2                    ;1199
                  |L1.4684|
00124c  1c64              ADDS     r4,r4,#1              ;1197
                  |L1.4686|
00124e  48f8              LDR      r0,|L1.5680|
001250  f8500034          LDR      r0,[r0,r4,LSL #3]     ;1197
001254  2800              CMP      r0,#0                 ;1197
001256  d1ec              BNE      |L1.4658|
001258  bf00              NOP      
00125a  e7e6              B        |L1.4650|
;;;1203   
                          ENDP

                  command_process_v1 PROC
;;;1205   cmd_header_v1_t	*p_cmd = NULL;
;;;1206   void command_process_v1( uint8_t *p_buf, uint16_t len )
00125c  e92d41f0          PUSH     {r4-r8,lr}
;;;1207   {
001260  4605              MOV      r5,r0
001262  460e              MOV      r6,r1
;;;1208   	int i = 0;
001264  2400              MOVS     r4,#0
;;;1209   	cmd_header_v0_t	*p_cmd_v0  = ( cmd_header_v0_t * )p_buf;
001266  462f              MOV      r7,r5
;;;1210   	p_cmd = ( cmd_header_v1_t * )p_buf;
001268  48f2              LDR      r0,|L1.5684|
00126a  6005              STR      r5,[r0,#0]  ; p_cmd
;;;1211   
;;;1212   	
;;;1213   	if( len < sizeof( cmd_header_v1_t ) ) {
00126c  2e0b              CMP      r6,#0xb
00126e  d201              BCS      |L1.4724|
                  |L1.4720|
;;;1214   		return;
;;;1215   	}
;;;1216   
;;;1217   	if(p_cmd->vl.version==0)
;;;1218   	{
;;;1219   			for( i = 0; cmd_handler_array_v0[i].handler != NULL; i++ ) 
;;;1220   		 {
;;;1221   		  if( p_cmd_v0->id == cmd_handler_array_v0[i].id )
;;;1222    			{
;;;1223   				cmd_handler_array_v0[i].handler( p_buf, len );
;;;1224   		  }
;;;1225   	  }
;;;1226   	}
;;;1227   	else if(p_cmd->vl.version==1)
;;;1228   	{			
;;;1229   //			uart_printf( 0, "[%s, %d] command id: %d %d %d %d %d\r\n", __FILE__, __LINE__, p_cmd->set, p_cmd->type.encrypt_type, p_cmd->type.cmd_type, p_cmd->receiver.receiver_id, p_cmd->receiver.receiver_index );
;;;1230   			if(  ( ( p_cmd->receiver.receiver_id != DEVICE_ID || p_cmd->receiver.receiver_index != DEVICE_INDEX  ) && p_cmd->receiver.receiver_id != 31 && p_cmd->receiver.receiver_id !=0x01 && p_cmd->receiver.receiver_id !=0x04) ) 
;;;1231   			{
;;;1232   				if( DJI_PRO_DEVICE_TYPE_SMART_BATTERY==p_cmd->receiver.receiver_id  )
;;;1233   				{
;;;1234   					g_cfg_end_point = EP_UART2;
;;;1235   					
;;;1236                       if((p_cmd->set==0)&&(p_cmd->id == 8)){
;;;1237                           u8BatteryUpgradeFlag=1;
;;;1238                       }
;;;1239                       if(u8BatteryUpgradeFlag==1){
;;;1240                           if((p_cmd->set==0)&&((p_cmd->id == 0x08)||(p_cmd->id == 0x09)||(p_cmd->id == 0x0a))){
;;;1241                               cmd_headler_send_command_v1( p_buf, p_cmd->vl.length );
;;;1242                           }
;;;1243                       }else{
;;;1244                           cmd_headler_send_command_v1( p_buf, p_cmd->vl.length );
;;;1245                       }
;;;1246   				}else if(DJI_PRO_DEVICE_TYPE_FLIGHT_CONTROL == p_cmd->receiver.receiver_id
;;;1247    				         || DJI_PRO_DEVICE_TYPE_APP == p_cmd->receiver.receiver_id )
;;;1248   				{
;;;1249   					g_cfg_end_point = EP_CAN1;
;;;1250                       cmd_headler_send_command_v1( p_buf, p_cmd->vl.length );
;;;1251   				}else if(DJI_PRO_DEVICE_TYPE_PC==p_cmd->receiver.receiver_id)
;;;1252   				{
;;;1253                       g_cfg_end_point = EP_CAN1;
;;;1254                       cmd_headler_send_command_v1( p_buf, p_cmd->vl.length );
;;;1255                       if((p_cmd->set==0)&&(p_cmd->id == 0x0a))
;;;1256   										{
;;;1257                           u8BatteryUpgradeFlag=0;
;;;1258                       }
;;;1259                   }
;;;1260   			}else if(p_cmd->receiver.receiver_id == DEVICE_ID ) {
;;;1261   	//	uart_printf( 0, "[%s, %d] command id: 0x%.2X\r\n", __FILE__, __LINE__, p_cmd->id );
;;;1262   				for( i = 0; cmd_handler_array_v1[i].handler != NULL; i++ ) {
;;;1263   					if( p_cmd->id == cmd_handler_array_v1[i].id && p_cmd->set == cmd_handler_array_v1[i].set ) {
;;;1264   						cmd_handler_array_v1[i].handler( p_buf, len );
;;;1265   					}
;;;1266   				}
;;;1267   		}
;;;1268   	}
;;;1269   }
001270  e8bd81f0          POP      {r4-r8,pc}
                  |L1.4724|
001274  48ef              LDR      r0,|L1.5684|
001276  6800              LDR      r0,[r0,#0]            ;1217  ; p_cmd
001278  7880              LDRB     r0,[r0,#2]            ;1217
00127a  0880              LSRS     r0,r0,#2              ;1217
00127c  b9a8              CBNZ     r0,|L1.4778|
00127e  2400              MOVS     r4,#0                 ;1219
001280  e00d              B        |L1.4766|
                  |L1.4738|
001282  88b8              LDRH     r0,[r7,#4]            ;1221
001284  49ea              LDR      r1,|L1.5680|
001286  eb0101c4          ADD      r1,r1,r4,LSL #3       ;1221
00128a  8889              LDRH     r1,[r1,#4]            ;1221
00128c  4288              CMP      r0,r1                 ;1221
00128e  d105              BNE      |L1.4764|
001290  48e7              LDR      r0,|L1.5680|
001292  f8502034          LDR      r2,[r0,r4,LSL #3]     ;1223
001296  4631              MOV      r1,r6                 ;1223
001298  4628              MOV      r0,r5                 ;1223
00129a  4790              BLX      r2                    ;1223
                  |L1.4764|
00129c  1c64              ADDS     r4,r4,#1              ;1219
                  |L1.4766|
00129e  48e4              LDR      r0,|L1.5680|
0012a0  f8500034          LDR      r0,[r0,r4,LSL #3]     ;1219
0012a4  2800              CMP      r0,#0                 ;1219
0012a6  d1ec              BNE      |L1.4738|
                  |L1.4776|
0012a8  e0cd              B        |L1.5190|
                  |L1.4778|
0012aa  48e2              LDR      r0,|L1.5684|
0012ac  6800              LDR      r0,[r0,#0]            ;1227  ; p_cmd
0012ae  7880              LDRB     r0,[r0,#2]            ;1227
0012b0  2101              MOVS     r1,#1                 ;1227
0012b2  ebb10f90          CMP      r1,r0,LSR #2          ;1227
0012b6  d1f7              BNE      |L1.4776|
0012b8  48de              LDR      r0,|L1.5684|
0012ba  6800              LDR      r0,[r0,#0]            ;1230  ; p_cmd
0012bc  7940              LDRB     r0,[r0,#5]            ;1230
0012be  f000001f          AND      r0,r0,#0x1f           ;1230
0012c2  281c              CMP      r0,#0x1c              ;1230
0012c4  d105              BNE      |L1.4818|
0012c6  48db              LDR      r0,|L1.5684|
0012c8  6800              LDR      r0,[r0,#0]            ;1230  ; p_cmd
0012ca  7940              LDRB     r0,[r0,#5]            ;1230
0012cc  0940              LSRS     r0,r0,#5              ;1230
0012ce  2800              CMP      r0,#0                 ;1230
                  |L1.4816|
0012d0  d071              BEQ      |L1.5046|
                  |L1.4818|
0012d2  48d8              LDR      r0,|L1.5684|
0012d4  6800              LDR      r0,[r0,#0]            ;1230  ; p_cmd
0012d6  7940              LDRB     r0,[r0,#5]            ;1230
0012d8  f000001f          AND      r0,r0,#0x1f           ;1230
0012dc  281f              CMP      r0,#0x1f              ;1230
0012de  d0f7              BEQ      |L1.4816|
0012e0  48d4              LDR      r0,|L1.5684|
0012e2  6800              LDR      r0,[r0,#0]            ;1230  ; p_cmd
0012e4  7940              LDRB     r0,[r0,#5]            ;1230
0012e6  f000001f          AND      r0,r0,#0x1f           ;1230
0012ea  2801              CMP      r0,#1                 ;1230
0012ec  d063              BEQ      |L1.5046|
0012ee  48d1              LDR      r0,|L1.5684|
0012f0  6800              LDR      r0,[r0,#0]            ;1230  ; p_cmd
0012f2  7940              LDRB     r0,[r0,#5]            ;1230
0012f4  f000001f          AND      r0,r0,#0x1f           ;1230
0012f8  2804              CMP      r0,#4                 ;1230
0012fa  d07d              BEQ      |L1.5112|
0012fc  48cd              LDR      r0,|L1.5684|
0012fe  6800              LDR      r0,[r0,#0]            ;1232  ; p_cmd
001300  7940              LDRB     r0,[r0,#5]            ;1232
001302  f000001f          AND      r0,r0,#0x1f           ;1232
001306  280b              CMP      r0,#0xb               ;1232
001308  d13a              BNE      |L1.4992|
00130a  2006              MOVS     r0,#6                 ;1234
00130c  49ca              LDR      r1,|L1.5688|
00130e  6008              STR      r0,[r1,#0]            ;1234  ; g_cfg_end_point
001310  48c8              LDR      r0,|L1.5684|
001312  6800              LDR      r0,[r0,#0]            ;1236  ; p_cmd
001314  7a40              LDRB     r0,[r0,#9]            ;1236
001316  b938              CBNZ     r0,|L1.4904|
001318  48c6              LDR      r0,|L1.5684|
00131a  6800              LDR      r0,[r0,#0]            ;1236  ; p_cmd
00131c  7a80              LDRB     r0,[r0,#0xa]          ;1236
00131e  2808              CMP      r0,#8                 ;1236
001320  d102              BNE      |L1.4904|
001322  2001              MOVS     r0,#1                 ;1237
001324  49c5              LDR      r1,|L1.5692|
001326  7008              STRB     r0,[r1,#0]            ;1237
                  |L1.4904|
001328  48c4              LDR      r0,|L1.5692|
00132a  7800              LDRB     r0,[r0,#0]            ;1239  ; u8BatteryUpgradeFlag
00132c  2801              CMP      r0,#1                 ;1239
00132e  d11d              BNE      |L1.4972|
001330  48c0              LDR      r0,|L1.5684|
001332  6800              LDR      r0,[r0,#0]            ;1240  ; p_cmd
001334  7a40              LDRB     r0,[r0,#9]            ;1240
001336  2800              CMP      r0,#0                 ;1240
001338  d117              BNE      |L1.4970|
00133a  48be              LDR      r0,|L1.5684|
00133c  6800              LDR      r0,[r0,#0]            ;1240  ; p_cmd
00133e  7a80              LDRB     r0,[r0,#0xa]          ;1240
001340  2808              CMP      r0,#8                 ;1240
001342  d009              BEQ      |L1.4952|
001344  48bb              LDR      r0,|L1.5684|
001346  6800              LDR      r0,[r0,#0]            ;1240  ; p_cmd
001348  7a80              LDRB     r0,[r0,#0xa]          ;1240
00134a  2809              CMP      r0,#9                 ;1240
00134c  d004              BEQ      |L1.4952|
00134e  48b9              LDR      r0,|L1.5684|
001350  6800              LDR      r0,[r0,#0]            ;1240  ; p_cmd
001352  7a80              LDRB     r0,[r0,#0xa]          ;1240
001354  280a              CMP      r0,#0xa               ;1240
001356  d176              BNE      |L1.5190|
                  |L1.4952|
001358  48b6              LDR      r0,|L1.5684|
00135a  6800              LDR      r0,[r0,#0]            ;1241  ; p_cmd
00135c  f8b00001          LDRH     r0,[r0,#1]            ;1241
001360  f3c00109          UBFX     r1,r0,#0,#10          ;1241
001364  4628              MOV      r0,r5                 ;1241
001366  f7fffffe          BL       cmd_headler_send_command_v1
                  |L1.4970|
00136a  e06c              B        |L1.5190|
                  |L1.4972|
00136c  48b1              LDR      r0,|L1.5684|
00136e  6800              LDR      r0,[r0,#0]            ;1244  ; p_cmd
001370  f8b00001          LDRH     r0,[r0,#1]            ;1244
001374  f3c00109          UBFX     r1,r0,#0,#10          ;1244
001378  4628              MOV      r0,r5                 ;1244
00137a  f7fffffe          BL       cmd_headler_send_command_v1
00137e  e062              B        |L1.5190|
                  |L1.4992|
001380  48ac              LDR      r0,|L1.5684|
001382  6800              LDR      r0,[r0,#0]            ;1246  ; p_cmd
001384  7940              LDRB     r0,[r0,#5]            ;1246
001386  f000001f          AND      r0,r0,#0x1f           ;1246
00138a  2803              CMP      r0,#3                 ;1246
00138c  d006              BEQ      |L1.5020|
00138e  48a9              LDR      r0,|L1.5684|
001390  6800              LDR      r0,[r0,#0]            ;1247  ; p_cmd
001392  7940              LDRB     r0,[r0,#5]            ;1247
001394  f000001f          AND      r0,r0,#0x1f           ;1247
001398  2802              CMP      r0,#2                 ;1247
00139a  d10d              BNE      |L1.5048|
                  |L1.5020|
00139c  2001              MOVS     r0,#1                 ;1249
00139e  49a6              LDR      r1,|L1.5688|
0013a0  6008              STR      r0,[r1,#0]            ;1249  ; g_cfg_end_point
0013a2  48a4              LDR      r0,|L1.5684|
0013a4  6800              LDR      r0,[r0,#0]            ;1250  ; p_cmd
0013a6  f8b00001          LDRH     r0,[r0,#1]            ;1250
0013aa  f3c00109          UBFX     r1,r0,#0,#10          ;1250
0013ae  4628              MOV      r0,r5                 ;1250
0013b0  f7fffffe          BL       cmd_headler_send_command_v1
0013b4  e047              B        |L1.5190|
                  |L1.5046|
0013b6  e01f              B        |L1.5112|
                  |L1.5048|
0013b8  489e              LDR      r0,|L1.5684|
0013ba  6800              LDR      r0,[r0,#0]            ;1251  ; p_cmd
0013bc  7940              LDRB     r0,[r0,#5]            ;1251
0013be  f000001f          AND      r0,r0,#0x1f           ;1251
0013c2  280a              CMP      r0,#0xa               ;1251
0013c4  d13f              BNE      |L1.5190|
0013c6  2001              MOVS     r0,#1                 ;1253
0013c8  499b              LDR      r1,|L1.5688|
0013ca  6008              STR      r0,[r1,#0]            ;1253  ; g_cfg_end_point
0013cc  4899              LDR      r0,|L1.5684|
0013ce  6800              LDR      r0,[r0,#0]            ;1254  ; p_cmd
0013d0  f8b00001          LDRH     r0,[r0,#1]            ;1254
0013d4  f3c00109          UBFX     r1,r0,#0,#10          ;1254
0013d8  4628              MOV      r0,r5                 ;1254
0013da  f7fffffe          BL       cmd_headler_send_command_v1
0013de  4895              LDR      r0,|L1.5684|
0013e0  6800              LDR      r0,[r0,#0]            ;1255  ; p_cmd
0013e2  7a40              LDRB     r0,[r0,#9]            ;1255
0013e4  bb78              CBNZ     r0,|L1.5190|
0013e6  4893              LDR      r0,|L1.5684|
0013e8  6800              LDR      r0,[r0,#0]            ;1255  ; p_cmd
0013ea  7a80              LDRB     r0,[r0,#0xa]          ;1255
0013ec  280a              CMP      r0,#0xa               ;1255
0013ee  d12a              BNE      |L1.5190|
0013f0  2000              MOVS     r0,#0                 ;1257
0013f2  4992              LDR      r1,|L1.5692|
0013f4  7008              STRB     r0,[r1,#0]            ;1257
0013f6  e026              B        |L1.5190|
                  |L1.5112|
0013f8  488e              LDR      r0,|L1.5684|
0013fa  6800              LDR      r0,[r0,#0]            ;1260  ; p_cmd
0013fc  7940              LDRB     r0,[r0,#5]            ;1260
0013fe  f000001f          AND      r0,r0,#0x1f           ;1260
001402  281c              CMP      r0,#0x1c              ;1260
001404  d11f              BNE      |L1.5190|
001406  2400              MOVS     r4,#0                 ;1262
001408  e018              B        |L1.5180|
                  |L1.5130|
00140a  488a              LDR      r0,|L1.5684|
00140c  6800              LDR      r0,[r0,#0]            ;1263  ; p_cmd
00140e  7a80              LDRB     r0,[r0,#0xa]          ;1263
001410  498b              LDR      r1,|L1.5696|
001412  eb0101c4          ADD      r1,r1,r4,LSL #3       ;1263
001416  7909              LDRB     r1,[r1,#4]            ;1263
001418  4288              CMP      r0,r1                 ;1263
00141a  d10e              BNE      |L1.5178|
00141c  4885              LDR      r0,|L1.5684|
00141e  6800              LDR      r0,[r0,#0]            ;1263  ; p_cmd
001420  7a40              LDRB     r0,[r0,#9]            ;1263
001422  4987              LDR      r1,|L1.5696|
001424  eb0101c4          ADD      r1,r1,r4,LSL #3       ;1263
001428  7949              LDRB     r1,[r1,#5]            ;1263
00142a  4288              CMP      r0,r1                 ;1263
00142c  d105              BNE      |L1.5178|
00142e  4884              LDR      r0,|L1.5696|
001430  f8502034          LDR      r2,[r0,r4,LSL #3]     ;1264
001434  4631              MOV      r1,r6                 ;1264
001436  4628              MOV      r0,r5                 ;1264
001438  4790              BLX      r2                    ;1264
                  |L1.5178|
00143a  1c64              ADDS     r4,r4,#1              ;1262
                  |L1.5180|
00143c  4880              LDR      r0,|L1.5696|
00143e  f8500034          LDR      r0,[r0,r4,LSL #3]     ;1262
001442  2800              CMP      r0,#0                 ;1262
001444  d1e1              BNE      |L1.5130|
                  |L1.5190|
001446  bf00              NOP      
001448  e712              B        |L1.4720|
;;;1270   
                          ENDP

                  cfg_status_report PROC
;;;1271   void cfg_status_report( void )
00144a  b530              PUSH     {r4,r5,lr}
;;;1272   {
00144c  b0a1              SUB      sp,sp,#0x84
;;;1273   	uint8_t tmpBuf[128] = { 0 };
00144e  2180              MOVS     r1,#0x80
001450  a801              ADD      r0,sp,#4
001452  f7fffffe          BL       __aeabi_memclr4
;;;1274   
;;;1275   	cmd_header_v1_t *p_cmd = ( cmd_header_v1_t * )tmpBuf;
001456  ac01              ADD      r4,sp,#4
;;;1276   	cmd_status_report_ack_t *p_sra = ( cmd_status_report_ack_t * )( tmpBuf + sizeof( cmd_header_v1_t ) );
001458  f10d050f          ADD      r5,sp,#0xf
;;;1277   
;;;1278   	if( g_device_status == 0 ) return; 
00145c  4879              LDR      r0,|L1.5700|
00145e  6800              LDR      r0,[r0,#0]  ; g_device_status
001460  b908              CBNZ     r0,|L1.5222|
                  |L1.5218|
;;;1279   
;;;1280   	p_cmd->sof = 0x55;
;;;1281   	p_cmd->vl.version = 1;
;;;1282   	p_cmd->sender.sender_id = DEVICE_ID;
;;;1283   	p_cmd->sender.sender_index = DEVICE_INDEX;
;;;1284   	p_cmd->receiver.receiver_id = 31; // broadcast
;;;1285   	p_cmd->receiver.receiver_index = 0;
;;;1286   	p_cmd->seqnum = 0xFFFF;
;;;1287   	p_cmd->type.cmd_type = 1;
;;;1288   	p_cmd->type.cmd_ack = 0;
;;;1289   	p_cmd->type.encrypt_type = 0;
;;;1290   	p_cmd->set = 0;
;;;1291   	p_cmd->id = 0x0C;
;;;1292   
;;;1293   	p_sra->result = 0;
;;;1294   	p_sra->ver.major = 0;
;;;1295   	p_sra->ver.minor = 0;
;;;1296   	p_sra->status = g_device_status;
;;;1297   	
;;;1298   	p_cmd->vl.length = sizeof( cmd_header_v1_t ) + sizeof( cmd_status_report_ack_t ) + 2;
;;;1299   	
;;;1300   	cmd_headler_send_command_v1( tmpBuf, p_cmd->vl.length );
;;;1301   }
001462  b021              ADD      sp,sp,#0x84
001464  bd30              POP      {r4,r5,pc}
                  |L1.5222|
001466  2055              MOVS     r0,#0x55              ;1280
001468  7020              STRB     r0,[r4,#0]            ;1280
00146a  78a0              LDRB     r0,[r4,#2]            ;1281
00146c  f02000fc          BIC      r0,r0,#0xfc           ;1281
001470  1d00              ADDS     r0,r0,#4              ;1281
001472  70a0              STRB     r0,[r4,#2]            ;1281
001474  7920              LDRB     r0,[r4,#4]            ;1282
001476  f020001f          BIC      r0,r0,#0x1f           ;1282
00147a  301c              ADDS     r0,r0,#0x1c           ;1282
00147c  7120              STRB     r0,[r4,#4]            ;1282
00147e  7920              LDRB     r0,[r4,#4]            ;1283
001480  f02000e0          BIC      r0,r0,#0xe0           ;1283
001484  7120              STRB     r0,[r4,#4]            ;1283
001486  7960              LDRB     r0,[r4,#5]            ;1284
001488  f020001f          BIC      r0,r0,#0x1f           ;1284
00148c  301f              ADDS     r0,r0,#0x1f           ;1284
00148e  7160              STRB     r0,[r4,#5]            ;1284
001490  7960              LDRB     r0,[r4,#5]            ;1285
001492  f02000e0          BIC      r0,r0,#0xe0           ;1285
001496  7160              STRB     r0,[r4,#5]            ;1285
001498  f64f70ff          MOV      r0,#0xffff            ;1286
00149c  80e0              STRH     r0,[r4,#6]            ;1286
00149e  7a20              LDRB     r0,[r4,#8]            ;1287
0014a0  f0200080          BIC      r0,r0,#0x80           ;1287
0014a4  3080              ADDS     r0,r0,#0x80           ;1287
0014a6  7220              STRB     r0,[r4,#8]            ;1287
0014a8  7a20              LDRB     r0,[r4,#8]            ;1288
0014aa  f0200060          BIC      r0,r0,#0x60           ;1288
0014ae  7220              STRB     r0,[r4,#8]            ;1288
0014b0  7a20              LDRB     r0,[r4,#8]            ;1289
0014b2  f020000f          BIC      r0,r0,#0xf            ;1289
0014b6  7220              STRB     r0,[r4,#8]            ;1289
0014b8  2000              MOVS     r0,#0                 ;1290
0014ba  7260              STRB     r0,[r4,#9]            ;1290
0014bc  200c              MOVS     r0,#0xc               ;1291
0014be  72a0              STRB     r0,[r4,#0xa]          ;1291
0014c0  2000              MOVS     r0,#0                 ;1293
0014c2  7028              STRB     r0,[r5,#0]            ;1293
0014c4  7868              LDRB     r0,[r5,#1]            ;1294
0014c6  f02000f0          BIC      r0,r0,#0xf0           ;1294
0014ca  7068              STRB     r0,[r5,#1]            ;1294
0014cc  7868              LDRB     r0,[r5,#1]            ;1295
0014ce  f020000f          BIC      r0,r0,#0xf            ;1295
0014d2  7068              STRB     r0,[r5,#1]            ;1295
0014d4  485b              LDR      r0,|L1.5700|
0014d6  6800              LDR      r0,[r0,#0]            ;1296  ; g_device_status
0014d8  f8c50002          STR      r0,[r5,#2]            ;1296
0014dc  f8b40001          LDRH     r0,[r4,#1]            ;1298
0014e0  f36f0009          BFC      r0,#0,#10             ;1298
0014e4  3013              ADDS     r0,r0,#0x13           ;1298
0014e6  f8a40001          STRH     r0,[r4,#1]            ;1298
0014ea  f8b40001          LDRH     r0,[r4,#1]            ;1300
0014ee  f3c00109          UBFX     r1,r0,#0,#10          ;1300
0014f2  a801              ADD      r0,sp,#4              ;1300
0014f4  f7fffffe          BL       cmd_headler_send_command_v1
0014f8  bf00              NOP      
0014fa  e7b2              B        |L1.5218|
;;;1302   
                          ENDP

                  can_upgrade_ack PROC
;;;1303   
;;;1304   void can_upgrade_ack( uint8_t * buf , uint16_t len )
0014fc  b570              PUSH     {r4-r6,lr}
;;;1305   {
0014fe  4604              MOV      r4,r0
001500  460d              MOV      r5,r1
;;;1306   	CAN_sendbytes_View( LPC_CAN1, &can1UpgradeAckTxRingBuf, buf, len );
001502  462b              MOV      r3,r5
001504  4622              MOV      r2,r4
001506  4950              LDR      r1,|L1.5704|
001508  4850              LDR      r0,|L1.5708|
00150a  f7fffffe          BL       CAN_sendbytes_View
;;;1307   }
00150e  bd70              POP      {r4-r6,pc}
;;;1308   
                          ENDP

                  IOSD_Block_ID_Request PROC
;;;1334   cmd_iosd_status_ack_t cmd_iosd_status_ack; 
;;;1335   void IOSD_Block_ID_Request( void )
001510  b530              PUSH     {r4,r5,lr}
;;;1336   {
001512  b085              SUB      sp,sp,#0x14
;;;1337   	uint8_t tmpBuf[20] = {0};
001514  2114              MOVS     r1,#0x14
001516  4668              MOV      r0,sp
001518  f7fffffe          BL       __aeabi_memclr4
;;;1338   	static uint16_t seq=0;
;;;1339     cmd_header_v1_t *p_cmd = (cmd_header_v1_t *)tmpBuf;
00151c  466c              MOV      r4,sp
;;;1340     cmd_iosd_req_t *p_data = (cmd_iosd_req_t *)(tmpBuf + sizeof( cmd_header_v1_t ));
00151e  f10d050b          ADD      r5,sp,#0xb
;;;1341   
;;;1342   	p_cmd->sof = 0x55;
001522  2055              MOVS     r0,#0x55
001524  7020              STRB     r0,[r4,#0]
;;;1343   	p_cmd->vl.version = 1;
001526  78a0              LDRB     r0,[r4,#2]
001528  f02000fc          BIC      r0,r0,#0xfc
00152c  1d00              ADDS     r0,r0,#4
00152e  70a0              STRB     r0,[r4,#2]
;;;1344   	p_cmd->sender.sender_id = DEVICE_ID;
001530  1c64              ADDS     r4,r4,#1
001532  78e0              LDRB     r0,[r4,#3]
001534  f020001f          BIC      r0,r0,#0x1f
001538  301c              ADDS     r0,r0,#0x1c
00153a  70e0              STRB     r0,[r4,#3]
;;;1345   	p_cmd->sender.sender_index = DEVICE_INDEX;
00153c  78e0              LDRB     r0,[r4,#3]
00153e  f02000e0          BIC      r0,r0,#0xe0
001542  70e0              STRB     r0,[r4,#3]
;;;1346   	p_cmd->receiver.receiver_id = 0x03; // 飞控
001544  7920              LDRB     r0,[r4,#4]
001546  f020001f          BIC      r0,r0,#0x1f
00154a  1cc0              ADDS     r0,r0,#3
00154c  7120              STRB     r0,[r4,#4]
;;;1347   	p_cmd->receiver.receiver_index = 0;
00154e  7920              LDRB     r0,[r4,#4]
001550  f02000e0          BIC      r0,r0,#0xe0
001554  7120              STRB     r0,[r4,#4]
;;;1348   	p_cmd->seqnum = seq++;
001556  483e              LDR      r0,|L1.5712|
001558  8800              LDRH     r0,[r0,#0]  ; seq
00155a  f8a40005          STRH     r0,[r4,#5]
00155e  483c              LDR      r0,|L1.5712|
001560  8800              LDRH     r0,[r0,#0]  ; seq
001562  1c40              ADDS     r0,r0,#1
001564  493a              LDR      r1,|L1.5712|
001566  8008              STRH     r0,[r1,#0]
;;;1349   	p_cmd->type.cmd_type = 0;
001568  79e0              LDRB     r0,[r4,#7]
00156a  f0200080          BIC      r0,r0,#0x80
00156e  71e0              STRB     r0,[r4,#7]
;;;1350   	p_cmd->type.cmd_ack =  1; // 需要应答
001570  79e0              LDRB     r0,[r4,#7]
001572  f0200060          BIC      r0,r0,#0x60
001576  3020              ADDS     r0,r0,#0x20
001578  71e0              STRB     r0,[r4,#7]
;;;1351   	p_cmd->type.encrypt_type = 0;
00157a  79e0              LDRB     r0,[r4,#7]
00157c  f020000f          BIC      r0,r0,#0xf
001580  71e0              STRB     r0,[r4,#7]
;;;1352   	p_cmd->set = 0xe;
001582  200e              MOVS     r0,#0xe
001584  7220              STRB     r0,[r4,#8]
;;;1353   	p_cmd->id = 0x01;
001586  2001              MOVS     r0,#1
001588  7260              STRB     r0,[r4,#9]
;;;1354   	p_cmd->vl.length = sizeof(cmd_header_v1_t) + sizeof(cmd_iosd_req_t)+ CRC_16_LENGTH;
00158a  8820              LDRH     r0,[r4,#0]
00158c  f36f0009          BFC      r0,#0,#10
001590  300e              ADDS     r0,r0,#0xe
001592  8020              STRH     r0,[r4,#0]
;;;1355     
;;;1356   	cmd_iosd_status_ack.status_flag = 1;//默认非空闲状态
001594  2001              MOVS     r0,#1
001596  492f              LDR      r1,|L1.5716|
001598  7048              STRB     r0,[r1,#1]
;;;1357   	
;;;1358     //smm_1++;
;;;1359   	p_data->tag = MY_DEVICE_TAG;	
00159a  7028              STRB     r0,[r5,#0]
;;;1360   	Append_CRC8_Check_Sum( tmpBuf, 4 );
00159c  2104              MOVS     r1,#4
00159e  4668              MOV      r0,sp
0015a0  f7fffffe          BL       Append_CRC8_Check_Sum
;;;1361   	Append_CRC16_Check_Sum( tmpBuf, p_cmd->vl.length );
0015a4  8820              LDRH     r0,[r4,#0]
0015a6  f3c00109          UBFX     r1,r0,#0,#10
0015aa  4668              MOV      r0,sp
0015ac  f7fffffe          BL       Append_CRC16_Check_Sum
;;;1362   	CAN_sendbytes_View( LPC_CAN1, &can1Tx3RingBuf, tmpBuf, p_cmd->vl.length );
0015b0  f8340901          LDRH     r0,[r4],#-1
0015b4  f3c00309          UBFX     r3,r0,#0,#10
0015b8  466a              MOV      r2,sp
0015ba  4927              LDR      r1,|L1.5720|
0015bc  4823              LDR      r0,|L1.5708|
0015be  f7fffffe          BL       CAN_sendbytes_View
;;;1363   }
0015c2  b005              ADD      sp,sp,#0x14
0015c4  bd30              POP      {r4,r5,pc}
;;;1364   
                          ENDP

                  cmd_handler_Block_ID_ack PROC
;;;1365   cmd_iosd_ack_t cmd_iosd_ack; 
;;;1366   void cmd_handler_Block_ID_ack(uint8_t *p_buf, uint16_t len) 
0015c6  b510              PUSH     {r4,lr}
;;;1367   {
0015c8  460a              MOV      r2,r1
;;;1368   	cmd_iosd_ack_t *p_rr = ( cmd_iosd_ack_t*)( p_buf + sizeof( cmd_header_v1_t ) );
0015ca  f100010b          ADD      r1,r0,#0xb
;;;1369   	Block_ID = p_rr->Block_ID;
0015ce  884b              LDRH     r3,[r1,#2]
0015d0  4c22              LDR      r4,|L1.5724|
0015d2  8023              STRH     r3,[r4,#0]
;;;1370     memcpy(&cmd_iosd_ack,p_rr,sizeof(cmd_iosd_ack_t));
0015d4  4b22              LDR      r3,|L1.5728|
0015d6  680c              LDR      r4,[r1,#0]
0015d8  601c              STR      r4,[r3,#0]  ; cmd_iosd_ack
0015da  790c              LDRB     r4,[r1,#4]
0015dc  711c              STRB     r4,[r3,#4]
;;;1371   }
0015de  bd10              POP      {r4,pc}
;;;1372   
                          ENDP

                  IOSD_status_inquire PROC
;;;1374   
;;;1375   void IOSD_status_inquire(void)
0015e0  b530              PUSH     {r4,r5,lr}
;;;1376   {
0015e2  b085              SUB      sp,sp,#0x14
;;;1377   	uint8_t tmpBuf[20] = {0};
0015e4  2114              MOVS     r1,#0x14
0015e6  4668              MOV      r0,sp
0015e8  f7fffffe          BL       __aeabi_memclr4
;;;1378   	static uint16_t seq=0;
;;;1379     cmd_header_v1_t *p_cmd = (cmd_header_v1_t *)tmpBuf;
0015ec  466c              MOV      r4,sp
;;;1380     cmd_iosd_status_inquire_t *p_data = (cmd_iosd_status_inquire_t *)(tmpBuf + sizeof( cmd_header_v1_t ));
0015ee  f10d050b          ADD      r5,sp,#0xb
;;;1381   
;;;1382   	p_cmd->sof = 0x55;
0015f2  2055              MOVS     r0,#0x55
0015f4  7020              STRB     r0,[r4,#0]
;;;1383   	p_cmd->vl.version = 1;
0015f6  78a0              LDRB     r0,[r4,#2]
0015f8  f02000fc          BIC      r0,r0,#0xfc
0015fc  1d00              ADDS     r0,r0,#4
0015fe  70a0              STRB     r0,[r4,#2]
;;;1384   	p_cmd->sender.sender_id = DEVICE_ID;
001600  1c64              ADDS     r4,r4,#1
001602  78e0              LDRB     r0,[r4,#3]
001604  f020001f          BIC      r0,r0,#0x1f
001608  301c              ADDS     r0,r0,#0x1c
00160a  70e0              STRB     r0,[r4,#3]
;;;1385   	p_cmd->sender.sender_index = DEVICE_INDEX;
00160c  78e0              LDRB     r0,[r4,#3]
00160e  f02000e0          BIC      r0,r0,#0xe0
001612  70e0              STRB     r0,[r4,#3]
;;;1386   	p_cmd->receiver.receiver_id = 0x03; // 飞控
001614  7920              LDRB     r0,[r4,#4]
001616  f020001f          BIC      r0,r0,#0x1f
00161a  1cc0              ADDS     r0,r0,#3
00161c  7120              STRB     r0,[r4,#4]
;;;1387   	p_cmd->receiver.receiver_index = 0;
00161e  7920              LDRB     r0,[r4,#4]
001620  f02000e0          BIC      r0,r0,#0xe0
001624  7120              STRB     r0,[r4,#4]
;;;1388   	p_cmd->seqnum = seq++;
001626  480f              LDR      r0,|L1.5732|
001628  8800              LDRH     r0,[r0,#0]  ; seq
00162a  f8a40005          STRH     r0,[r4,#5]
00162e  e01b              B        |L1.5736|
                  |L1.5680|
                          DCD      cmd_handler_array_v0
                  |L1.5684|
                          DCD      p_cmd
                  |L1.5688|
                          DCD      g_cfg_end_point
                  |L1.5692|
                          DCD      u8BatteryUpgradeFlag
                  |L1.5696|
                          DCD      cmd_handler_array_v1
                  |L1.5700|
                          DCD      g_device_status
                  |L1.5704|
                          DCD      can1UpgradeAckTxRingBuf
                  |L1.5708|
                          DCD      0x40044000
                  |L1.5712|
                          DCD      |symbol_number.30|
                  |L1.5716|
                          DCD      cmd_iosd_status_ack
                  |L1.5720|
                          DCD      can1Tx3RingBuf
                  |L1.5724|
                          DCD      Block_ID
                  |L1.5728|
                          DCD      cmd_iosd_ack
                  |L1.5732|
                          DCD      |symbol_number.31|
                  |L1.5736|
001668  48d3              LDR      r0,|L1.6584|
00166a  8800              LDRH     r0,[r0,#0]  ; seq
00166c  1c40              ADDS     r0,r0,#1
00166e  49d2              LDR      r1,|L1.6584|
001670  8008              STRH     r0,[r1,#0]
;;;1389   	p_cmd->type.cmd_type = 0;
001672  79e0              LDRB     r0,[r4,#7]
001674  f0200080          BIC      r0,r0,#0x80
001678  71e0              STRB     r0,[r4,#7]
;;;1390   	p_cmd->type.cmd_ack =  1; // 需要应答
00167a  79e0              LDRB     r0,[r4,#7]
00167c  f0200060          BIC      r0,r0,#0x60
001680  3020              ADDS     r0,r0,#0x20
001682  71e0              STRB     r0,[r4,#7]
;;;1391   	p_cmd->type.encrypt_type = 0;
001684  79e0              LDRB     r0,[r4,#7]
001686  f020000f          BIC      r0,r0,#0xf
00168a  71e0              STRB     r0,[r4,#7]
;;;1392   	p_cmd->set = 0xe;
00168c  200e              MOVS     r0,#0xe
00168e  7220              STRB     r0,[r4,#8]
;;;1393   	p_cmd->id = 0x02;
001690  2002              MOVS     r0,#2
001692  7260              STRB     r0,[r4,#9]
;;;1394   	p_cmd->vl.length = sizeof(cmd_header_v1_t) + sizeof(cmd_iosd_status_inquire_t)+ CRC_16_LENGTH;
001694  8820              LDRH     r0,[r4,#0]
001696  f36f0009          BFC      r0,#0,#10
00169a  300e              ADDS     r0,r0,#0xe
00169c  8020              STRH     r0,[r4,#0]
;;;1395     p_data->reserve = 0;
00169e  2000              MOVS     r0,#0
0016a0  7028              STRB     r0,[r5,#0]
;;;1396    // smm_2++;
;;;1397   	Append_CRC8_Check_Sum( tmpBuf, 4 );
0016a2  2104              MOVS     r1,#4
0016a4  4668              MOV      r0,sp
0016a6  f7fffffe          BL       Append_CRC8_Check_Sum
;;;1398   	Append_CRC16_Check_Sum( tmpBuf, p_cmd->vl.length );
0016aa  8820              LDRH     r0,[r4,#0]
0016ac  f3c00109          UBFX     r1,r0,#0,#10
0016b0  4668              MOV      r0,sp
0016b2  f7fffffe          BL       Append_CRC16_Check_Sum
;;;1399   	CAN_sendbytes_View( LPC_CAN1, &can1Tx3RingBuf, tmpBuf, p_cmd->vl.length );
0016b6  f8340901          LDRH     r0,[r4],#-1
0016ba  f3c00309          UBFX     r3,r0,#0,#10
0016be  466a              MOV      r2,sp
0016c0  49be              LDR      r1,|L1.6588|
0016c2  48bf              LDR      r0,|L1.6592|
0016c4  f7fffffe          BL       CAN_sendbytes_View
;;;1400   }
0016c8  b005              ADD      sp,sp,#0x14
0016ca  bd30              POP      {r4,r5,pc}
;;;1401   
                          ENDP

                  cmd_handler_iosd_status_ack PROC
;;;1402   void cmd_handler_iosd_status_ack(uint8_t *p_buf, uint16_t len) 
0016cc  b510              PUSH     {r4,lr}
;;;1403   {
0016ce  460a              MOV      r2,r1
;;;1404   	cmd_iosd_status_ack_t *p_rr = (cmd_iosd_status_ack_t*)( p_buf + sizeof( cmd_header_v1_t ) );
0016d0  f100010b          ADD      r1,r0,#0xb
;;;1405     memcpy(&cmd_iosd_status_ack,p_rr,sizeof(cmd_iosd_status_ack_t));
0016d4  4bbb              LDR      r3,|L1.6596|
0016d6  880c              LDRH     r4,[r1,#0]
0016d8  801c              STRH     r4,[r3,#0]
;;;1406   }
0016da  bd10              POP      {r4,pc}
;;;1407   /******************************** 配置信息推送 **************************************************/
                          ENDP

                  IOSD_Config_Info_Push PROC
;;;1408   
;;;1409   void IOSD_Config_Info_Push(void)
0016dc  b530              PUSH     {r4,r5,lr}
;;;1410   {
0016de  b09f              SUB      sp,sp,#0x7c
;;;1411   	uint8_t tmpBuf[120] = {0};
0016e0  2178              MOVS     r1,#0x78
0016e2  a801              ADD      r0,sp,#4
0016e4  f7fffffe          BL       __aeabi_memclr4
;;;1412   	static uint16_t seq=0;
;;;1413     cmd_header_v1_t *p_cmd = (cmd_header_v1_t *)tmpBuf;
0016e8  ac01              ADD      r4,sp,#4
;;;1414     cmd_iosd_config_t *p_data = (cmd_iosd_config_t *)(tmpBuf + sizeof( cmd_header_v1_t ));
0016ea  f10d050f          ADD      r5,sp,#0xf
;;;1415   
;;;1416   	p_cmd->sof = 0x55;
0016ee  2055              MOVS     r0,#0x55
0016f0  7020              STRB     r0,[r4,#0]
;;;1417   	p_cmd->vl.version = 1;
0016f2  78a0              LDRB     r0,[r4,#2]
0016f4  f02000fc          BIC      r0,r0,#0xfc
0016f8  1d00              ADDS     r0,r0,#4
0016fa  70a0              STRB     r0,[r4,#2]
;;;1418   	p_cmd->sender.sender_id = DEVICE_ID;
0016fc  1c64              ADDS     r4,r4,#1
0016fe  78e0              LDRB     r0,[r4,#3]
001700  f020001f          BIC      r0,r0,#0x1f
001704  301c              ADDS     r0,r0,#0x1c
001706  70e0              STRB     r0,[r4,#3]
;;;1419   	p_cmd->sender.sender_index = DEVICE_INDEX;
001708  78e0              LDRB     r0,[r4,#3]
00170a  f02000e0          BIC      r0,r0,#0xe0
00170e  70e0              STRB     r0,[r4,#3]
;;;1420   	p_cmd->receiver.receiver_id = 0x03; // 飞控
001710  7920              LDRB     r0,[r4,#4]
001712  f020001f          BIC      r0,r0,#0x1f
001716  1cc0              ADDS     r0,r0,#3
001718  7120              STRB     r0,[r4,#4]
;;;1421   	p_cmd->receiver.receiver_index = 0;
00171a  7920              LDRB     r0,[r4,#4]
00171c  f02000e0          BIC      r0,r0,#0xe0
001720  7120              STRB     r0,[r4,#4]
;;;1422   	p_cmd->seqnum = seq++;
001722  48a9              LDR      r0,|L1.6600|
001724  8800              LDRH     r0,[r0,#0]  ; seq
001726  f8a40005          STRH     r0,[r4,#5]
00172a  48a7              LDR      r0,|L1.6600|
00172c  8800              LDRH     r0,[r0,#0]  ; seq
00172e  1c40              ADDS     r0,r0,#1
001730  49a5              LDR      r1,|L1.6600|
001732  8008              STRH     r0,[r1,#0]
;;;1423   	p_cmd->type.cmd_type = 0;
001734  79e0              LDRB     r0,[r4,#7]
001736  f0200080          BIC      r0,r0,#0x80
00173a  71e0              STRB     r0,[r4,#7]
;;;1424   	p_cmd->type.cmd_ack =  1; // 需要应答
00173c  79e0              LDRB     r0,[r4,#7]
00173e  f0200060          BIC      r0,r0,#0x60
001742  3020              ADDS     r0,r0,#0x20
001744  71e0              STRB     r0,[r4,#7]
;;;1425   	p_cmd->type.encrypt_type = 0;
001746  79e0              LDRB     r0,[r4,#7]
001748  f020000f          BIC      r0,r0,#0xf
00174c  71e0              STRB     r0,[r4,#7]
;;;1426   	p_cmd->set = 0xe;
00174e  200e              MOVS     r0,#0xe
001750  7220              STRB     r0,[r4,#8]
;;;1427   	p_cmd->id = 0x21;
001752  2021              MOVS     r0,#0x21
001754  7260              STRB     r0,[r4,#9]
;;;1428   	p_cmd->vl.length = sizeof(cmd_header_v1_t) + sizeof(cmd_iosd_config_t)+ CRC_16_LENGTH;
001756  8820              LDRH     r0,[r4,#0]
001758  f36f0009          BFC      r0,#0,#10
00175c  306d              ADDS     r0,r0,#0x6d
00175e  8020              STRH     r0,[r4,#0]
;;;1429     	  
;;;1430   //smm_3++;
;;;1431   	p_data->block_id = Block_ID;
001760  489a              LDR      r0,|L1.6604|
001762  8800              LDRH     r0,[r0,#0]  ; Block_ID
001764  8028              STRH     r0,[r5,#0]
;;;1432   	p_data->number_of_packet_entries = Item_Count; 
001766  200d              MOVS     r0,#0xd
001768  70a8              STRB     r0,[r5,#2]
;;;1433   	p_data->config_data_length = data_name_length;
00176a  205c              MOVS     r0,#0x5c
00176c  70e8              STRB     r0,[r5,#3]
;;;1434     memcpy(p_data->data_name,spray_data_name,data_name_length);
00176e  225c              MOVS     r2,#0x5c
001770  4997              LDR      r1,|L1.6608|
001772  1d28              ADDS     r0,r5,#4
001774  f7fffffe          BL       __aeabi_memcpy
;;;1435   	Append_CRC8_Check_Sum( tmpBuf, 4 );
001778  2104              MOVS     r1,#4
00177a  a801              ADD      r0,sp,#4
00177c  f7fffffe          BL       Append_CRC8_Check_Sum
;;;1436   	Append_CRC16_Check_Sum( tmpBuf, p_cmd->vl.length );
001780  8820              LDRH     r0,[r4,#0]
001782  f3c00109          UBFX     r1,r0,#0,#10
001786  a801              ADD      r0,sp,#4
001788  f7fffffe          BL       Append_CRC16_Check_Sum
;;;1437   	CAN_sendbytes_View( LPC_CAN1, &can1Tx3RingBuf, tmpBuf, p_cmd->vl.length );
00178c  f8340901          LDRH     r0,[r4],#-1
001790  f3c00309          UBFX     r3,r0,#0,#10
001794  aa01              ADD      r2,sp,#4
001796  4989              LDR      r1,|L1.6588|
001798  4889              LDR      r0,|L1.6592|
00179a  f7fffffe          BL       CAN_sendbytes_View
;;;1438   }
00179e  b01f              ADD      sp,sp,#0x7c
0017a0  bd30              POP      {r4,r5,pc}
;;;1439   
                          ENDP

                  cmd_handler_iosd_config_ack PROC
;;;1440   cmd_iosd_config_ack_t cmd_iosd_config_ack; 
;;;1441   void cmd_handler_iosd_config_ack(uint8_t *p_buf, uint16_t len) 
0017a2  b510              PUSH     {r4,lr}
;;;1442   {
0017a4  460a              MOV      r2,r1
;;;1443   	cmd_iosd_config_ack_t *p_rr = (cmd_iosd_config_ack_t*)( p_buf + sizeof( cmd_header_v1_t ) );
0017a6  f100010b          ADD      r1,r0,#0xb
;;;1444     memcpy(&cmd_iosd_config_ack,p_rr,sizeof(cmd_iosd_config_ack_t));
0017aa  4b8a              LDR      r3,|L1.6612|
0017ac  680c              LDR      r4,[r1,#0]
0017ae  601c              STR      r4,[r3,#0]  ; cmd_iosd_config_ack
;;;1445   }
0017b0  bd10              POP      {r4,pc}
;;;1446   
                          ENDP

                  spray_system_data_Push PROC
;;;1448   
;;;1449   void spray_system_data_Push(void)
0017b2  b570              PUSH     {r4-r6,lr}
;;;1450   {
0017b4  b08e              SUB      sp,sp,#0x38
;;;1451   	uint8_t tmpBuf[50] = {0};
0017b6  2134              MOVS     r1,#0x34
0017b8  a801              ADD      r0,sp,#4
0017ba  f7fffffe          BL       __aeabi_memclr4
;;;1452   	static uint16_t seq=0;
;;;1453     cmd_header_v1_t *p_cmd = (cmd_header_v1_t *)tmpBuf;
0017be  ac01              ADD      r4,sp,#4
;;;1454     cmd_iosd_data_push_t *p_data = (cmd_iosd_data_push_t *)(tmpBuf + sizeof( cmd_header_v1_t ));
0017c0  f10d050f          ADD      r5,sp,#0xf
;;;1455   
;;;1456   	p_cmd->sof = 0x55;
0017c4  2055              MOVS     r0,#0x55
0017c6  7020              STRB     r0,[r4,#0]
;;;1457   	p_cmd->vl.version = 1;
0017c8  78a0              LDRB     r0,[r4,#2]
0017ca  f02000fc          BIC      r0,r0,#0xfc
0017ce  1d00              ADDS     r0,r0,#4
0017d0  70a0              STRB     r0,[r4,#2]
;;;1458   	p_cmd->sender.sender_id = DEVICE_ID;
0017d2  1c64              ADDS     r4,r4,#1
0017d4  78e0              LDRB     r0,[r4,#3]
0017d6  f020001f          BIC      r0,r0,#0x1f
0017da  301c              ADDS     r0,r0,#0x1c
0017dc  70e0              STRB     r0,[r4,#3]
;;;1459   	p_cmd->sender.sender_index = DEVICE_INDEX;
0017de  78e0              LDRB     r0,[r4,#3]
0017e0  f02000e0          BIC      r0,r0,#0xe0
0017e4  70e0              STRB     r0,[r4,#3]
;;;1460   	p_cmd->receiver.receiver_id = 0x03; // 飞控
0017e6  7920              LDRB     r0,[r4,#4]
0017e8  f020001f          BIC      r0,r0,#0x1f
0017ec  1cc0              ADDS     r0,r0,#3
0017ee  7120              STRB     r0,[r4,#4]
;;;1461   	p_cmd->receiver.receiver_index = 0;
0017f0  7920              LDRB     r0,[r4,#4]
0017f2  f02000e0          BIC      r0,r0,#0xe0
0017f6  7120              STRB     r0,[r4,#4]
;;;1462   	p_cmd->seqnum = seq++;
0017f8  4877              LDR      r0,|L1.6616|
0017fa  8800              LDRH     r0,[r0,#0]  ; seq
0017fc  f8a40005          STRH     r0,[r4,#5]
001800  4875              LDR      r0,|L1.6616|
001802  8800              LDRH     r0,[r0,#0]  ; seq
001804  1c40              ADDS     r0,r0,#1
001806  4974              LDR      r1,|L1.6616|
001808  8008              STRH     r0,[r1,#0]
;;;1463   	p_cmd->type.cmd_type = 0;
00180a  79e0              LDRB     r0,[r4,#7]
00180c  f0200080          BIC      r0,r0,#0x80
001810  71e0              STRB     r0,[r4,#7]
;;;1464   	p_cmd->type.cmd_ack =  1; // 需要应答
001812  79e0              LDRB     r0,[r4,#7]
001814  f0200060          BIC      r0,r0,#0x60
001818  3020              ADDS     r0,r0,#0x20
00181a  71e0              STRB     r0,[r4,#7]
;;;1465   	p_cmd->type.encrypt_type = 0;
00181c  79e0              LDRB     r0,[r4,#7]
00181e  f020000f          BIC      r0,r0,#0xf
001822  71e0              STRB     r0,[r4,#7]
;;;1466   	p_cmd->set = 0xe;
001824  200e              MOVS     r0,#0xe
001826  7220              STRB     r0,[r4,#8]
;;;1467   	p_cmd->id = 0x22;
001828  2022              MOVS     r0,#0x22
00182a  7260              STRB     r0,[r4,#9]
;;;1468   	p_cmd->vl.length = sizeof(cmd_header_v1_t) + sizeof(cmd_iosd_data_push_t)+ CRC_16_LENGTH;
00182c  8820              LDRH     r0,[r4,#0]
00182e  f36f0009          BFC      r0,#0,#10
001832  3028              ADDS     r0,r0,#0x28
001834  8020              STRH     r0,[r4,#0]
;;;1469     
;;;1470   	p_data->block_id =  Block_ID;
001836  4865              LDR      r0,|L1.6604|
001838  8800              LDRH     r0,[r0,#0]  ; Block_ID
00183a  8028              STRH     r0,[r5,#0]
;;;1471     p_data->iosd_data_length = sizeof(spray_system_para_save_iosd_t);
00183c  2018              MOVS     r0,#0x18
00183e  70a8              STRB     r0,[r5,#2]
;;;1472     
;;;1473   	p_data->spray_system_para.control_pump_status[0].enable_flag = FOC_1_STATUS.enable_flag;;
001840  4866              LDR      r0,|L1.6620|
001842  7800              LDRB     r0,[r0,#0]  ; FOC_1_STATUS
001844  f0000001          AND      r0,r0,#1
001848  70e8              STRB     r0,[r5,#3]
;;;1474   	p_data->spray_system_para.control_pump_status[0].flow_speed = FOC_1_STATUS.flow_speed*0.02f;
00184a  4964              LDR      r1,|L1.6620|
00184c  7809              LDRB     r1,[r1,#0]  ; FOC_1_STATUS
00184e  0848              LSRS     r0,r1,#1
001850  f7fffffe          BL       __aeabi_ui2f
001854  4606              MOV      r6,r0
001856  4962              LDR      r1,|L1.6624|
001858  f7fffffe          BL       __aeabi_fmul
00185c  6068              STR      r0,[r5,#4]
;;;1475   	p_data->spray_system_para.control_pump_status[1].enable_flag = FOC_2_STATUS.enable_flag;
00185e  4861              LDR      r0,|L1.6628|
001860  7800              LDRB     r0,[r0,#0]  ; FOC_2_STATUS
001862  f0000101          AND      r1,r0,#1
001866  7229              STRB     r1,[r5,#8]
;;;1476   	p_data->spray_system_para.control_pump_status[1].flow_speed  = FOC_2_STATUS.flow_speed*0.02f;
001868  495e              LDR      r1,|L1.6628|
00186a  7809              LDRB     r1,[r1,#0]  ; FOC_2_STATUS
00186c  0848              LSRS     r0,r1,#1
00186e  f7fffffe          BL       __aeabi_ui2f
001872  4606              MOV      r6,r0
001874  495a              LDR      r1,|L1.6624|
001876  f7fffffe          BL       __aeabi_fmul
00187a  f8c50009          STR      r0,[r5,#9]
;;;1477   	p_data->spray_system_para.flow_freq = get_cali_flow_freq();
00187e  f7fffffe          BL       get_cali_flow_freq
001882  7568              STRB     r0,[r5,#0x15]
;;;1478   	p_data->spray_system_para.level_status = level_status_by_radar;
001884  4858              LDR      r0,|L1.6632|
001886  7801              LDRB     r1,[r0,#0]  ; level_status_by_radar
001888  75a9              STRB     r1,[r5,#0x16]
;;;1479   	p_data->spray_system_para.foc1_value = get_foc_throttle_value(FOC_1);
00188a  2001              MOVS     r0,#1
00188c  f7fffffe          BL       get_foc_throttle_value
001890  1ce9              ADDS     r1,r5,#3
001892  f8a5000d          STRH     r0,[r5,#0xd]
;;;1480   	p_data->spray_system_para.foc2_value = get_foc_throttle_value(FOC_2);
001896  2002              MOVS     r0,#2
001898  f7fffffe          BL       get_foc_throttle_value
00189c  1ce9              ADDS     r1,r5,#3
00189e  f8a50011          STRH     r0,[r5,#0x11]
;;;1481   	p_data->spray_system_para.press1_value = get_press_value(Press_Sensor_0);
0018a2  2000              MOVS     r0,#0
0018a4  f7fffffe          BL       get_press_value
0018a8  1ce9              ADDS     r1,r5,#3
0018aa  f8a5000f          STRH     r0,[r5,#0xf]
;;;1482   	p_data->spray_system_para.press2_value = get_press_value(Press_Sensor_1);
0018ae  2001              MOVS     r0,#1
0018b0  f7fffffe          BL       get_press_value
0018b4  1ce9              ADDS     r1,r5,#3
0018b6  f8a50013          STRH     r0,[r5,#0x13]
;;;1483   	p_data->spray_system_para.cali_capacity = spray_system_flow_cali_para1.capacity;
0018ba  484c              LDR      r0,|L1.6636|
0018bc  8841              LDRH     r1,[r0,#2]  ; spray_system_flow_cali_para1
0018be  1ce8              ADDS     r0,r5,#3
0018c0  f8a51017          STRH     r1,[r5,#0x17]
;;;1484   	p_data->spray_system_para.cali_pulses = spray_system_flow_cali_para1.cali_pulses;
0018c4  4849              LDR      r0,|L1.6636|
0018c6  8880              LDRH     r0,[r0,#4]  ; spray_system_flow_cali_para1
0018c8  b281              UXTH     r1,r0
0018ca  1ce8              ADDS     r0,r5,#3
0018cc  f8a51019          STRH     r1,[r5,#0x19]
;;;1485   
;;;1486   	Append_CRC8_Check_Sum( tmpBuf, 4 );
0018d0  2104              MOVS     r1,#4
0018d2  a801              ADD      r0,sp,#4
0018d4  f7fffffe          BL       Append_CRC8_Check_Sum
;;;1487   	Append_CRC16_Check_Sum( tmpBuf, p_cmd->vl.length );
0018d8  8820              LDRH     r0,[r4,#0]
0018da  f3c00109          UBFX     r1,r0,#0,#10
0018de  a801              ADD      r0,sp,#4
0018e0  f7fffffe          BL       Append_CRC16_Check_Sum
;;;1488   	CAN_sendbytes_View( LPC_CAN1, &can1Tx3RingBuf, tmpBuf, p_cmd->vl.length );
0018e4  f8340901          LDRH     r0,[r4],#-1
0018e8  f3c00309          UBFX     r3,r0,#0,#10
0018ec  aa01              ADD      r2,sp,#4
0018ee  4933              LDR      r1,|L1.6588|
0018f0  4833              LDR      r0,|L1.6592|
0018f2  f7fffffe          BL       CAN_sendbytes_View
;;;1489   }
0018f6  b00e              ADD      sp,sp,#0x38
0018f8  bd70              POP      {r4-r6,pc}
;;;1490   
                          ENDP

                  cmd_handler_data_push_ack PROC
;;;1491   cmd_iosd_data_push_ack_t debug_cmd_iosd_data_push_ack; 
;;;1492   void cmd_handler_data_push_ack(uint8_t *p_buf, uint16_t len) 
0018fa  b510              PUSH     {r4,lr}
;;;1493   {
0018fc  460a              MOV      r2,r1
;;;1494   	cmd_iosd_data_push_ack_t *p_rr = (cmd_iosd_data_push_ack_t*)( p_buf + sizeof( cmd_header_v1_t ) );
0018fe  f100010b          ADD      r1,r0,#0xb
;;;1495     memcpy(&debug_cmd_iosd_data_push_ack,p_rr,sizeof(cmd_iosd_data_push_ack_t));
001902  4b3b              LDR      r3,|L1.6640|
001904  680c              LDR      r4,[r1,#0]
001906  601c              STR      r4,[r3,#0]  ; debug_cmd_iosd_data_push_ack
;;;1496   }
001908  bd10              POP      {r4,pc}
;;;1497   
                          ENDP

                  spray_system_para_recoder PROC
;;;1500   // 10 HZ
;;;1501   void spray_system_para_recoder(void)
00190a  b510              PUSH     {r4,lr}
;;;1502   {
;;;1503   	static uint16_t run_count = 0;
;;;1504   	static uint8_t  status = 0;
;;;1505     run_count++;
00190c  4839              LDR      r0,|L1.6644|
00190e  8800              LDRH     r0,[r0,#0]  ; run_count
001910  1c40              ADDS     r0,r0,#1
001912  4938              LDR      r1,|L1.6644|
001914  8008              STRH     r0,[r1,#0]
;;;1506     switch(status)
001916  4838              LDR      r0,|L1.6648|
001918  7800              LDRB     r0,[r0,#0]  ; status
00191a  b130              CBZ      r0,|L1.6442|
00191c  2801              CMP      r0,#1
00191e  d01c              BEQ      |L1.6490|
001920  2802              CMP      r0,#2
001922  d02b              BEQ      |L1.6524|
001924  2803              CMP      r0,#3
001926  d144              BNE      |L1.6578|
001928  e040              B        |L1.6572|
                  |L1.6442|
;;;1507   	{
;;;1508   		case 0: // 申请id
;;;1509   			if(run_count%10 == 0)
00192a  4832              LDR      r0,|L1.6644|
00192c  8800              LDRH     r0,[r0,#0]  ; run_count
00192e  210a              MOVS     r1,#0xa
001930  fb90f2f1          SDIV     r2,r0,r1
001934  fb010012          MLS      r0,r1,r2,r0
001938  b908              CBNZ     r0,|L1.6462|
;;;1510   			  IOSD_Block_ID_Request();
00193a  f7fffffe          BL       IOSD_Block_ID_Request
                  |L1.6462|
;;;1511   			if(cmd_iosd_ack.Block_ID != 0)
00193e  482f              LDR      r0,|L1.6652|
001940  8840              LDRH     r0,[r0,#2]  ; cmd_iosd_ack
001942  b148              CBZ      r0,|L1.6488|
;;;1512   			{
;;;1513   				if(cmd_iosd_ack.result == 0 || cmd_iosd_ack.result == 4)
001944  482d              LDR      r0,|L1.6652|
001946  7840              LDRB     r0,[r0,#1]  ; cmd_iosd_ack
001948  b118              CBZ      r0,|L1.6482|
00194a  482c              LDR      r0,|L1.6652|
00194c  7840              LDRB     r0,[r0,#1]  ; cmd_iosd_ack
00194e  2804              CMP      r0,#4
001950  d102              BNE      |L1.6488|
                  |L1.6482|
;;;1514   					status = 1; 
001952  2001              MOVS     r0,#1
001954  4928              LDR      r1,|L1.6648|
001956  7008              STRB     r0,[r1,#0]
                  |L1.6488|
;;;1515   		  }
;;;1516   	  break;
001958  e02c              B        |L1.6580|
                  |L1.6490|
;;;1517   		
;;;1518   		case 1:// 查询是否在空闲
;;;1519   		  if(run_count%30 == 0)
00195a  4826              LDR      r0,|L1.6644|
00195c  8800              LDRH     r0,[r0,#0]  ; run_count
00195e  211e              MOVS     r1,#0x1e
001960  fb90f2f1          SDIV     r2,r0,r1
001964  fb010012          MLS      r0,r1,r2,r0
001968  b908              CBNZ     r0,|L1.6510|
;;;1520   			  IOSD_status_inquire();
00196a  f7fffffe          BL       IOSD_status_inquire
                  |L1.6510|
;;;1521   		  if(cmd_iosd_status_ack.status_flag == 0)// 状态空闲
00196e  4815              LDR      r0,|L1.6596|
001970  7840              LDRB     r0,[r0,#1]  ; cmd_iosd_status_ack
001972  b910              CBNZ     r0,|L1.6522|
;;;1522   				status = 2;
001974  2002              MOVS     r0,#2
001976  4920              LDR      r1,|L1.6648|
001978  7008              STRB     r0,[r1,#0]
                  |L1.6522|
;;;1523   	  break;
00197a  e01b              B        |L1.6580|
                  |L1.6524|
;;;1524   		
;;;1525   		case 2:
;;;1526   			if(run_count%10 == 0)
00197c  481d              LDR      r0,|L1.6644|
00197e  8800              LDRH     r0,[r0,#0]  ; run_count
001980  210a              MOVS     r1,#0xa
001982  fb90f2f1          SDIV     r2,r0,r1
001986  fb010012          MLS      r0,r1,r2,r0
00198a  b908              CBNZ     r0,|L1.6544|
;;;1527   		   IOSD_Config_Info_Push();
00198c  f7fffffe          BL       IOSD_Config_Info_Push
                  |L1.6544|
;;;1528   			if( cmd_iosd_config_ack.block_id != 0)
001990  4810              LDR      r0,|L1.6612|
001992  8840              LDRH     r0,[r0,#2]  ; cmd_iosd_config_ack
001994  b148              CBZ      r0,|L1.6570|
;;;1529   			{
;;;1530   				if(cmd_iosd_config_ack.config_result == 0 ||cmd_iosd_config_ack.config_result == 7)
001996  480f              LDR      r0,|L1.6612|
001998  7840              LDRB     r0,[r0,#1]  ; cmd_iosd_config_ack
00199a  b118              CBZ      r0,|L1.6564|
00199c  480d              LDR      r0,|L1.6612|
00199e  7840              LDRB     r0,[r0,#1]  ; cmd_iosd_config_ack
0019a0  2807              CMP      r0,#7
0019a2  d102              BNE      |L1.6570|
                  |L1.6564|
;;;1531   				  status = 3;
0019a4  2003              MOVS     r0,#3
0019a6  4914              LDR      r1,|L1.6648|
0019a8  7008              STRB     r0,[r1,#0]
                  |L1.6570|
;;;1532   		  }
;;;1533   	  break;
0019aa  e003              B        |L1.6580|
                  |L1.6572|
;;;1534   		
;;;1535   		case 3:
;;;1536   			 spray_system_data_Push();
0019ac  f7fffffe          BL       spray_system_data_Push
;;;1537   	  break;
0019b0  e000              B        |L1.6580|
                  |L1.6578|
;;;1538   		
;;;1539   	  default:
;;;1540   			
;;;1541   	  break;
0019b2  bf00              NOP      
                  |L1.6580|
0019b4  bf00              NOP                            ;1516
;;;1542   	}
;;;1543   }
0019b6  bd10              POP      {r4,pc}
;;;1544   
                          ENDP

                  |L1.6584|
                          DCD      |symbol_number.31|
                  |L1.6588|
                          DCD      can1Tx3RingBuf
                  |L1.6592|
                          DCD      0x40044000
                  |L1.6596|
                          DCD      cmd_iosd_status_ack
                  |L1.6600|
                          DCD      |symbol_number.32|
                  |L1.6604|
                          DCD      Block_ID
                  |L1.6608|
                          DCD      spray_data_name
                  |L1.6612|
                          DCD      cmd_iosd_config_ack
                  |L1.6616|
                          DCD      |symbol_number.33|
                  |L1.6620|
                          DCD      FOC_1_STATUS
                  |L1.6624|
                          DCD      0x3ca3d70a
                  |L1.6628|
                          DCD      FOC_2_STATUS
                  |L1.6632|
                          DCD      level_status_by_radar
                  |L1.6636|
                          DCD      spray_system_flow_cali_para1
                  |L1.6640|
                          DCD      debug_cmd_iosd_data_push_ack
                  |L1.6644|
                          DCD      run_count
                  |L1.6648|
                          DCD      status
                  |L1.6652|
                          DCD      cmd_iosd_ack

                          AREA ||.bss||, DATA, NOINIT, ALIGN=2

                  tmpBuf
                          %        512
                  debug_stFOC_Value_1
                          %        20
                  debug_stFOC_Value_3
                          %        20

                          AREA ||.constdata||, DATA, READONLY, ALIGN=2

                  cmd_handler_array_v0
                          DCD      cmd_hander_foc_ack
000004  01a0              DCW      0x01a0
000006  0000              DCB      0x00,0x00
                          DCD      cmd_hander_rardar_push
00000c  1007              DCW      0x1007
00000e  0000              DCB      0x00,0x00
                          DCD      0x00000000
000014  0000              DCW      0x0000
000016  0000              DCB      0x00,0x00
                  cmd_handler_array_v1
                          DCD      cmd_handler_device_info
00001c  01000000          DCB      0x01,0x00,0x00,0x00
                          DCD      cmd_handler_entry_upgrade
000024  07000000          DCB      0x07,0x00,0x00,0x00
                          DCD      cmd_handler_start_upgrade
00002c  08000000          DCB      0x08,0x00,0x00,0x00
                          DCD      cmd_handler_data_upgrade
000034  09000000          DCB      0x09,0x00,0x00,0x00
                          DCD      cmd_handler_end_upgrade
00003c  0a000000          DCB      0x0a,0x00,0x00,0x00
                          DCD      cmd_handler_reboot
000044  0b000000          DCB      0x0b,0x00,0x00,0x00
                          DCD      cmd_handler_status_report
00004c  0c000000          DCB      0x0c,0x00,0x00,0x00
                          DCD      cmd_handler_set_version
000054  0d000000          DCB      0x0d,0x00,0x00,0x00
                          DCD      cmd_handler_get_fc_statu
00005c  4e030000          DCB      0x4e,0x03,0x00,0x00
                          DCD      cmd_hander_motor_process
000064  7c020000          DCB      0x7c,0x02,0x00,0x00
                          DCD      cmd_handler_flow_cali
00006c  42090000          DCB      0x42,0x09,0x00,0x00
                          DCD      cmd_handler_level_switch
000074  43090000          DCB      0x43,0x09,0x00,0x00
                          DCD      cmd_handler_residual_volume_warning
00007c  44090000          DCB      0x44,0x09,0x00,0x00
                          DCD      cmd_handler_flowmeter_K_control
000084  45090000          DCB      0x45,0x09,0x00,0x00
                          DCD      cmd_handler_Block_ID_ack
00008c  010e0000          DCB      0x01,0x0e,0x00,0x00
                          DCD      cmd_handler_iosd_status_ack
000094  020e0000          DCB      0x02,0x0e,0x00,0x00
                          DCD      cmd_handler_iosd_config_ack
00009c  210e0000          DCB      0x21,0x0e,0x00,0x00
                          DCD      cmd_handler_data_push_ack
0000a4  220e0000          DCB      0x22,0x0e,0x00,0x00
                          DCD      cmd_handler_gimbal_ctl
0000ac  01040000          DCB      0x01,0x04,0x00,0x00
                          DCD      0x00000000
0000b4  00000000          DCB      0x00,0x00,0x00,0x00
                  spray_data_name
0000b8  6150454e          DCB      0x61,0x50,0x45,0x4e
0000bc  53410a62          DCB      0x53,0x41,0x0a,0x62
0000c0  656e626c          DCB      0x65,0x6e,0x62,0x6c
0000c4  65310a6a          DCB      0x65,0x31,0x0a,0x6a
0000c8  666c6f77          DCB      0x66,0x6c,0x6f,0x77
0000cc  310a6265          DCB      0x31,0x0a,0x62,0x65
0000d0  6e626c65          DCB      0x6e,0x62,0x6c,0x65
0000d4  320a6a66          DCB      0x32,0x0a,0x6a,0x66
0000d8  6c6f7732          DCB      0x6c,0x6f,0x77,0x32
0000dc  0a63666f          DCB      0x0a,0x63,0x66,0x6f
0000e0  63310a63          DCB      0x63,0x31,0x0a,0x63
0000e4  70726573          DCB      0x70,0x72,0x65,0x73
0000e8  73310a63          DCB      0x73,0x31,0x0a,0x63
0000ec  666f6332          DCB      0x66,0x6f,0x63,0x32
0000f0  0a637072          DCB      0x0a,0x63,0x70,0x72
0000f4  65737332          DCB      0x65,0x73,0x73,0x32
0000f8  0a626672          DCB      0x0a,0x62,0x66,0x72
0000fc  65710a62          DCB      0x65,0x71,0x0a,0x62
000100  6c657665          DCB      0x6c,0x65,0x76,0x65
000104  6c0a6363          DCB      0x6c,0x0a,0x63,0x63
000108  616c6931          DCB      0x61,0x6c,0x69,0x31
00010c  0a636361          DCB      0x0a,0x63,0x63,0x61
000110  6c69320a          DCB      0x6c,0x69,0x32,0x0a

                          AREA ||.data||, DATA, ALIGN=2

                  pwm_present_value
000000  00000000          DCB      0x00,0x00,0x00,0x00
                  g_cfg_end_point
                          DCD      0x00000000
                  cfg_package_index_front
                          DCD      0x00000000
                  cfg_write_offset
                          DCD      0x00000000
                  cfg_file_size
                          DCD      0x00000000
                  debug_foc_version
                          DCD      0x00000000
                  RecordKeyPress
000018  00                DCB      0x00
                  flow_cali_result
000019  00                DCB      0x00
                  Last_Capacity
00001a  0000              DCB      0x00,0x00
                  STOP_SPRAY_FLAG
00001c  00                DCB      0x00
                  FOC_1_STATUS
00001d  0000              DCB      0x00,0x00
                  FOC_2_STATUS
00001f  00                DCB      0x00
000020  00                DCB      0x00
                  debug_idx_7_freq
000021  00                DCB      0x00
                  foc1_e
000022  00                DCB      0x00
                  foc1_v
000023  00                DCB      0x00
                  foc2_e
000024  00                DCB      0x00
                  foc2_v
000025  00                DCB      0x00
                  level_status_by_radar
000026  00                DCB      0x00
                  FOC1_MUTEX_FLAG
000027  01                DCB      0x01
                  FOC2_MUTEX_FLAG
000028  01                DCB      0x01
                  residual_volume_warning
000029  00                DCB      0x00
                  debug_sys_esc_ctrl
00002a  0000              DCB      0x00,0x00
                          DCD      0x00000000
000030  0000              DCB      0x00,0x00
                  level_init_flag
000032  00                DCB      0x00
                  level_init_count
000033  00                DCB      0x00
                  debug_control
000034  0000              DCB      0x00,0x00
                  g_u16GimbalCtl
000036  0400              DCW      0x0400
                  g_u32GimbalGettime
                          DCD      0x00000000
                  Throttle_Value_1
00003c  03ac              DCW      0x03ac
                  Throttle_Value_2
00003e  03ac              DCW      0x03ac
                  feckbackID
000040  0000              DCB      0x00,0x00
                  debug_throttle_value_1
000042  0000              DCB      0x00,0x00
                  debug_throttle_value_2
000044  0000              DCB      0x00,0x00
                  g_stRadarData
000046  0000              DCB      0x00,0x00
000048  000000            DCB      0x00,0x00,0x00
                  u8BatteryUpgradeFlag
00004b  00                DCB      0x00
                  p_cmd
                          DCD      0x00000000
                  Block_ID
000050  0000              DCW      0x0000
                  cmd_iosd_status_ack
000052  0000              DCB      0x00,0x00
                  cmd_iosd_ack
                          DCD      0x00000000
000058  00                DCB      0x00
                  cmd_iosd_config_ack
000059  000000            DCB      0x00,0x00,0x00
00005c  00                DCB      0x00
                  debug_cmd_iosd_data_push_ack
00005d  000000            DCB      0x00,0x00,0x00
000060  00                DCB      0x00
                  cali_count
000061  00                DCB      0x00
                  ||seq||
000062  0000              DCW      0x0000
                  count
000064  0000              DCW      0x0000
                  |symbol_number.29|
000066  0000              DCW      0x0000
                  |symbol_number.30|
000068  0000              DCW      0x0000
                  |symbol_number.31|
00006a  0000              DCW      0x0000
                  |symbol_number.32|
00006c  0000              DCW      0x0000
                  |symbol_number.33|
00006e  0000              DCW      0x0000
                  run_count
000070  0000              DCW      0x0000
                  status
000072  00                DCB      0x00
